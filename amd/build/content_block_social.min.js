/**
 * JavaScript to manage content of social block.
 *
 * @package
 * @copyright 2022 The Open University
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_openstudio/content_block_social",["jquery","core/templates","core/notification","core/ajax"],(function($,Templates,displayException,Ajax){var t;return t={CSS:{POPUP_COMMENT_CONTENT:".show-popup-comment",POPUP_COMMENT_TOGGLE:".comments-content-popup",COMMENT_BLOCK_LIST:".comment-block-list",FLAG_CONTENT_BLOCK:".flag_content_block",FLAG_CONTENT_TEXT:".openstudio-grid-item-content-detail-info-text",FLAG_CONTENT_TEXT_NEW:".openstudio-grid-item-content-detail-info-text-new",FLAG_CONTENT_ICON_IMAGE:"img",FLAG_CONTENT_ICON:".openstudio-grid-item-content-detail-info-box"},init:function(){$(t.CSS.POPUP_COMMENT_CONTENT).bind("click",(function(){t.getListComment($(this))})),$(t.CSS.FLAG_CONTENT_BLOCK).bind("click",(function(){t.flagContent($(this))})),$(t.CSS.FLAG_CONTENT_ICON).bind("keypress",(function(e){13==e.which&&t.userOnPressFlagContent($(this))}))},getListComment:function(e){var isUserPress=arguments.length>1&&void 0!==arguments[1]&&arguments[1],element=e;isUserPress&&(element=$(e).find(t.CSS.POPUP_COMMENT_CONTENT).first(),$(e).find(t.CSS.POPUP_COMMENT_TOGGLE).first().toggleClass("show"));var contentid=element.attr("data-contentid"),cmid=element.attr("data-cmid");if(contentid&&cmid){$(t.CSS.COMMENT_BLOCK_LIST).empty();var promises=Ajax.call([{methodname:"mod_openstudio_external_get_comment_by_contentid",args:{cmid:cmid,contentid:contentid}}]);promises[0].done((function(res){if(res){var context={commentlist:res.comments||[]};Templates.renderForPromise("mod_openstudio/commentlist_popup",context).then((function(_ref){var html=_ref.html,js=_ref.js;return Templates.appendNodeContents(t.CSS.COMMENT_BLOCK_LIST,html,js)})).catch((function(err){return displayException(err)}))}})).fail()}},flagContent:function(e){var cid=e.attr("data-contentid"),cmid=e.attr("data-cmid"),fid=e.attr("data-fid"),mode=e.attr("data-mode");Ajax.call([{methodname:"mod_openstudio_external_flag_content",args:{cmid:cmid,cid:cid,fid:fid,mode:mode}}])[0].done((function(res){if(res){$(e).attr("data-mode",res.mode);var flagelement=$(e).find(t.CSS.FLAG_CONTENT_TEXT);flagelement&&flagelement.text(res.flagvalue||""),$(e).find(t.CSS.FLAG_CONTENT_ICON_IMAGE).attr("src",res.flagiconimage)}})).fail()},userOnPressFlagContent:function(e){var cid=e.attr("data-contentid"),cmid=e.attr("data-cmid"),fid=e.attr("data-fid"),mode=e.attr("data-mode");return cid&&cmid&&fid&&mode?t.flagContent(e):t.getListComment(e,!0)}},t}));

//# sourceMappingURL=content_block_social.min.js.map