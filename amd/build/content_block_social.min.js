/**
 * JavaScript to manage content of social block.
 *
 * @package
 * @copyright 2022 The Open University
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_openstudio/content_block_social",["jquery","core/templates","core/notification","core/ajax"],(function($,Templates,displayException,Ajax){var t;return t={CSS:{POPUP_COMMENT_CONTENT:".show-popup-comment",POPUP_COMMENT_TOGGLE:".comments-content-popup",COMMENT_BLOCK_LIST:".comment-block-list",FLAG_CONTENT_BLOCK:".flag_content_block",FLAG_CONTENT_TEXT:".openstudio-grid-item-content-detail-info-text",FLAG_CONTENT_TEXT_NEW:".openstudio-grid-item-content-detail-info-text-new",FLAG_CONTENT_ICON_IMAGE:"img.openstudio-grid-item-content-detail-info-icon",FLAG_CONTENT_ICON:".openstudio-grid-item-content-detail-info-box"},init:function(){$(t.CSS.POPUP_COMMENT_CONTENT).bind("click",(function(){t.getListComment($(this))})),$(t.CSS.FLAG_CONTENT_BLOCK).bind("click",(function(){t.flagContent($(this))})),$(t.CSS.FLAG_CONTENT_ICON).bind("keypress",(function(e){13==e.which&&t.userOnPressFlagContent($(this))})),t.updateFlagContentStyles()},getListComment:function(e){let element=e,contentid=element.attr("data-contentid"),cmid=element.attr("data-cmid");if(contentid&&cmid){$(t.CSS.COMMENT_BLOCK_LIST).empty();Ajax.call([{methodname:"mod_openstudio_external_get_comment_by_contentid",args:{cmid:cmid,contentid:contentid}}])[0].done((function(res){if(res){const context={commentlist:res.comments||[]};Templates.renderForPromise("mod_openstudio/commentlist_popup",context).then((_ref=>{let{html:html,js:js}=_ref;return Templates.appendNodeContents(t.CSS.COMMENT_BLOCK_LIST,html,js)})).catch((err=>displayException(err)))}})).fail(displayException.exception)}},flagContent:function(e){const cid=e.attr("data-contentid"),cmid=e.attr("data-cmid"),fid=e.attr("data-fid"),mode=e.attr("data-mode");Ajax.call([{methodname:"mod_openstudio_external_flag_content",args:{cmid:cmid,cid:cid,fid:fid,mode:mode}}])[0].done((function(res){if(res){$(e).attr("data-mode",res.mode);let flagelement=$(e).find(t.CSS.FLAG_CONTENT_TEXT);flagelement&&flagelement.text(res.flagvalue||""),""!==flagelement.text().trim()?flagelement.addClass("has-value"):flagelement.removeClass("has-value"),$(e).find(t.CSS.FLAG_CONTENT_ICON_IMAGE).attr("src",res.flagiconimage)}})).fail(displayException.exception)},userOnPressFlagContent:function(e){const cid=e.attr("data-contentid"),cmid=e.attr("data-cmid"),fid=e.attr("data-fid"),mode=e.attr("data-mode");cid&&cmid&&fid&&mode&&t.flagContent(e)},updateFlagContentStyles:function(){$(t.CSS.FLAG_CONTENT_TEXT).each((function(){""!==$(this).text().trim()?$(this).addClass("has-value"):$(this).removeClass("has-value")}))}}}));

//# sourceMappingURL=content_block_social.min.js.map