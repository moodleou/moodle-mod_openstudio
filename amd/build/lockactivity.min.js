/**
 * JavaScript to manage lock activity content.
 *
 * @package
 * @copyright 2017 The Open University
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_openstudio/lockactivity",["jquery","core/ajax","core/str","mod_openstudio/osdialogue"],(function($,Ajax,Str,osDialogue){var t;return t={mconfig:null,CSS:{ACTIVITY_UNLOCK_ICON:'span[name="activitylockbutton"]',ACTIVITY_UNLOCK_BUTTON:".openstudio-unlock-ok-btn"},dialogue:null,init:async function(options){t.mconfig=options,t.dialogue=await t.createUnlockActivityDialogue(),$(t.CSS.ACTIVITY_UNLOCK_ICON).on("click",(function(){t.dialogue&&($(t.CSS.ACTIVITY_UNLOCK_BUTTON).attr("data-level3id",$(this).attr("data-level3id")).attr("data-vuid",$(this).attr("data-vuid")),t.dialogue.show())})),$("body").delegate(t.CSS.ACTIVITY_UNLOCK_BUTTON,"click",t.unlockActivityContent)},unlockActivityContent:function(){var level3id=$(this).attr("data-level3id"),vuid=$(this).attr("data-vuid");M.util.js_pending("openstudioUnlockActivity"),Ajax.call([{methodname:"mod_openstudio_external_unlock_override_activity",args:{cmid:t.mconfig.cmid,level3id:level3id,vuid:vuid}}])[0].done((function(){window.location.reload()})).always((function(){M.util.js_complete("openstudioUnlockActivity")})).fail((function(ex){window.console.error("Log request failed "+ex.message)}))},createUnlockActivityDialogue:async function(){const dialogue=await osDialogue.create({isVerticallyCentered:!0});return function(dialogue){Str.get_string("contentactionunlockname","mod_openstudio").done((function(s){dialogue.setTitle("<span>"+s+"</span>")}))}(dialogue),function(dialogue){Str.get_string("modulejsdialogcontentunlock","mod_openstudio").done((function(s){dialogue.setBody(s)}))}(dialogue),function(dialogue){const cancelBtnProperty={name:"cancel",action:"hide"},unlockBtnProperty={name:"lock",classNames:t.CSS.ACTIVITY_UNLOCK_BUTTON.replace(".","")};Str.get_strings([{key:"modulejsdialogcancel",component:"mod_openstudio"},{key:"contentactionunlockname",component:"mod_openstudio"}]).done((function(s){cancelBtnProperty.label=s[0],unlockBtnProperty.label=s[1],dialogue.addButton(unlockBtnProperty,["footer"]),dialogue.addButton(cancelBtnProperty,["footer"])}))}(dialogue),dialogue}}}));

//# sourceMappingURL=lockactivity.min.js.map