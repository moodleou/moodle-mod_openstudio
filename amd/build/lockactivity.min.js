/**
 * JavaScript to manage lock activity content.
 *
 * @package
 * @copyright 2017 The Open University
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_openstudio/lockactivity",["jquery","core/ajax","core/str"],(function($,Ajax,Str){var t;return t={mconfig:null,CSS:{ACTIVITY_UNLOCK_ICON:'span[name="activitylockbutton"]',ACTIVITY_UNLOCK_BUTTON:".openstudio-unlock-ok-btn"},init:function(options){t.mconfig=options,Y.use("moodle-core-notification-dialogue",(function(){require(["mod_openstudio/osdialogue"],(function(osDialogue){t.dialogue=t.createUnlockActivityDialogue(osDialogue)}))})),$(t.CSS.ACTIVITY_UNLOCK_ICON).on("click",(function(){t.dialogue&&($(t.CSS.ACTIVITY_UNLOCK_BUTTON).attr("data-level3id",$(this).attr("data-level3id")).attr("data-vuid",$(this).attr("data-vuid")),t.dialogue.show())})),$("body").delegate(t.CSS.ACTIVITY_UNLOCK_BUTTON,"click",t.unlockActivityContent),$(window).resize(t.resize.bind(t))},unlockActivityContent:function(){var level3id=$(this).attr("data-level3id"),vuid=$(this).attr("data-vuid");M.util.js_pending("openstudioUnlockActivity"),Ajax.call([{methodname:"mod_openstudio_external_unlock_override_activity",args:{cmid:t.mconfig.cmid,level3id:level3id,vuid:vuid}}])[0].done((function(){window.location.reload()})).always((function(){M.util.js_complete("openstudioUnlockActivity")})).fail((function(ex){window.console.error("Log request failed "+ex.message)}))},createUnlockActivityDialogue:function(osDialogue){var cancelBtnProperty,unlockBtnProperty,dialogue=new osDialogue({closeButton:!0,visible:!1,centered:!0,modal:!0,responsive:!0,width:640,responsiveWidth:767,focusOnPreviousTargetAfterHide:!0});return Str.get_string("contentactionunlockname","mod_openstudio").done((function(s){dialogue.set("headerContent","<span>"+s+"</span>")})),Str.get_string("modulejsdialogcontentunlock","mod_openstudio").done((function(s){dialogue.set("bodyContent",s)})),cancelBtnProperty={name:"cancel",action:"hide"},unlockBtnProperty={name:"lock",classNames:t.CSS.ACTIVITY_UNLOCK_BUTTON.replace(".","")},Str.get_strings([{key:"modulejsdialogcancel",component:"mod_openstudio"},{key:"contentactionunlockname",component:"mod_openstudio"}]).done((function(s){cancelBtnProperty.label=s[0],unlockBtnProperty.label=s[1],dialogue.addButton(unlockBtnProperty,["footer"]),dialogue.addButton(cancelBtnProperty,["footer"])})),dialogue},resize:function(){t.dialogue&&t.dialogue.get("visible")&&(Y.one("body").get("winWidth")<=t.dialogue.get("responsiveWidth")?t.dialogue.makeResponsive():t.dialogue.centerDialogue())}}}));

//# sourceMappingURL=lockactivity.min.js.map