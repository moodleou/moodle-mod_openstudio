{"version":3,"file":"viewhelper.min.js","sources":["../src/viewhelper.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript to manage on view page.\n *\n * @package\n * @copyright 2017 The Open University\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_openstudio/viewhelper\n */\n\ndefine(['jquery', 'amd/build/isotope.pkgd.min.js'], function($, Isotope) {\n    var t;\n\n    t = {\n\n        /**\n         * Isotope instance.\n         * There are more than a grid in a page\n         */\n        isotope: [],\n\n        /**\n         * Module config. Passed from server side.\n         * {\n         *     searchtext: string\n         * }\n         */\n        mconfig: null,\n\n        /**\n         * List out all of css selector used in this module.\n         */\n        CSS: {\n            SEARCHBOX: '#oustudyplan-query'\n        },\n\n        /**\n         * Initialise this module.\n         *\n         * @param {JSON} options  The settings for this feature.\n         */\n        init: function(options) {\n\n            t.mconfig = options || {searchtext: ''};\n\n            t.handleFilter();\n            t.handleIsotope();\n            t.handleGroupSwitcher();\n            t.handleViewSizeSwitcher();\n            t.handleBlockSwitcher();\n            t.initSearchForm();\n            t.handleCollapseClick();\n        },\n\n        /**\n         * Handle items will be shown via Isotope masonry template.\n         *\n         * @method handleTooltip\n         */\n        handleIsotope: function() {\n            var container = $('.openstudio-grid');\n            container.each(function() {\n                t.isotope.push(new Isotope('#' + this.id, {\n                    layoutMode: 'masonry',\n                    itemSelector: '.openstudio-grid-item',\n                    masonry: {\n                        columnWidth: 243,\n                        gutter: 20,\n                        horizontalOrder: true\n                    }\n                }));\n            });\n\n            // Once all images loaded, try to re-arrange all items.\n            $(window).on('load', function() {\n                t.reArrangeItems();\n            });\n        },\n\n        /**\n         * Re-arrange items\n         *\n         * @method reArrangeItems\n         */\n        reArrangeItems: function() {\n            setTimeout(function() {\n                $.each(t.isotope, function(i, grid) {\n                    grid.layout();\n                });\n            }, 1000);\n        },\n\n        /**\n         * Handle when user filter by group.\n         *\n         * @method handleGroupSwitcher\n         */\n        handleGroupSwitcher: function() {\n            // This should work for mobile also.\n            $(document).on('change', '#filter_groupid', function() {\n                t.redirectURL();\n            });\n        },\n\n        /**\n         * Handle when user filter by block.\n         *\n         * @method handleBlockSwitcher\n         */\n        handleBlockSwitcher: function() {\n            // This should work for mobile also.\n            $(document).on('change', '#filter_block_activity', function() {\n                t.redirectURL();\n            });\n        },\n\n        /**\n         * Handle when user filter by view number.\n         *\n         * @method handleViewSizeSwitcher\n         */\n        handleViewSizeSwitcher: function() {\n            // This should work for mobile also.\n            $(document).on('change', '#filter_pagesize', function() {\n                t.redirectURL();\n            });\n        },\n\n        /**\n         * Handle redirect URL.\n         *\n         * @method redirectURL\n         */\n        redirectURL: function() {\n            var url = $('#view_sort_action_url').val();\n            var vid = $('#vid').val();\n            var groupidelement = $('#groupid');\n            if (groupidelement.length > 0) {\n                var groupid = groupidelement.val();\n                url = url + '&groupid=' + groupid;\n            }\n            url = url + '&vid=' + vid;\n\n            $('.openstudio-filter-select-box:visible').each(function() {\n                var name = $(this).attr('name');\n                url = url + '&' + name + '=' + $(this).val();\n            });\n\n            window.location.href = url;\n\n        },\n\n        /**\n         * Handle actions for filter.\n         *\n         * @method handleFilter\n         */\n        handleFilter: function() {\n\n            // By post types.\n            $('#openstudio_filter_types_0').on('click', function(e) {\n                var checkbox = $(this);\n\n                // Prevent checkbox from unchecking when clicked.\n                if (!checkbox.is(\":checked\")) {\n                    e.preventDefault();\n                    return false;\n                }\n\n                $('.openstudio-filter-types-checkbox').prop(\"checked\", false);\n                $('#openstudio_filter_types_0').prop(\"checked\", true);\n            });\n\n            $('.openstudio-filter-types-checkbox').on(\"click\", function() {\n                var checkbox = $(this);\n\n                if (checkbox.is(\":checked\") && checkbox.attr('id') != \"openstudio_filter_types_0\") {\n                    $('#openstudio_filter_types_0').prop(\"checked\", false);\n                }\n\n                var length = $('[name=\"ftypearray[]\"]:checked').length;\n\n                if (length == 0) {\n                    $('#openstudio_filter_types_0').prop(\"checked\", true);\n                }\n            });\n\n\n            // By user flags.\n            $('#openstudio_filter_user_flags_0').on(\"click\", function(e) {\n                var checkbox = $(this);\n\n                // Prevent checkbox from unchecking when clicked.\n                if (!checkbox.is(\":checked\")) {\n                    e.preventDefault();\n                    return false;\n                }\n\n                $('.openstudio-filter-user-flags-checkbox').prop(\"checked\", false);\n                $('#openstudio_filter_user_flags_0').prop(\"checked\", true);\n            });\n\n            $('.openstudio-filter-user-flags-checkbox').on(\"click\", function() {\n                var checkbox = $(this);\n\n                if (checkbox.is(\":checked\") && checkbox.attr('id') != \"openstudio_filter_types_0\") {\n                    $('#openstudio_filter_user_flags_0').prop(\"checked\", false);\n                }\n\n                var length = $('[name=\"fflagarray[]\"]:checked').length;\n\n                if (length == 0) {\n                    $('#openstudio_filter_user_flags_0').prop(\"checked\", true);\n                }\n            });\n\n            // Reset button.\n            $('#reset_filter_btn').on('click', function() {\n                $('#reset_filter').val(1);\n                $('#filteractive').val(0);\n                $('#openstudio-filter-form').submit();\n\n            });\n\n            // Set Blocks option selected when a block checked.\n            // When do not has any block checked, all option should be selected.\n            $('.openstudio-filter-block').on('click', function() {\n                var checkbox = $(this);\n                var filter_area_activity_value = $('#filter_area_activity_value').val();\n                var length = $('[name=\"fblockarray[]\"]:checked').length;\n\n                if (checkbox.is(\":checked\")) {\n                    $('#filter_block').val(filter_area_activity_value);\n                }\n\n                if (length == 0) {\n                    $('#filter_block').val(0);\n                }\n            });\n\n            // Uncheck all blocks option when ALl/Pinboard selected.\n            $('#filter_block').on('change', function() {\n                var filter_block = $(this).val();\n                var filter_area_activity_value = $('#filter_area_activity_value').val();\n\n                if (parseInt(filter_block) == filter_area_activity_value) {\n                    $('#filter_block').val(0);\n                } else {\n                    $('.openstudio-filter-block').prop(\"checked\", false);\n                }\n            });\n\n            // Some works to help page accessible.\n            // Because collapse/expand mechanism of bootstrap is that setting the height of target element to 0\n            // and overflow to hidden. So target element is invisible but focusable.\n            // So when pressing tab key, the invisible elements is focused also.\n            $('.openstudio-filter-link a').on('click', function() {\n                var isCollapsed = !($(this).hasClass('collapsed'));\n                $($(this).data('target')).find('input, select').attr('tabindex', isCollapsed ? -1 : 0);\n            });\n\n            $('.openstudio-filter-link a.collapsed').each(function() {\n                $($(this).data('target')).find('input, select').attr('tabindex', -1);\n            });\n        },\n        /**\n         * Handle collapse click for profile bar.\n         *\n         * @method handleCollapseClick\n         */\n        handleCollapseClick: function() {\n            var myprofile = document.querySelector('.openstudio-profile-mypaticipation-content');\n            var fullusername = document.getElementById('openstudio_profile_fullusername');\n            var profilleparticipate =\n                document.querySelector('#openstudio_profile_bar .openstudio-profile-bar-participation-content');\n            var profilleparticipatemobile =\n                document.querySelector('#openstudio_profile_bar_mobile .openstudio-profile-bar-participation-content');\n            var progressbar = document.getElementsByClassName('openstudio-profile-progress-content');\n            var showprofile = null;\n            var showparticipate = null;\n            var body = document.querySelector('body');\n            for (var i = 0; i < progressbar.length; i++) {\n                if (progressbar && progressbar[i] && progressbar[i].clientHeight > 0) {\n                    showprofile = progressbar[i];\n                }\n            }\n            if (body.classList.contains('ios') || body.classList.contains('android')) {\n                showparticipate = profilleparticipatemobile;\n            } else {\n                showparticipate = profilleparticipate;\n            }\n            if (fullusername && showprofile) {\n                var originalmarginTop = showprofile.style.marginTop ? showprofile.style.marginTop : '0px';\n                var originalpaddingTop = showprofile.style.paddingTop ? showprofile.style.paddingTop : '0px';\n                fullusername.addEventListener('click', function() {\n                    var w = window.innerWidth;\n                    if ((w > 767 && w < 1204 && (!body.classList.contains('ios') && !body.classList.contains('android')))\n                        || (w > 767 && w < 940 && (body.classList.contains('ios') || body.classList.contains('android')))) {\n                        if (fullusername.classList.contains('collapsed')) {\n                            setTimeout(function() {\n                                // Two line\n                                if (showparticipate && fullusername.clientHeight > 21) {\n                                    if (myprofile && myprofile.getBoundingClientRect().height >\n                                        showparticipate.getBoundingClientRect().height) {\n                                        if (showprofile.getBoundingClientRect().top > myprofile.getBoundingClientRect().bottom) {\n                                            showprofile.style.marginTop = originalmarginTop + 3 + 'px';\n                                        } else {\n                                            showprofile.style.marginTop = myprofile.getBoundingClientRect().bottom -\n                                                showprofile.getBoundingClientRect().top + 'px';\n                                        }\n                                    } else if (showparticipate) {\n                                        if (showprofile.getBoundingClientRect().top >\n                                            showparticipate.getBoundingClientRect().bottom) {\n                                            showprofile.style.marginTop = originalmarginTop + 3 + 'px';\n                                        } else {\n                                            showprofile.style.marginTop = showparticipate.getBoundingClientRect().bottom -\n                                                showprofile.getBoundingClientRect().top + 'px';\n                                        }\n                                    }\n                                    if (body.classList.contains('ios') || body.classList.contains('android')) {\n                                        showprofile.style.paddingTop = '5px';\n                                    } else {\n                                        showprofile.style.paddingTop = '9px';\n                                    }\n                                }\n\n                            }, 500);\n                        } else {\n                            showprofile.style.paddingTop = originalpaddingTop;\n                            showprofile.style.marginTop = originalmarginTop;\n                        }\n                    }\n                });\n            }\n        },\n\n        /**\n         * Init query string for search form.\n         * Because oustudyplan renderer does not allow us to set value for input while rendering search form.\n         *\n         * @method initSearchForm\n         */\n        initSearchForm: function() {\n            $(t.CSS.SEARCHBOX).val(t.mconfig.searchtext);\n        }\n\n    };\n\n    return t;\n\n});\n"],"names":["define","$","Isotope","t","isotope","mconfig","CSS","SEARCHBOX","init","options","searchtext","handleFilter","handleIsotope","handleGroupSwitcher","handleViewSizeSwitcher","handleBlockSwitcher","initSearchForm","handleCollapseClick","each","push","this","id","layoutMode","itemSelector","masonry","columnWidth","gutter","horizontalOrder","window","on","reArrangeItems","setTimeout","i","grid","layout","document","redirectURL","url","val","vid","groupidelement","length","groupid","name","attr","location","href","e","is","preventDefault","prop","checkbox","submit","filter_area_activity_value","filter_block","parseInt","isCollapsed","hasClass","data","find","myprofile","querySelector","fullusername","getElementById","profilleparticipate","profilleparticipatemobile","progressbar","getElementsByClassName","showprofile","showparticipate","body","clientHeight","classList","contains","originalmarginTop","style","marginTop","originalpaddingTop","paddingTop","addEventListener","w","innerWidth","getBoundingClientRect","height","top","bottom"],"mappings":"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"}