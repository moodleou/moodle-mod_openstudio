/**
 * JavaScript to manage export feature.
 *
 * @package
 * @copyright 2017 The Open University
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_openstudio/export",["jquery","core/str","core/config","mod_openstudio/osdialogue"],(function($,Str,SiteConfig,osDialogue){var t;return t={dialogue:null,mconfig:null,CSS:{DIALOGHEADER:".openstudio-export-header",BOUNDINGBOX:".openstudio-export-dialog-container",EXPORTBUTTON:"#osep-bottombutton-export",EXPORTMESSAGE:".openstudio-export-message",SELECTALLPOST:'button[name="openstudio-export-select-all"]',SELECTNONE:'button[name="openstudio-export-select-none"]',EXPORTSELECTED:'button[name="openstudio-export-selected"]',CHECKBOXS:'.openstudio-export-items input[type="checkbox"][data-contentid]'},init:async function(options){t.mconfig=options,t.dialogue=await t.createExportDialogue(),$(t.CSS.EXPORTBUTTON).on("click",(function(e){e.preventDefault(),t.dialogue.show()})),$(t.CSS.SELECTALLPOST).on("click",t.selectAll.bind(t)),$(t.CSS.SELECTNONE).on("click",t.selectNone.bind(t)),$(t.CSS.EXPORTSELECTED).on("click",t.exportSelected.bind(t)),$(t.CSS.CHECKBOXS).on("click",t.selectPost.bind(t))},createExportDialogue:async function(){const dialogue=await osDialogue.create({isVerticallyCentered:!0,templateContext:{extraClasses:t.CSS.BOUNDINGBOX.replace(".","")}});return function(dialogue){let headerString;Str.get_string("exportdialogheader","mod_openstudio").done((function(s){headerString=s})).always((function(){dialogue.setTitle('<span class="'+t.CSS.DIALOGHEADER.replace(".","")+'">'+headerString+"</span>")}))}(dialogue),function(dialogue){let bodyString,message;Str.get_strings([{key:"exportdialogcontent",component:"mod_openstudio"},{key:"export:emptycontent",component:"mod_openstudio"}]).done((function(s){bodyString=s[0],message=s[1]})).always((function(){bodyString+='<div class="'+t.CSS.EXPORTMESSAGE.replace(".","")+'"></div>',dialogue.setBody(bodyString),$(t.CSS.EXPORTMESSAGE).text(message)}))}(dialogue),function(dialogue){const exportAllBtnProperty={name:"exportall",classNames:"openstudio-exportall-btn",events:{click:t.exportAll.bind(t)}},exportSelectedBtnProperty={name:"exportselected",classNames:"openstudio-exportselected-btn",events:{click:function(){const contentIds=t.mconfig.contentids.join();contentIds?t.redirectPostRequest({url:SiteConfig.wwwroot+"/mod/openstudio/exportposts.php",data:{id:t.mconfig.id,vid:t.mconfig.vid,contentids:contentIds}}):$(t.CSS.EXPORTMESSAGE).show()}}},cancelBtnProperty={name:"cancel",classNames:"openstudio-cancelexport-btn",action:"hide"};Str.get_strings([{key:"exportall",component:"mod_openstudio"},{key:"exportselectedpost",component:"mod_openstudio"},{key:"modulejsdialogcancel",component:"mod_openstudio"}]).done((function(s){exportAllBtnProperty.label=s[0],exportSelectedBtnProperty.label=s[1],cancelBtnProperty.label=s[2]})).always((function(){dialogue.addButton(exportAllBtnProperty,["footer"]),dialogue.addButton(exportSelectedBtnProperty,["footer"]),dialogue.addButton(cancelBtnProperty,["footer"])}))}(dialogue),dialogue},exportAll:function(){var contentids=t.mconfig.contentids.join();contentids?t.redirectPostRequest({url:SiteConfig.wwwroot+"/mod/openstudio/export.php",data:{id:t.mconfig.id,contentids:contentids}}):$(t.CSS.EXPORTMESSAGE).show()},exportSelected:function(){var contentids=[];$(t.CSS.CHECKBOXS).each((function(){1==$(this).prop("checked")&&contentids.push($(this).data("contentid"))})),contentids.length>0&&t.redirectPostRequest({url:SiteConfig.wwwroot+"/mod/openstudio/export.php",data:{id:t.mconfig.id,contentids:contentids.join()}})},redirectPostRequest:function(options){var form=$("<form></form>");form.attr({method:"POST",action:options.url,style:"display: none;"}),$.each(options.data,(function(key,value){var field=$("<input/>");field.attr("type","hidden"),field.attr("name",key),field.attr("value",value),form.append(field)})),$(form).appendTo("body").submit()},selectAll:function(){$(t.CSS.CHECKBOXS).prop("checked",!0),$(t.CSS.SELECTALLPOST).addClass("disabled"),$(t.CSS.EXPORTSELECTED).removeClass("disabled"),$(t.CSS.SELECTNONE).removeClass("disabled")},selectNone:function(){$(t.CSS.CHECKBOXS).prop("checked",!1),$(t.CSS.SELECTALLPOST).removeClass("disabled"),$(t.CSS.EXPORTSELECTED).addClass("disabled"),$(t.CSS.SELECTNONE).addClass("disabled")},selectPost:function(){var uncheckBoxes=0,boxquantity=0;$(t.CSS.CHECKBOXS).each((function(){0==$(this).prop("checked")&&uncheckBoxes++,boxquantity++})),$(t.CSS.SELECTALLPOST).toggleClass("disabled",0==uncheckBoxes),$(t.CSS.SELECTNONE).toggleClass("disabled",uncheckBoxes==boxquantity),$(t.CSS.EXPORTSELECTED).toggleClass("disabled",uncheckBoxes==boxquantity)}}}));

//# sourceMappingURL=export.min.js.map