{"version":3,"file":"comment.min.js","sources":["../src/comment.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * JavaScript to manage comment feature.\r\n *\r\n * @package\r\n * @copyright 2017 The Open University\r\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n/**\r\n * @module mod_openstudio/comment\r\n */\r\ndefine([\r\n    'jquery',\r\n    'core/ajax',\r\n    'core/str',\r\n    'mod_openstudio/scrollto',\r\n    'require'\r\n], function($, Ajax, Str, Scrollto, require) {\r\n    var t;\r\n    t = {\r\n\r\n        /**\r\n         * Module config. Passed from server side.\r\n         * {\r\n         *     cmid: int,\r\n         *     cid: int\r\n         * }\r\n         */\r\n        mconfig: null,\r\n\r\n        /**\r\n         * Height from DOMElement to top browser.\r\n         */\r\n        HEIGHT_TO_TOP: 100,\r\n\r\n        /**\r\n         * List out all of css selector used in this module.\r\n         */\r\n        CSS: {\r\n            // Buttons.\r\n            ADD_NEW_BUTTON: '#id_addcomment',\r\n            REPLY_BUTTON: 'input[name=\"replycommentbutton\"]',\r\n            LIKE_BUTTON: '.openstudio-comment-flag-link',\r\n            DELETE_BUTTON: '.openstudio-comment-delete-link',\r\n            DELETE_CONFIRM_BUTTON: '.openstudio-comment-delete-btn',\r\n\r\n            // Forms.\r\n            COMMENT_FORM_CONTENT: '.openstudio-comment-form-content',\r\n            COMMENT_FORM: '.openstudio-comment-form', // Comment form wrapper.\r\n            COMMENT_REPLY_FORM: '.openstudio-comment-reply-form', // Reply form wrapper.\r\n            COMMENT_ATTACHMENT: '.openstudio-comment-form-content .filepicker-filename > a', // Attachment.\r\n\r\n            // Stream.\r\n            COMMENT_THREAD: '.openstudio-comment-thread', // Comment thread wrapper.\r\n            COMMENT_THREAD_BODY: '.openstudio-comment-thread-body', // Comment thread items wrapper.\r\n            REPLY_THREAD: '.openstudio-comment-thread-replied-items', // Reply items wrapper.\r\n            COMMENT_ITEM: '.openstudio-comment-thread-item', // Comment item.\r\n            FLAG_COUNT: '.openstudio-comment-flag-count',\r\n            FLAG_STATUS: '.openstudio-comment-flag-status',\r\n\r\n            // Dialogue.\r\n            DIALOG_HEADER: '.openstudio-comment-delete-header',\r\n            BOUNDING_BOX: '.openstudio-comment-dialogue-container' // Dialogue wrapper.\r\n\r\n        },\r\n\r\n        SELECTOR: {\r\n            COMMENT_BOX_ID: '#id_commentext', // Comment box ID.\r\n        },\r\n\r\n        /**\r\n         * Initialize module.\r\n         *\r\n         * @method init\r\n         * @param {JSON} options  The settings for this feature.\r\n         */\r\n        init: function(options) {\r\n\r\n            t.mconfig = options;\r\n\r\n            // Create delete dialog.\r\n            Y.use('moodle-core-notification-dialogue', function() {\r\n                require(['mod_openstudio/osdialogue'], function(osDialogue) {\r\n                    t.dialogue = t.createDeleteCommentDialogue(osDialogue);\r\n                });\r\n            });\r\n\r\n            // Click event on buttons.\r\n            // Add new button.\r\n            $(t.CSS.ADD_NEW_BUTTON).on('click', t.showCommentForm.bind(t));\r\n\r\n            $('body')\r\n                // Reply button.\r\n                .delegate(t.CSS.REPLY_BUTTON, 'click', t.showReplyForm)\r\n                // Like button.\r\n                .delegate(t.CSS.LIKE_BUTTON, 'click', t.likeComment)\r\n                // Delete button.\r\n                .delegate(t.CSS.DELETE_BUTTON, 'click', t.deleteConfirm)\r\n                // Delete confirm button.\r\n                .delegate(t.CSS.DELETE_CONFIRM_BUTTON, 'click', t.deleteComment);\r\n\r\n            // Form submit event.\r\n            $(t.CSS.COMMENT_FORM).find('form').on('submit', t.postComment);\r\n\r\n            // Resize event.\r\n            $(window).resize(t.resize);\r\n        },\r\n\r\n        /**\r\n         * Focus textarea.\r\n         *\r\n         * @param {String} textAreaId\r\n         */\r\n        focusTextArea: function(textAreaId) {\r\n            const atto = $(textAreaId + 'editable');\r\n            atto.attr('contenteditable', 'true');\r\n            atto.focus();\r\n        },\r\n\r\n        /**\r\n         * Show comment form\r\n         *\r\n         * @method showCommentForm\r\n         */\r\n        showCommentForm: function() {\r\n            // Append form to comment form wrapper.\r\n            $(t.CSS.COMMENT_FORM_CONTENT).appendTo(t.CSS.COMMENT_FORM);\r\n\r\n            // Adjust form state.\r\n            $(t.CSS.COMMENT_FORM_CONTENT).show(); // Show form content.\r\n            t.resetForm(); // Reset form.\r\n            $(t.CSS.ADD_NEW_BUTTON).hide(); // Hide add new comment button.\r\n            $(t.CSS.COMMENT_REPLY_FORM).hide(); // Hide comment reply forms.\r\n\r\n            // Set focus on comment form.\r\n            $('#openstudio_comment_form').focus();\r\n            t.focusTextArea(t.SELECTOR.COMMENT_BOX_ID);\r\n        },\r\n\r\n        /**\r\n         * Show reply form\r\n         *\r\n         * @method showReplyForm\r\n         */\r\n        showReplyForm: function() {\r\n            // Append form to reply form wrapper.\r\n            var commentid = $(this).data('comment-parent').trim();\r\n            var replyform = $(t.CSS.COMMENT_THREAD)\r\n                .filter(function() {\r\n                    return $(this).data('thread-items') == commentid;\r\n                })\r\n                .find(t.CSS.COMMENT_REPLY_FORM);\r\n            $(t.CSS.COMMENT_FORM_CONTENT).appendTo(replyform);\r\n            replyform.show();\r\n\r\n            // Adjust form state.\r\n            $(t.CSS.COMMENT_FORM_CONTENT).show(); // Show form content.\r\n            t.resetForm(); // Reset form.\r\n            $(t.CSS.ADD_NEW_BUTTON).show(); // Show add new comment button.\r\n            // Assign comment id to inreplyto field.\r\n            $(t.CSS.COMMENT_FORM_CONTENT).find('form input[name=\"inreplyto\"]').val(parseInt(commentid));\r\n\r\n            // Scroll to form.\r\n            Scrollto.scrollToEl(replyform, t.HEIGHT_TO_TOP);\r\n        },\r\n\r\n        /**\r\n         * Reset form.\r\n         *\r\n         * @method resetForm\r\n         */\r\n        resetForm: function() {\r\n            // Reset comment text field.\r\n            $(t.CSS.COMMENT_FORM_CONTENT).find('.editor_atto_content').html('');\r\n            // Reset inreplyto field.\r\n            $(t.CSS.COMMENT_FORM_CONTENT).find('form input[name=\"inreplyto\"]').val(0);\r\n            $(t.CSS.COMMENT_FORM_CONTENT).find('form').get(0).reset();\r\n            // Reset attachment field. Just a hack on UI.\r\n            $(t.CSS.COMMENT_ATTACHMENT).remove();\r\n        },\r\n\r\n        /**\r\n         * Add a new comment or reply a comment.\r\n         *\r\n         * @param {Object} e DomEvent\r\n         * @method postComment\r\n         */\r\n        postComment: function(e) {\r\n            // Prevent default form submit event.\r\n            e.preventDefault();\r\n            e.stopImmediatePropagation();\r\n\r\n            // Get form data.\r\n            var formdata = {};\r\n            $.each($(this).serializeArray(), function(i, field) {\r\n                formdata[field.name] = field.value;\r\n            });\r\n            var hasAttachment = $(t.CSS.COMMENT_ATTACHMENT).length > 0;\r\n\r\n            // Prevent from submitting to server if no content of comment is found.\r\n            if (!hasAttachment && formdata['commentext[text]'].length == 0) {\r\n                return;\r\n            }\r\n\r\n            M.util.js_pending('openstudioPostComment');\r\n            var promises = Ajax.call([{\r\n                methodname: 'mod_openstudio_external_add_comment',\r\n                args: {\r\n                    cmid: formdata.cmid,\r\n                    cid: formdata.cid,\r\n                    inreplyto: parseInt(formdata.inreplyto.trim()),\r\n                    commenttext: formdata['commentext[text]'],\r\n                    commentattachment: hasAttachment ? formdata.commentattachment : 0\r\n                }\r\n            }]);\r\n\r\n            promises[0]\r\n                .done(function(res) {\r\n                    // Adjust form state.\r\n                    $(t.CSS.ADD_NEW_BUTTON).show(); // Show add new comment button.\r\n                    $(t.CSS.COMMENT_FORM_CONTENT).hide(); // Hide comment form.\r\n                    $(t.CSS.COMMENT_REPLY_FORM).hide(); // Show reply form.\r\n\r\n                    var commentparent = parseInt(formdata.inreplyto.trim());\r\n                    if (commentparent) { // New reply for a certain comment thread.\r\n\r\n                        // Append new reply to comment thread.\r\n                        $(t.CSS.COMMENT_THREAD)\r\n                            .filter(function() {\r\n                                return $(this).data('thread-items') == commentparent;\r\n                            })\r\n                            .find(t.CSS.REPLY_THREAD)\r\n                            .find(t.CSS.COMMENT_ITEM)\r\n                            .last()\r\n                            .before(res.commenthtml);\r\n\r\n                        // Scroll to added item.\r\n                        Scrollto.scrollToEl($('[data-thread-item=\"' + res.commentid + '\"]'), t.HEIGHT_TO_TOP);\r\n\r\n                    } else { // New comment added.\r\n\r\n                        // Append new comment to comment thread.\r\n                        $(t.CSS.COMMENT_THREAD_BODY).append(res.commenthtml);\r\n\r\n                        // Scroll to added item.\r\n                        Scrollto.scrollToEl($('[data-thread-items=\"' + res.commentid + '\"]'), t.HEIGHT_TO_TOP);\r\n                    }\r\n\r\n                    t.resize();\r\n\r\n                    $(t.CSS.COMMENT_THREAD).show();\r\n\r\n                    // Set focus on comment form.\r\n                    $('#openstudio_comment_form').focus();\r\n\r\n                    // Trigger oumedia plugin to render audio attachment.\r\n                    if (window.oump) {\r\n                        window.oump.harvest();\r\n                    }\r\n                })\r\n                .always(function() {\r\n                    M.util.js_complete('openstudioPostComment');\r\n                })\r\n                .fail(function(ex) {\r\n                    window.console.error('Log request failed ' + ex.message);\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Like comment\r\n         *\r\n         * @param {object} e DomEvent\r\n         * @method likeComment\r\n         */\r\n        likeComment: function(e) {\r\n            e.preventDefault();\r\n            var likebtn = $(this);\r\n\r\n            M.util.js_pending('openstudioLikeComment');\r\n            var promises = Ajax.call([{\r\n                methodname: 'mod_openstudio_external_flag_comment',\r\n                args: {\r\n                    cmid: t.mconfig.cmid,\r\n                    cid: t.mconfig.cid,\r\n                    commentid: likebtn.data('comment-id')\r\n                }\r\n            }]);\r\n\r\n            promises[0]\r\n                .done(function(res) {\r\n                    likebtn\r\n                        .hide()\r\n                        // Update flag count.\r\n                        .siblings(t.CSS.FLAG_STATUS + '.flagged').children(t.CSS.FLAG_COUNT).addClass('flagged').text(res.count)\r\n                        // Update flag status.\r\n                        .parent().removeClass('openstudio-hidden')\r\n                        .siblings(t.CSS.FLAG_STATUS + '.unflagged').addClass('openstudio-hidden');\r\n                })\r\n                .always(function() {\r\n                    M.util.js_complete('openstudioLikeComment');\r\n                })\r\n                .fail(function(ex) {\r\n                    window.console.error('Log request failed ' + ex.message);\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Delete comment\r\n         *\r\n         * @method deleteComment\r\n         */\r\n        deleteComment: function() {\r\n            var commentid = parseInt($(this).attr('data-comment-id'));\r\n\r\n            M.util.js_pending('openstudioDeleteComment');\r\n            var promises = Ajax.call([{\r\n                methodname: 'mod_openstudio_external_delete_comment',\r\n                args: {\r\n                    cmid: t.mconfig.cmid,\r\n                    commentid: commentid\r\n                }\r\n            }]);\r\n\r\n            promises[0]\r\n                .done(function() {\r\n                    // Move comment form to another place to avoid form removed.\r\n                    $(t.CSS.COMMENT_FORM_CONTENT).appendTo(t.CSS.COMMENT_FORM);\r\n\r\n                    var commenttream = $('[data-thread-items=\"' + commentid + '\"]');\r\n                    var replyitem = $('[data-thread-item=\"' + commentid + '\"]');\r\n\r\n                    if (commenttream.length > 0) {\r\n                        // Removing comment thread means reply items of it removed also.\r\n                        commenttream.remove();\r\n                    } else {\r\n                        // Remove reply item.\r\n                        replyitem.remove();\r\n                    }\r\n\r\n                    // Check if there is a comment thread at least.\r\n                    if ($('div[data-thread-items]').length == 0) {\r\n                        // If there is no comment thread, then hide comment feature in UI.\r\n                        $(t.CSS.COMMENT_THREAD).hide();\r\n                    }\r\n\r\n                    // Hide delete dialogue.\r\n                    t.dialogue.hide();\r\n\r\n                    // Set focus on comment form.\r\n                    t.dialogue.after('visibleChange', function() {\r\n                        $('#openstudio_comment_form').focus();\r\n                    }, t.dialogue);\r\n                })\r\n                .always(function() {\r\n                    M.util.js_complete('openstudioDeleteComment');\r\n                })\r\n                .fail(function(ex) {\r\n                    window.console.error('Log request failed ' + ex.message);\r\n                });\r\n        },\r\n\r\n        /**\r\n         * Create delete comment dialogue and some events on it.\r\n         *\r\n         * @param {object} osDialogue object\r\n         * @return {object} OSDialogue instance\r\n         * @method createDeleteCommentDialogue\r\n         */\r\n        createDeleteCommentDialogue: function(osDialogue) {\r\n            var folderClass = '';\r\n            if (t.mconfig.folder) {\r\n                folderClass = 'openstudio-folder';\r\n            }\r\n            var dialogue = new osDialogue({\r\n                closeButton: true,\r\n                visible: false,\r\n                centered: true,\r\n                responsive: true,\r\n                responsiveWidth: 767,\r\n                modal: true,\r\n                focusOnPreviousTargetAfterHide: true,\r\n                width: 521,\r\n                extraClasses: [t.CSS.BOUNDING_BOX.replace('.', ''), folderClass]\r\n            });\r\n\r\n            // Button [Cancel]\r\n            var cancelBtnProperty = {\r\n                name: 'cancel',\r\n                classNames: 'openstudio-cancel-btn',\r\n                action: 'hide'\r\n            };\r\n            // Button [Delete]\r\n            var deleteBtnProperty = {\r\n                name: 'delete',\r\n                classNames: t.CSS.DELETE_CONFIRM_BUTTON.replace('.', '')\r\n            };\r\n            Str\r\n                .get_strings([\r\n                    {key: 'contentcommentsdelete', component: 'mod_openstudio'},\r\n                    {key: 'modulejsdialogcommentdeleteconfirm', component: 'mod_openstudio'},\r\n                    {key: 'modulejsdialogcancel', component: 'mod_openstudio'},\r\n                    {key: 'modulejsdialogdelete', component: 'mod_openstudio'}\r\n                ])\r\n                .done(function(s) {\r\n                    cancelBtnProperty.label = s[2];\r\n                    deleteBtnProperty.label = s[3];\r\n\r\n                    dialogue.set('headerContent',\r\n                        '<span class=\"openstudio-dialogue-common-header ' + t.CSS.DIALOG_HEADER.replace('.', '') +\r\n                        '\">' + s[0] + '</span>');\r\n                    dialogue.set('bodyContent', s[1]);\r\n                    dialogue.addButton(deleteBtnProperty, ['footer']);\r\n                    dialogue.addButton(cancelBtnProperty, ['footer']);\r\n                });\r\n\r\n            return dialogue;\r\n        },\r\n\r\n        /**\r\n         * Delete confirmation.\r\n         *\r\n         * @param {Object} e DomEvent\r\n         * @method deleteConfirm\r\n         */\r\n        deleteConfirm: function(e) {\r\n            e.preventDefault();\r\n            if (t.dialogue) {\r\n                // Update comment id for delete button.\r\n                $(t.CSS.DELETE_CONFIRM_BUTTON).attr('data-comment-id', $(this).data('comment-id'));\r\n                // Show delete dialogue.\r\n                t.dialogue.show();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Resize and update dialogue position.\r\n         * @method resize\r\n         */\r\n        resize: function() {\r\n            if (!t.dialogue) {\r\n                return;\r\n            }\r\n\r\n            if (t.dialogue.get('visible')) {\r\n                if (Y.one('body').get('winWidth') <= t.dialogue.get('responsiveWidth')) {\r\n                    t.dialogue.makeResponsive();\r\n                } else {\r\n                    t.dialogue.centerDialogue();\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    return t;\r\n});\r\n"],"names":["define","$","Ajax","Str","Scrollto","require","t","mconfig","HEIGHT_TO_TOP","CSS","ADD_NEW_BUTTON","REPLY_BUTTON","LIKE_BUTTON","DELETE_BUTTON","DELETE_CONFIRM_BUTTON","COMMENT_FORM_CONTENT","COMMENT_FORM","COMMENT_REPLY_FORM","COMMENT_ATTACHMENT","COMMENT_THREAD","COMMENT_THREAD_BODY","REPLY_THREAD","COMMENT_ITEM","FLAG_COUNT","FLAG_STATUS","DIALOG_HEADER","BOUNDING_BOX","SELECTOR","COMMENT_BOX_ID","init","options","Y","use","osDialogue","dialogue","createDeleteCommentDialogue","on","showCommentForm","bind","delegate","showReplyForm","likeComment","deleteConfirm","deleteComment","find","postComment","window","resize","focusTextArea","textAreaId","atto","attr","focus","appendTo","show","resetForm","hide","commentid","this","data","trim","replyform","filter","val","parseInt","scrollToEl","html","get","reset","remove","e","preventDefault","stopImmediatePropagation","formdata","each","serializeArray","i","field","name","value","hasAttachment","length","M","util","js_pending","call","methodname","args","cmid","cid","inreplyto","commenttext","commentattachment","done","res","commentparent","last","before","commenthtml","append","oump","harvest","always","js_complete","fail","ex","console","error","message","likebtn","siblings","children","addClass","text","count","parent","removeClass","commenttream","replyitem","after","folderClass","folder","closeButton","visible","centered","responsive","responsiveWidth","modal","focusOnPreviousTargetAfterHide","width","extraClasses","replace","cancelBtnProperty","classNames","action","deleteBtnProperty","get_strings","key","component","s","label","set","addButton","one","makeResponsive","centerDialogue"],"mappings":";;;;;;;AA0BAA,gCAAO,CACH,SACA,YACA,WACA,0BACA,YACD,SAASC,EAAGC,KAAMC,IAAKC,SAAUC,aAC5BC,SACJA,EAAI,CASAC,QAAS,KAKTC,cAAe,IAKfC,IAAK,CAEDC,eAAgB,iBAChBC,aAAc,mCACdC,YAAa,gCACbC,cAAe,kCACfC,sBAAuB,iCAGvBC,qBAAsB,mCACtBC,aAAc,2BACdC,mBAAoB,iCACpBC,mBAAoB,4DAGpBC,eAAgB,6BAChBC,oBAAqB,kCACrBC,aAAc,2CACdC,aAAc,kCACdC,WAAY,iCACZC,YAAa,kCAGbC,cAAe,oCACfC,aAAc,0CAIlBC,SAAU,CACNC,eAAgB,kBASpBC,KAAM,SAASC,SAEXxB,EAAEC,QAAUuB,QAGZC,EAAEC,IAAI,qCAAqC,WACvC3B,QAAQ,CAAC,8BAA8B,SAAS4B,YAC5C3B,EAAE4B,SAAW5B,EAAE6B,4BAA4BF,kBAMnDhC,EAAEK,EAAEG,IAAIC,gBAAgB0B,GAAG,QAAS9B,EAAE+B,gBAAgBC,KAAKhC,IAE3DL,EAAE,QAEGsC,SAASjC,EAAEG,IAAIE,aAAc,QAASL,EAAEkC,eAExCD,SAASjC,EAAEG,IAAIG,YAAa,QAASN,EAAEmC,aAEvCF,SAASjC,EAAEG,IAAII,cAAe,QAASP,EAAEoC,eAEzCH,SAASjC,EAAEG,IAAIK,sBAAuB,QAASR,EAAEqC,eAGtD1C,EAAEK,EAAEG,IAAIO,cAAc4B,KAAK,QAAQR,GAAG,SAAU9B,EAAEuC,aAGlD5C,EAAE6C,QAAQC,OAAOzC,EAAEyC,SAQvBC,cAAe,SAASC,kBACdC,KAAOjD,EAAEgD,WAAa,YAC5BC,KAAKC,KAAK,kBAAmB,QAC7BD,KAAKE,SAQTf,gBAAiB,WAEbpC,EAAEK,EAAEG,IAAIM,sBAAsBsC,SAAS/C,EAAEG,IAAIO,cAG7Cf,EAAEK,EAAEG,IAAIM,sBAAsBuC,OAC9BhD,EAAEiD,YACFtD,EAAEK,EAAEG,IAAIC,gBAAgB8C,OACxBvD,EAAEK,EAAEG,IAAIQ,oBAAoBuC,OAG5BvD,EAAE,4BAA4BmD,QAC9B9C,EAAE0C,cAAc1C,EAAEqB,SAASC,iBAQ/BY,cAAe,eAEPiB,UAAYxD,EAAEyD,MAAMC,KAAK,kBAAkBC,OAC3CC,UAAY5D,EAAEK,EAAEG,IAAIU,gBACnB2C,QAAO,kBACG7D,EAAEyD,MAAMC,KAAK,iBAAmBF,aAE1Cb,KAAKtC,EAAEG,IAAIQ,oBAChBhB,EAAEK,EAAEG,IAAIM,sBAAsBsC,SAASQ,WACvCA,UAAUP,OAGVrD,EAAEK,EAAEG,IAAIM,sBAAsBuC,OAC9BhD,EAAEiD,YACFtD,EAAEK,EAAEG,IAAIC,gBAAgB4C,OAExBrD,EAAEK,EAAEG,IAAIM,sBAAsB6B,KAAK,gCAAgCmB,IAAIC,SAASP,YAGhFrD,SAAS6D,WAAWJ,UAAWvD,EAAEE,gBAQrC+C,UAAW,WAEPtD,EAAEK,EAAEG,IAAIM,sBAAsB6B,KAAK,wBAAwBsB,KAAK,IAEhEjE,EAAEK,EAAEG,IAAIM,sBAAsB6B,KAAK,gCAAgCmB,IAAI,GACvE9D,EAAEK,EAAEG,IAAIM,sBAAsB6B,KAAK,QAAQuB,IAAI,GAAGC,QAElDnE,EAAEK,EAAEG,IAAIS,oBAAoBmD,UAShCxB,YAAa,SAASyB,GAElBA,EAAEC,iBACFD,EAAEE,+BAGEC,SAAW,GACfxE,EAAEyE,KAAKzE,EAAEyD,MAAMiB,kBAAkB,SAASC,EAAGC,OACzCJ,SAASI,MAAMC,MAAQD,MAAME,aAE7BC,cAAgB/E,EAAEK,EAAEG,IAAIS,oBAAoB+D,OAAS,GAGpDD,eAAwD,GAAvCP,SAAS,oBAAoBQ,UAInDC,EAAEC,KAAKC,WAAW,yBACHlF,KAAKmF,KAAK,CAAC,CACtBC,WAAY,sCACZC,KAAM,CACFC,KAAMf,SAASe,KACfC,IAAKhB,SAASgB,IACdC,UAAW1B,SAASS,SAASiB,UAAU9B,QACvC+B,YAAalB,SAAS,oBACtBmB,kBAAmBZ,cAAgBP,SAASmB,kBAAoB,MAI/D,GACJC,MAAK,SAASC,KAEX7F,EAAEK,EAAEG,IAAIC,gBAAgB4C,OACxBrD,EAAEK,EAAEG,IAAIM,sBAAsByC,OAC9BvD,EAAEK,EAAEG,IAAIQ,oBAAoBuC,WAExBuC,cAAgB/B,SAASS,SAASiB,UAAU9B,QAC5CmC,eAGA9F,EAAEK,EAAEG,IAAIU,gBACH2C,QAAO,kBACG7D,EAAEyD,MAAMC,KAAK,iBAAmBoC,iBAE1CnD,KAAKtC,EAAEG,IAAIY,cACXuB,KAAKtC,EAAEG,IAAIa,cACX0E,OACAC,OAAOH,IAAII,aAGhB9F,SAAS6D,WAAWhE,EAAE,sBAAwB6F,IAAIrC,UAAY,MAAOnD,EAAEE,iBAKvEP,EAAEK,EAAEG,IAAIW,qBAAqB+E,OAAOL,IAAII,aAGxC9F,SAAS6D,WAAWhE,EAAE,uBAAyB6F,IAAIrC,UAAY,MAAOnD,EAAEE,gBAG5EF,EAAEyC,SAEF9C,EAAEK,EAAEG,IAAIU,gBAAgBmC,OAGxBrD,EAAE,4BAA4BmD,QAG1BN,OAAOsD,MACPtD,OAAOsD,KAAKC,aAGnBC,QAAO,WACJpB,EAAEC,KAAKoB,YAAY,4BAEtBC,MAAK,SAASC,IACX3D,OAAO4D,QAAQC,MAAM,sBAAwBF,GAAGG,cAU5DnE,YAAa,SAAS6B,GAClBA,EAAEC,qBACEsC,QAAU5G,EAAEyD,MAEhBwB,EAAEC,KAAKC,WAAW,yBACHlF,KAAKmF,KAAK,CAAC,CACtBC,WAAY,uCACZC,KAAM,CACFC,KAAMlF,EAAEC,QAAQiF,KAChBC,IAAKnF,EAAEC,QAAQkF,IACfhC,UAAWoD,QAAQlD,KAAK,kBAIvB,GACJkC,MAAK,SAASC,KACXe,QACKrD,OAEAsD,SAASxG,EAAEG,IAAIe,YAAc,YAAYuF,SAASzG,EAAEG,IAAIc,YAAYyF,SAAS,WAAWC,KAAKnB,IAAIoB,OAEjGC,SAASC,YAAY,qBACrBN,SAASxG,EAAEG,IAAIe,YAAc,cAAcwF,SAAS,wBAE5DV,QAAO,WACJpB,EAAEC,KAAKoB,YAAY,4BAEtBC,MAAK,SAASC,IACX3D,OAAO4D,QAAQC,MAAM,sBAAwBF,GAAGG,aAS5DjE,cAAe,eACPc,UAAYO,SAAS/D,EAAEyD,MAAMP,KAAK,oBAEtC+B,EAAEC,KAAKC,WAAW,2BACHlF,KAAKmF,KAAK,CAAC,CACtBC,WAAY,yCACZC,KAAM,CACFC,KAAMlF,EAAEC,QAAQiF,KAChB/B,UAAWA,cAIV,GACJoC,MAAK,WAEF5F,EAAEK,EAAEG,IAAIM,sBAAsBsC,SAAS/C,EAAEG,IAAIO,kBAEzCqG,aAAepH,EAAE,uBAAyBwD,UAAY,MACtD6D,UAAYrH,EAAE,sBAAwBwD,UAAY,MAElD4D,aAAapC,OAAS,EAEtBoC,aAAahD,SAGbiD,UAAUjD,SAI4B,GAAtCpE,EAAE,0BAA0BgF,QAE5BhF,EAAEK,EAAEG,IAAIU,gBAAgBqC,OAI5BlD,EAAE4B,SAASsB,OAGXlD,EAAE4B,SAASqF,MAAM,iBAAiB,WAC9BtH,EAAE,4BAA4BmD,UAC/B9C,EAAE4B,aAERoE,QAAO,WACJpB,EAAEC,KAAKoB,YAAY,8BAEtBC,MAAK,SAASC,IACX3D,OAAO4D,QAAQC,MAAM,sBAAwBF,GAAGG,aAW5DzE,4BAA6B,SAASF,gBAC9BuF,YAAc,GACdlH,EAAEC,QAAQkH,SACVD,YAAc,yBAEdtF,SAAW,IAAID,WAAW,CAC1ByF,aAAa,EACbC,SAAS,EACTC,UAAU,EACVC,YAAY,EACZC,gBAAiB,IACjBC,OAAO,EACPC,gCAAgC,EAChCC,MAAO,IACPC,aAAc,CAAC5H,EAAEG,IAAIiB,aAAayG,QAAQ,IAAK,IAAKX,eAIpDY,kBAAoB,CACpBtD,KAAM,SACNuD,WAAY,wBACZC,OAAQ,QAGRC,kBAAoB,CACpBzD,KAAM,SACNuD,WAAY/H,EAAEG,IAAIK,sBAAsBqH,QAAQ,IAAK,YAEzDhI,IACKqI,YAAY,CACT,CAACC,IAAK,wBAAyBC,UAAW,kBAC1C,CAACD,IAAK,qCAAsCC,UAAW,kBACvD,CAACD,IAAK,uBAAwBC,UAAW,kBACzC,CAACD,IAAK,uBAAwBC,UAAW,oBAE5C7C,MAAK,SAAS8C,GACXP,kBAAkBQ,MAAQD,EAAE,GAC5BJ,kBAAkBK,MAAQD,EAAE,GAE5BzG,SAAS2G,IAAI,gBACT,kDAAoDvI,EAAEG,IAAIgB,cAAc0G,QAAQ,IAAK,IACrF,KAAOQ,EAAE,GAAK,WAClBzG,SAAS2G,IAAI,cAAeF,EAAE,IAC9BzG,SAAS4G,UAAUP,kBAAmB,CAAC,WACvCrG,SAAS4G,UAAUV,kBAAmB,CAAC,cAGxClG,UASXQ,cAAe,SAAS4B,GACpBA,EAAEC,iBACEjE,EAAE4B,WAEFjC,EAAEK,EAAEG,IAAIK,uBAAuBqC,KAAK,kBAAmBlD,EAAEyD,MAAMC,KAAK,eAEpErD,EAAE4B,SAASoB,SAQnBP,OAAQ,WACCzC,EAAE4B,UAIH5B,EAAE4B,SAASiC,IAAI,aACXpC,EAAEgH,IAAI,QAAQ5E,IAAI,aAAe7D,EAAE4B,SAASiC,IAAI,mBAChD7D,EAAE4B,SAAS8G,iBAEX1I,EAAE4B,SAAS+G"}