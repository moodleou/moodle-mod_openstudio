{"version":3,"file":"comment.min.js","sources":["../src/comment.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript to manage comment feature.\n *\n * @package\n * @copyright 2017 The Open University\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_openstudio/comment\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/str',\n    'mod_openstudio/scrollto',\n    'core/notification',\n    'core_form/changechecker',\n    'core/fragment',\n    'core/templates',\n    'mod_openstudio/osdialogue',\n    'core/modal_events',\n], function($, Ajax, Str, Scrollto, Notification, FormChangeChecker,\n            Fragment, Templates, osDialogue, ModalEvents) {\n    var t;\n    t = {\n\n        /**\n         * Module config. Passed from server side.\n         * {\n         *     cmid: int,\n         *     cid: int\n         * }\n         */\n        mconfig: null,\n\n        /**\n         * Delete comment dialogue instance.\n         */\n        dialogue: null,\n\n        /**\n         * Height from DOMElement to top browser.\n         */\n        HEIGHT_TO_TOP: 100,\n\n        /**\n         * List out all of css selector used in this module.\n         */\n        CSS: {\n            // Buttons.\n            ADD_NEW_BUTTON: '#id_addcomment',\n            REPLY_BUTTON: 'input[name=\"replycommentbutton\"]',\n            LIKE_BUTTON: '.openstudio-comment-flag-link',\n            DELETE_BUTTON: '.openstudio-comment-delete-link',\n            DELETE_CONFIRM_BUTTON: '.openstudio-comment-delete-btn',\n\n            // Forms.\n            COMMENT_FORM_CONTENT: '.openstudio-comment-form-content',\n            COMMENT_FORM: '.openstudio-comment-form', // Comment form wrapper.\n            COMMENT_REPLY_FORM: '.openstudio-comment-reply-form', // Reply form wrapper.\n            COMMENT_ATTACHMENT: '.openstudio-comment-form-content .filepicker-filename > a', // Attachment.\n            COMMENT_FORM_BODY: '.openstudio-comment-form-body',\n            COMMENT_POST_BUTTON: '#id_postcomment',\n            COMMENT_LOADING: '.openstudio-comment-loading',\n\n            // Stream.\n            COMMENT_THREAD: '.openstudio-comment-thread', // Comment thread wrapper.\n            COMMENT_THREAD_BODY: '.openstudio-comment-thread-body', // Comment thread items wrapper.\n            REPLY_THREAD: '.openstudio-comment-thread-replied-items', // Reply items wrapper.\n            COMMENT_ITEM: '.openstudio-comment-thread-item', // Comment item.\n            FLAG_COUNT: '.openstudio-comment-flag-count',\n            FLAG_STATUS: '.openstudio-comment-flag-status',\n\n            // Dialogue.\n            DIALOG_HEADER: '.openstudio-comment-delete-header',\n            BOUNDING_BOX: '.openstudio-comment-dialogue-container' // Dialogue wrapper.\n\n        },\n\n        SELECTOR: {\n            COMMENT_BOX_ID: '#id_commentext', // Comment box ID.\n        },\n\n        /**\n         * Initialize module.\n         *\n         * @method init\n         * @param {JSON} options  The settings for this feature.\n         */\n        init: async function(options) {\n\n            t.mconfig = options;\n\n            t.dialogue = await t.createDeleteCommentDialogue();\n\n            // Click event on buttons.\n            // Add new button.\n            $(t.CSS.ADD_NEW_BUTTON).on('click', t.showCommentForm.bind(t));\n\n            $('body')\n                // Reply button.\n                .delegate(t.CSS.REPLY_BUTTON, 'click', t.showReplyForm)\n                // Like button.\n                .delegate(t.CSS.LIKE_BUTTON, 'click', t.likeComment)\n                // Delete button.\n                .delegate(t.CSS.DELETE_BUTTON, 'click', t.deleteConfirm)\n                // Delete confirm button.\n                .delegate(t.CSS.DELETE_CONFIRM_BUTTON, 'click', t.deleteComment);\n\n            // Form submit event.\n            $(t.CSS.COMMENT_FORM).find('form').on('submit', t.postComment);\n        },\n\n        /**\n         * Focus textarea.\n         *\n         * @param {String} textAreaId\n         */\n        focusTextArea: function(textAreaId) {\n            const atto = $(textAreaId + 'editable');\n            atto.attr('contenteditable', 'true');\n            atto.focus();\n        },\n\n        /**\n         * Show comment form\n         *\n         * @method showCommentForm\n         */\n        showCommentForm: function() {\n            // Adjust form state.\n            $(t.CSS.COMMENT_FORM_CONTENT).show(); // Show form content.\n            t.resetForm(); // Reset form.\n            $(t.CSS.ADD_NEW_BUTTON).hide(); // Hide add new comment button.\n            $(t.CSS.COMMENT_REPLY_FORM).hide(); // Hide comment reply forms.\n\n            // Set focus on comment form.\n            $('#openstudio_comment_form').focus();\n            t.focusTextArea(t.SELECTOR.COMMENT_BOX_ID);\n        },\n\n        /**\n         * Show reply form\n         *\n         * @method showReplyForm\n         */\n        showReplyForm: function() {\n            // Hide all comment reply forms.\n            $(t.CSS.COMMENT_REPLY_FORM).hide();\n            $(t.CSS.COMMENT_FORM).find(t.CSS.COMMENT_FORM_CONTENT).hide();\n            // Show add new comment button.\n            $(t.CSS.ADD_NEW_BUTTON).show();\n            // Append form to reply form wrapper.\n            var commentid = $(this).data('comment-parent').trim();\n            var replyform = $(t.CSS.COMMENT_THREAD)\n                .filter(function() {\n                    return $(this).data('thread-items') == commentid;\n                })\n                .find(t.CSS.COMMENT_REPLY_FORM);\n            replyform.show();\n            if (!replyform.find('form').length) {\n                var loading = $(t.CSS.COMMENT_LOADING).clone().show();\n                replyform.append(loading); // Show loading.\n                // Load fragment form.\n                M.util.js_pending('openstudioloadfragmentform');\n                var appendselector = replyform.find(t.CSS.COMMENT_FORM_BODY);\n                t.loadFragmentForm(commentid).then(function(html, js) {\n                    Templates.replaceNodeContents(appendselector, html, js);\n                    appendselector.find('form').submit(function(e) {\n                        e.preventDefault();\n                    });\n                    appendselector.find('form').on('submit', t.postComment);\n                    // Remove loading.\n                    replyform.find(t.CSS.COMMENT_LOADING).remove();\n                    M.util.js_complete('openstudioloadfragmentform');\n                }).then(function(){\n                    t.showReplyFormPostProcess(replyform, commentid);\n                }.bind(t)).fail(Notification.exception);\n            } else {\n                t.showReplyFormPostProcess(replyform, commentid);\n            }\n        },\n\n        /**\n         * Show reply form post process.\n         *\n         * @param {object} replyForm\n         * @param {string} commentId\n         * @method showReplyFormPostProcess\n         */\n        showReplyFormPostProcess: function(replyForm, commentId) {\n            // Adjust form state.\n            replyForm.find(t.CSS.COMMENT_FORM_CONTENT).show();\n            // Reset form.\n            t.resetForm();\n            // Assign comment id to inreplyto field.\n            replyForm.find('form input[name=\"inreplyto\"]').val(parseInt(commentId));\n            // Scroll to form.\n            Scrollto.scrollToEl(replyForm, t.HEIGHT_TO_TOP);\n        },\n\n        /**\n         * Call web services to get the fragment form, append to the DOM then bind event.\n         * @param {string} commentId\n         * @return {Promise}\n         * @method loadFragmentForm\n         */\n        loadFragmentForm: function(commentId) {\n            var params = [];\n            params.id = t.mconfig.cmid;\n            params.cid = t.mconfig.cid;\n            params.max_bytes = t.mconfig.max_bytes;\n            params.attachmentenable = t.mconfig.attachmentenable;\n            if (commentId) {\n                params.replyid = commentId;\n            }\n            return Fragment.loadFragment('mod_openstudio', 'commentform', t.mconfig.contextid, params);\n        },\n\n        /**\n         * Reset form.\n         *\n         * @method resetForm\n         */\n        resetForm: function() {\n            // Reset comment text field.\n            $(t.CSS.COMMENT_FORM_CONTENT).find('.editor_atto_content').html('');\n            // Reset inreplyto field.\n            $(t.CSS.COMMENT_FORM_CONTENT).find('form input[name=\"inreplyto\"]').val(0);\n            setTimeout(function() {\n                if (window.tinyMCE && window.tinyMCE.activeEditor) {\n                    window.tinyMCE.activeEditor.setContent('');\n                }\n                $(t.CSS.COMMENT_FORM_CONTENT + ':visible').find('form').get(0).reset();\n            }, 0);\n            // Reset attachment field. Just a hack on UI.\n            $(t.CSS.COMMENT_ATTACHMENT).remove();\n        },\n\n        /**\n         * Add a new comment or reply a comment.\n         *\n         * @param {Object} e DomEvent\n         * @method postComment\n         */\n        postComment: function(e) {\n            // Prevent default form submit event.\n            e.preventDefault();\n            e.stopImmediatePropagation();\n\n            // Get form data.\n            var formdata = {};\n            $.each($(this).serializeArray(), function(i, field) {\n                formdata[field.name] = field.value;\n            });\n            var hasAttachment = $(t.CSS.COMMENT_ATTACHMENT).length > 0;\n\n            // Prevent from submitting to server if no content of comment is found.\n            if (!hasAttachment && formdata['commentext[text]'].length == 0) {\n                return;\n            }\n\n            M.util.js_pending('openstudioPostComment');\n            var promises = Ajax.call([{\n                methodname: 'mod_openstudio_external_add_comment',\n                args: {\n                    cmid: formdata.cmid,\n                    cid: formdata.cid,\n                    inreplyto: parseInt(formdata.inreplyto.trim()),\n                    commenttext: formdata['commentext[text]'],\n                    commenttextitemid: formdata['commentext[itemid]'],\n                    commentattachment: hasAttachment ? formdata.commentattachment : 0\n                }\n            }]);\n\n            promises[0]\n                .done(function(res) {\n                    // Adjust form state.\n                    $(t.CSS.ADD_NEW_BUTTON).show(); // Show add new comment button.\n                    $(t.CSS.COMMENT_FORM_CONTENT).hide(); // Hide comment form.\n                    $(t.CSS.COMMENT_REPLY_FORM).hide(); // Show reply form.\n\n                    var commentparent = parseInt(formdata.inreplyto.trim());\n                    if (commentparent) { // New reply for a certain comment thread.\n\n                        // Append new reply to comment thread.\n                        $(t.CSS.COMMENT_THREAD)\n                            .filter(function() {\n                                return $(this).data('thread-items') == commentparent;\n                            })\n                            .find(t.CSS.REPLY_THREAD)\n                            .find(t.CSS.COMMENT_ITEM)\n                            .last()\n                            .before(res.commenthtml);\n\n                        // Scroll to added item.\n                        Scrollto.scrollToEl($('[data-thread-item=\"' + res.commentid + '\"]'), t.HEIGHT_TO_TOP);\n\n                    } else { // New comment added.\n\n                        // Append new comment to comment thread.\n                        $(t.CSS.COMMENT_THREAD_BODY).append(res.commenthtml);\n\n                        // Scroll to added item.\n                        Scrollto.scrollToEl($('[data-thread-items=\"' + res.commentid + '\"]'), t.HEIGHT_TO_TOP);\n                    }\n\n                    $(t.CSS.COMMENT_THREAD).show();\n\n                    // Set focus on comment form.\n                    $('#openstudio_comment_form').focus();\n                    t.focusTextArea(t.SELECTOR.COMMENT_BOX_ID);\n\n                    // Trigger oumedia plugin to render audio attachment.\n                    if (window.oump) {\n                        window.oump.harvest();\n                    }\n                    // Reset the 'dirty' flag of the comment form.\n                    FormChangeChecker.resetFormDirtyState($(t.CSS.COMMENT_POST_BUTTON)[0]);\n                })\n                .always(function() {\n                    M.util.js_complete('openstudioPostComment');\n                })\n                .fail(Notification.exception);\n        },\n\n        /**\n         * Like comment\n         *\n         * @param {object} e DomEvent\n         * @method likeComment\n         */\n        likeComment: function(e) {\n            e.preventDefault();\n            var likebtn = $(this);\n\n            M.util.js_pending('openstudioLikeComment');\n            var promises = Ajax.call([{\n                methodname: 'mod_openstudio_external_flag_comment',\n                args: {\n                    cmid: t.mconfig.cmid,\n                    cid: t.mconfig.cid,\n                    commentid: likebtn.data('comment-id'),\n                    fid: t.mconfig.fid\n                }\n            }]);\n\n            promises[0]\n                .done(function(res) {\n                    let likeicon = likebtn.siblings(t.CSS.FLAG_STATUS + '.flagged');\n                    let notlikeicon = likebtn.siblings(t.CSS.FLAG_STATUS + '.unflagged');\n                    likebtn\n                        // Update flag count.\n                        .siblings(t.CSS.FLAG_STATUS).children(t.CSS.FLAG_COUNT).text(res.count)\n                        // Update flag status.\n                        .parent().removeClass('openstudio-hidden')\n                        .siblings(t.CSS.FLAG_STATUS).addClass('openstudio-hidden');\n                    if (res.count === 0) {\n                        let imageElement = likebtn.siblings(t.CSS.FLAG_STATUS).children('img');\n                        if (imageElement) {\n                            Str.get_string('contentcommentnotliked', 'mod_openstudio').then((value) => {\n                                imageElement[1].alt = value;\n                                imageElement[1].title = value;\n                            });\n                        }\n                    }\n                    // Show/hide opposite like/unlike links.\n                    likebtn.children().each(function() {\n                        var elem = $(this);\n                        if (elem.hasClass('openstudio-comment-like-long-link') ||\n                            elem.hasClass('openstudio-comment-like-short-link') ||\n                            elem.hasClass('openstudio-comment-unlike-long-link') ||\n                            elem.hasClass('openstudio-comment-unlike-short-link')) {\n                            if (elem.hasClass('openstudio-hidden')) {\n                                elem.removeClass('openstudio-hidden');\n                                likeicon.removeClass('openstudio-hidden');\n                                notlikeicon.addClass('openstudio-hidden');\n                            } else {\n                                elem.addClass('openstudio-hidden');\n                                likeicon.addClass('openstudio-hidden');\n                                notlikeicon.removeClass('openstudio-hidden');\n                            }\n                        }\n                    }, this);\n                })\n                .always(function() {\n                    M.util.js_complete('openstudioLikeComment');\n                })\n                .fail(function(ex) {\n                    window.console.error('Log request failed ' + ex.message);\n                });\n        },\n\n        /**\n         * Delete comment\n         *\n         * @method deleteComment\n         */\n        deleteComment: function() {\n            var commentid = parseInt($(this).attr('data-comment-id'));\n\n            M.util.js_pending('openstudioDeleteComment');\n            var promises = Ajax.call([{\n                methodname: 'mod_openstudio_external_delete_comment',\n                args: {\n                    cmid: t.mconfig.cmid,\n                    commentid: commentid\n                }\n            }]);\n\n            promises[0]\n                .done(function() {\n                    var commenttream = $('[data-thread-items=\"' + commentid + '\"]');\n                    var replyitem = $('[data-thread-item=\"' + commentid + '\"]');\n\n                    if (commenttream.length > 0) {\n                        // Removing comment thread means reply items of it removed also.\n                        commenttream.remove();\n                    } else {\n                        // Remove reply item.\n                        replyitem.remove();\n                    }\n\n                    // Check if there is a comment thread at least.\n                    if ($('div[data-thread-items]').length == 0) {\n                        // If there is no comment thread, then hide comment feature in UI.\n                        $(t.CSS.COMMENT_THREAD).hide();\n                    }\n\n                    // Set focus on comment form.\n                    t.dialogue.getRoot().on(ModalEvents.hidden, () =>  {\n                        $('#openstudio_comment_form').focus();\n                    });\n\n                    // Hide delete dialogue.\n                    t.dialogue.hide();\n                })\n                .always(function() {\n                    M.util.js_complete('openstudioDeleteComment');\n                })\n                .fail(function(ex) {\n                    window.console.error('Log request failed ' + ex.message);\n                });\n        },\n\n        /**\n         * Create delete comment dialogue and some events on it.\n         *\n         * @method createDeleteCommentDialogue\n         * @returns {Promise<Modal>}\n         */\n        createDeleteCommentDialogue: async function() {\n            let folderClass = '';\n            if (t.mconfig.folder) {\n                folderClass = 'openstudio-folder';\n            }\n            const dialogue = await osDialogue.create({\n                isVerticallyCentered: true,\n                templateContext: {\n                    extraClasses: t.CSS.BOUNDING_BOX.replace('.', '') + ' ' + folderClass,\n                },\n            });\n\n            // Button [Cancel].\n            const cancelBtnProperty = {\n                name: 'cancel',\n                classNames: 'openstudio-cancel-btn',\n                action: 'hide',\n            };\n            // Button [Delete].\n            const deleteBtnProperty = {\n                name: 'delete',\n                classNames: t.CSS.DELETE_CONFIRM_BUTTON.replace('.', ''),\n            };\n            Str\n                .get_strings([\n                    {key: 'contentcommentsdelete', component: 'mod_openstudio'},\n                    {key: 'modulejsdialogcommentdeleteconfirm', component: 'mod_openstudio'},\n                    {key: 'modulejsdialogcancel', component: 'mod_openstudio'},\n                    {key: 'modulejsdialogdelete', component: 'mod_openstudio'},\n                ])\n                .done(function(s) {\n                    cancelBtnProperty.label = s[2];\n                    deleteBtnProperty.label = s[3];\n\n                    dialogue.setTitle('<span class=\"openstudio-dialogue-common-header ' + t.CSS.DIALOG_HEADER.replace('.', '') +\n                        '\">' + s[0] + '</span>');\n                    dialogue.setBody(s[1]);\n                    dialogue.addButton(deleteBtnProperty, ['footer']);\n                    dialogue.addButton(cancelBtnProperty, ['footer']);\n                });\n\n            return dialogue;\n        },\n\n        /**\n         * Delete confirmation.\n         *\n         * @param {Object} e DomEvent\n         * @method deleteConfirm\n         */\n        deleteConfirm: function(e) {\n            e.preventDefault();\n            if (t.dialogue) {\n                // Show delete dialogue.\n                t.dialogue.show();\n                // Update comment id for delete button.\n                $(t.CSS.DELETE_CONFIRM_BUTTON).attr('data-comment-id', $(this).data('comment-id'));\n            }\n        },\n    };\n\n    return t;\n});\n"],"names":["define","$","Ajax","Str","Scrollto","Notification","FormChangeChecker","Fragment","Templates","osDialogue","ModalEvents","t","mconfig","dialogue","HEIGHT_TO_TOP","CSS","ADD_NEW_BUTTON","REPLY_BUTTON","LIKE_BUTTON","DELETE_BUTTON","DELETE_CONFIRM_BUTTON","COMMENT_FORM_CONTENT","COMMENT_FORM","COMMENT_REPLY_FORM","COMMENT_ATTACHMENT","COMMENT_FORM_BODY","COMMENT_POST_BUTTON","COMMENT_LOADING","COMMENT_THREAD","COMMENT_THREAD_BODY","REPLY_THREAD","COMMENT_ITEM","FLAG_COUNT","FLAG_STATUS","DIALOG_HEADER","BOUNDING_BOX","SELECTOR","COMMENT_BOX_ID","init","async","options","createDeleteCommentDialogue","on","showCommentForm","bind","delegate","showReplyForm","likeComment","deleteConfirm","deleteComment","find","postComment","focusTextArea","textAreaId","atto","attr","focus","show","resetForm","hide","commentid","this","data","trim","replyform","filter","length","showReplyFormPostProcess","loading","clone","append","M","util","js_pending","appendselector","loadFragmentForm","then","html","js","replaceNodeContents","submit","e","preventDefault","remove","js_complete","fail","exception","replyForm","commentId","val","parseInt","scrollToEl","params","id","cmid","cid","max_bytes","attachmentenable","replyid","loadFragment","contextid","setTimeout","window","tinyMCE","activeEditor","setContent","get","reset","stopImmediatePropagation","formdata","each","serializeArray","i","field","name","value","hasAttachment","call","methodname","args","inreplyto","commenttext","commenttextitemid","commentattachment","done","res","commentparent","last","before","commenthtml","oump","harvest","resetFormDirtyState","always","likebtn","fid","likeicon","siblings","notlikeicon","children","text","count","parent","removeClass","addClass","imageElement","get_string","alt","title","elem","hasClass","ex","console","error","message","commenttream","replyitem","getRoot","hidden","folderClass","folder","create","isVerticallyCentered","templateContext","extraClasses","replace","cancelBtnProperty","classNames","action","deleteBtnProperty","get_strings","key","component","s","label","setTitle","setBody","addButton"],"mappings":";;;;;;;AA0BAA,gCAAO,CACH,SACA,YACA,WACA,0BACA,oBACA,0BACA,gBACA,iBACA,4BACA,sBACD,SAASC,EAAGC,KAAMC,IAAKC,SAAUC,aAAcC,kBACtCC,SAAUC,UAAWC,WAAYC,iBACrCC,SACJA,EAAI,CASAC,QAAS,KAKTC,SAAU,KAKVC,cAAe,IAKfC,IAAK,CAEDC,eAAgB,iBAChBC,aAAc,mCACdC,YAAa,gCACbC,cAAe,kCACfC,sBAAuB,iCAGvBC,qBAAsB,mCACtBC,aAAc,2BACdC,mBAAoB,iCACpBC,mBAAoB,4DACpBC,kBAAmB,gCACnBC,oBAAqB,kBACrBC,gBAAiB,8BAGjBC,eAAgB,6BAChBC,oBAAqB,kCACrBC,aAAc,2CACdC,aAAc,kCACdC,WAAY,iCACZC,YAAa,kCAGbC,cAAe,oCACfC,aAAc,0CAIlBC,SAAU,CACNC,eAAgB,kBASpBC,KAAMC,eAAeC,SAEjB7B,EAAEC,QAAU4B,QAEZ7B,EAAEE,eAAiBF,EAAE8B,8BAIrBxC,EAAEU,EAAEI,IAAIC,gBAAgB0B,GAAG,QAAS/B,EAAEgC,gBAAgBC,KAAKjC,IAE3DV,EAAE,QAEG4C,SAASlC,EAAEI,IAAIE,aAAc,QAASN,EAAEmC,eAExCD,SAASlC,EAAEI,IAAIG,YAAa,QAASP,EAAEoC,aAEvCF,SAASlC,EAAEI,IAAII,cAAe,QAASR,EAAEqC,eAEzCH,SAASlC,EAAEI,IAAIK,sBAAuB,QAAST,EAAEsC,eAGtDhD,EAAEU,EAAEI,IAAIO,cAAc4B,KAAK,QAAQR,GAAG,SAAU/B,EAAEwC,cAQtDC,cAAe,SAASC,kBACdC,KAAOrD,EAAEoD,WAAa,YAC5BC,KAAKC,KAAK,kBAAmB,QAC7BD,KAAKE,SAQTb,gBAAiB,WAEb1C,EAAEU,EAAEI,IAAIM,sBAAsBoC,OAC9B9C,EAAE+C,YACFzD,EAAEU,EAAEI,IAAIC,gBAAgB2C,OACxB1D,EAAEU,EAAEI,IAAIQ,oBAAoBoC,OAG5B1D,EAAE,4BAA4BuD,QAC9B7C,EAAEyC,cAAczC,EAAEyB,SAASC,iBAQ/BS,cAAe,WAEX7C,EAAEU,EAAEI,IAAIQ,oBAAoBoC,OAC5B1D,EAAEU,EAAEI,IAAIO,cAAc4B,KAAKvC,EAAEI,IAAIM,sBAAsBsC,OAEvD1D,EAAEU,EAAEI,IAAIC,gBAAgByC,WAEpBG,UAAY3D,EAAE4D,MAAMC,KAAK,kBAAkBC,OAC3CC,UAAY/D,EAAEU,EAAEI,IAAIa,gBACnBqC,QAAO,kBACGhE,EAAE4D,MAAMC,KAAK,iBAAmBF,aAE1CV,KAAKvC,EAAEI,IAAIQ,uBAChByC,UAAUP,OACLO,UAAUd,KAAK,QAAQgB,OAmBxBvD,EAAEwD,yBAAyBH,UAAWJ,eAnBN,KAC5BQ,QAAUnE,EAAEU,EAAEI,IAAIY,iBAAiB0C,QAAQZ,OAC/CO,UAAUM,OAAOF,SAEjBG,EAAEC,KAAKC,WAAW,kCACdC,eAAiBV,UAAUd,KAAKvC,EAAEI,IAAIU,mBAC1Cd,EAAEgE,iBAAiBf,WAAWgB,MAAK,SAASC,KAAMC,IAC9CtE,UAAUuE,oBAAoBL,eAAgBG,KAAMC,IACpDJ,eAAexB,KAAK,QAAQ8B,QAAO,SAASC,GACxCA,EAAEC,oBAENR,eAAexB,KAAK,QAAQR,GAAG,SAAU/B,EAAEwC,aAE3Ca,UAAUd,KAAKvC,EAAEI,IAAIY,iBAAiBwD,SACtCZ,EAAEC,KAAKY,YAAY,iCACpBR,KAAK,WACJjE,EAAEwD,yBAAyBH,UAAWJ,YACxChB,KAAKjC,IAAI0E,KAAKhF,aAAaiF,aAarCnB,yBAA0B,SAASoB,UAAWC,WAE1CD,UAAUrC,KAAKvC,EAAEI,IAAIM,sBAAsBoC,OAE3C9C,EAAE+C,YAEF6B,UAAUrC,KAAK,gCAAgCuC,IAAIC,SAASF,YAE5DpF,SAASuF,WAAWJ,UAAW5E,EAAEG,gBASrC6D,iBAAkB,SAASa,eACnBI,OAAS,UACbA,OAAOC,GAAKlF,EAAEC,QAAQkF,KACtBF,OAAOG,IAAMpF,EAAEC,QAAQmF,IACvBH,OAAOI,UAAYrF,EAAEC,QAAQoF,UAC7BJ,OAAOK,iBAAmBtF,EAAEC,QAAQqF,iBAChCT,YACAI,OAAOM,QAAUV,WAEdjF,SAAS4F,aAAa,iBAAkB,cAAexF,EAAEC,QAAQwF,UAAWR,SAQvFlC,UAAW,WAEPzD,EAAEU,EAAEI,IAAIM,sBAAsB6B,KAAK,wBAAwB2B,KAAK,IAEhE5E,EAAEU,EAAEI,IAAIM,sBAAsB6B,KAAK,gCAAgCuC,IAAI,GACvEY,YAAW,WACHC,OAAOC,SAAWD,OAAOC,QAAQC,cACjCF,OAAOC,QAAQC,aAAaC,WAAW,IAE3CxG,EAAEU,EAAEI,IAAIM,qBAAuB,YAAY6B,KAAK,QAAQwD,IAAI,GAAGC,UAChE,GAEH1G,EAAEU,EAAEI,IAAIS,oBAAoB2D,UAShChC,YAAa,SAAS8B,GAElBA,EAAEC,iBACFD,EAAE2B,+BAGEC,SAAW,GACf5G,EAAE6G,KAAK7G,EAAE4D,MAAMkD,kBAAkB,SAASC,EAAGC,OACzCJ,SAASI,MAAMC,MAAQD,MAAME,aAE7BC,cAAgBnH,EAAEU,EAAEI,IAAIS,oBAAoB0C,OAAS,GAGpDkD,eAAwD,GAAvCP,SAAS,oBAAoB3C,UAInDK,EAAEC,KAAKC,WAAW,yBACHvE,KAAKmH,KAAK,CAAC,CACtBC,WAAY,sCACZC,KAAM,CACFzB,KAAMe,SAASf,KACfC,IAAKc,SAASd,IACdyB,UAAW9B,SAASmB,SAASW,UAAUzD,QACvC0D,YAAaZ,SAAS,oBACtBa,kBAAmBb,SAAS,sBAC5Bc,kBAAmBP,cAAgBP,SAASc,kBAAoB,MAI/D,GACJC,MAAK,SAASC,KAEX5H,EAAEU,EAAEI,IAAIC,gBAAgByC,OACxBxD,EAAEU,EAAEI,IAAIM,sBAAsBsC,OAC9B1D,EAAEU,EAAEI,IAAIQ,oBAAoBoC,WAExBmE,cAAgBpC,SAASmB,SAASW,UAAUzD,QAC5C+D,eAGA7H,EAAEU,EAAEI,IAAIa,gBACHqC,QAAO,kBACGhE,EAAE4D,MAAMC,KAAK,iBAAmBgE,iBAE1C5E,KAAKvC,EAAEI,IAAIe,cACXoB,KAAKvC,EAAEI,IAAIgB,cACXgG,OACAC,OAAOH,IAAII,aAGhB7H,SAASuF,WAAW1F,EAAE,sBAAwB4H,IAAIjE,UAAY,MAAOjD,EAAEG,iBAKvEb,EAAEU,EAAEI,IAAIc,qBAAqByC,OAAOuD,IAAII,aAGxC7H,SAASuF,WAAW1F,EAAE,uBAAyB4H,IAAIjE,UAAY,MAAOjD,EAAEG,gBAG5Eb,EAAEU,EAAEI,IAAIa,gBAAgB6B,OAGxBxD,EAAE,4BAA4BuD,QAC9B7C,EAAEyC,cAAczC,EAAEyB,SAASC,gBAGvBiE,OAAO4B,MACP5B,OAAO4B,KAAKC,UAGhB7H,kBAAkB8H,oBAAoBnI,EAAEU,EAAEI,IAAIW,qBAAqB,OAEtE2G,QAAO,WACJ9D,EAAEC,KAAKY,YAAY,4BAEtBC,KAAKhF,aAAaiF,aAS3BvC,YAAa,SAASkC,GAClBA,EAAEC,qBACEoD,QAAUrI,EAAE4D,MAEhBU,EAAEC,KAAKC,WAAW,yBACHvE,KAAKmH,KAAK,CAAC,CACtBC,WAAY,uCACZC,KAAM,CACFzB,KAAMnF,EAAEC,QAAQkF,KAChBC,IAAKpF,EAAEC,QAAQmF,IACfnC,UAAW0E,QAAQxE,KAAK,cACxByE,IAAK5H,EAAEC,QAAQ2H,QAId,GACJX,MAAK,SAASC,SACPW,SAAWF,QAAQG,SAAS9H,EAAEI,IAAIkB,YAAc,YAChDyG,YAAcJ,QAAQG,SAAS9H,EAAEI,IAAIkB,YAAc,iBACvDqG,QAEKG,SAAS9H,EAAEI,IAAIkB,aAAa0G,SAAShI,EAAEI,IAAIiB,YAAY4G,KAAKf,IAAIgB,OAEhEC,SAASC,YAAY,qBACrBN,SAAS9H,EAAEI,IAAIkB,aAAa+G,SAAS,qBACxB,IAAdnB,IAAIgB,MAAa,KACbI,aAAeX,QAAQG,SAAS9H,EAAEI,IAAIkB,aAAa0G,SAAS,OAC5DM,cACA9I,IAAI+I,WAAW,yBAA0B,kBAAkBtE,MAAMuC,QAC7D8B,aAAa,GAAGE,IAAMhC,MACtB8B,aAAa,GAAGG,MAAQjC,SAKpCmB,QAAQK,WAAW7B,MAAK,eAChBuC,KAAOpJ,EAAE4D,OACTwF,KAAKC,SAAS,sCACdD,KAAKC,SAAS,uCACdD,KAAKC,SAAS,wCACdD,KAAKC,SAAS,2CACVD,KAAKC,SAAS,sBACdD,KAAKN,YAAY,qBACjBP,SAASO,YAAY,qBACrBL,YAAYM,SAAS,uBAErBK,KAAKL,SAAS,qBACdR,SAASQ,SAAS,qBAClBN,YAAYK,YAAY,yBAGjClF,SAENwE,QAAO,WACJ9D,EAAEC,KAAKY,YAAY,4BAEtBC,MAAK,SAASkE,IACXjD,OAAOkD,QAAQC,MAAM,sBAAwBF,GAAGG,aAS5DzG,cAAe,eACPW,UAAY8B,SAASzF,EAAE4D,MAAMN,KAAK,oBAEtCgB,EAAEC,KAAKC,WAAW,2BACHvE,KAAKmH,KAAK,CAAC,CACtBC,WAAY,yCACZC,KAAM,CACFzB,KAAMnF,EAAEC,QAAQkF,KAChBlC,UAAWA,cAIV,GACJgE,MAAK,eACE+B,aAAe1J,EAAE,uBAAyB2D,UAAY,MACtDgG,UAAY3J,EAAE,sBAAwB2D,UAAY,MAElD+F,aAAazF,OAAS,EAEtByF,aAAaxE,SAGbyE,UAAUzE,SAI4B,GAAtClF,EAAE,0BAA0BiE,QAE5BjE,EAAEU,EAAEI,IAAIa,gBAAgB+B,OAI5BhD,EAAEE,SAASgJ,UAAUnH,GAAGhC,YAAYoJ,QAAQ,KACxC7J,EAAE,4BAA4BuD,WAIlC7C,EAAEE,SAAS8C,UAEd0E,QAAO,WACJ9D,EAAEC,KAAKY,YAAY,8BAEtBC,MAAK,SAASkE,IACXjD,OAAOkD,QAAQC,MAAM,sBAAwBF,GAAGG,aAU5DjH,4BAA6BF,qBACrBwH,YAAc,GACdpJ,EAAEC,QAAQoJ,SACVD,YAAc,2BAEZlJ,eAAiBJ,WAAWwJ,OAAO,CACrCC,sBAAsB,EACtBC,gBAAiB,CACbC,aAAczJ,EAAEI,IAAIoB,aAAakI,QAAQ,IAAK,IAAM,IAAMN,eAK5DO,kBAAoB,CACtBpD,KAAM,SACNqD,WAAY,wBACZC,OAAQ,QAGNC,kBAAoB,CACtBvD,KAAM,SACNqD,WAAY5J,EAAEI,IAAIK,sBAAsBiJ,QAAQ,IAAK,YAEzDlK,IACKuK,YAAY,CACT,CAACC,IAAK,wBAAyBC,UAAW,kBAC1C,CAACD,IAAK,qCAAsCC,UAAW,kBACvD,CAACD,IAAK,uBAAwBC,UAAW,kBACzC,CAACD,IAAK,uBAAwBC,UAAW,oBAE5ChD,MAAK,SAASiD,GACXP,kBAAkBQ,MAAQD,EAAE,GAC5BJ,kBAAkBK,MAAQD,EAAE,GAE5BhK,SAASkK,SAAS,kDAAoDpK,EAAEI,IAAImB,cAAcmI,QAAQ,IAAK,IACnG,KAAOQ,EAAE,GAAK,WAClBhK,SAASmK,QAAQH,EAAE,IACnBhK,SAASoK,UAAUR,kBAAmB,CAAC,WACvC5J,SAASoK,UAAUX,kBAAmB,CAAC,cAGxCzJ,UASXmC,cAAe,SAASiC,GACpBA,EAAEC,iBACEvE,EAAEE,WAEFF,EAAEE,SAAS4C,OAEXxD,EAAEU,EAAEI,IAAIK,uBAAuBmC,KAAK,kBAAmBtD,EAAE4D,MAAMC,KAAK"}