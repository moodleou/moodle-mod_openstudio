{"version":3,"file":"viewdeleted.min.js","sources":["../src/viewdeleted.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript to view deleted contents feature.\n *\n * @package\n * @copyright 2017 The Open University\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_openstudio/viewdeleted\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/str',\n    'mod_openstudio/osdialogue',\n], function($, Ajax, Str, osDialogue) {\n    var t;\n    t = {\n\n        /**\n         * Module config. Passed from server side.\n         * {\n         *     cmid: int,\n         *     folderid: int\n         * }\n         */\n        mconfig: null,\n\n        /**\n         * Deleted posts dialogue instance.\n         */\n        dialogue: null,\n\n        /**\n         * List out all of css selector used in this module.\n         */\n        CSS: {\n            BOUNDINGCLASS: '.openstudio-view-deleted-dialogue',\n            VIEW_DELETED_BUTTON: '#id_viewdeletedpostbutton',\n            RESTORE_BUTTON: '.openstudio-restore-deleted-button'\n        },\n\n        /**\n         * Initialize module.\n         *\n         * @method init\n         * @param {JSON} options  The settings for this feature.\n         */\n        init: async function(options) {\n\n            t.mconfig = options;\n\n            // Create delete dialog.\n            t.dialogue = await t.createDeletedPostDialogue();\n\n            // Click event on delete button.\n            $(t.CSS.VIEW_DELETED_BUTTON).on('click', function() {\n                if (t.dialogue) {\n                    t.dialogue.show();\n                }\n            });\n\n            $('body')\n                .delegate(t.CSS.RESTORE_BUTTON, 'click', t.restoreContent);\n        },\n\n        /**\n         * Create delete dialogue and some events on it.\n         *\n         * @returns {Promise<Modal>}\n         * @method createDeletedPostDialogue\n         */\n        createDeletedPostDialogue: async function() {\n            /**\n             * Set header for dialog.\n             *\n             * @param {Object} dialogue\n             * @method setHeader\n             */\n            function setHeader(dialogue) {\n                Str\n                    .get_string('folderdeletedposts', 'mod_openstudio')\n                    .done(function(s) {\n                        dialogue.setTitle('<span>' + s + '</span>');\n                    });\n            }\n\n            /**\n             * Set body for dialog.\n             *\n             * @param {Object} dialogue\n             * @method setBody\n             */\n            function setBody(dialogue) {\n\n                M.util.js_pending('openstudioFetchDeletedContent');\n\n                const promises = Ajax.call([{\n                    methodname: 'mod_openstudio_external_fetch_deleted_posts_in_folder',\n                    args: {\n                        cmid: t.mconfig.cmid,\n                        folderid: t.mconfig.folderid,\n                    },\n                }]);\n\n                promises[0]\n                    .done(function(html) {\n                        dialogue.setBody(html);\n                    })\n                    .always(function() {\n                        M.util.js_complete('openstudioFetchDeletedContent');\n                    })\n                    .fail(function(ex) {\n                        window.console.error('Log request failed ' + ex.message);\n                    });\n            }\n            const dialogue = await osDialogue.create({\n                isVerticallyCentered: true,\n                templateContext: {\n                    extraClasses: t.CSS.BOUNDINGCLASS.replace('.', '') + ' openstudio-folder-posts-dialogue',\n                },\n            });\n\n            setHeader(dialogue);\n            setBody(dialogue);\n\n            return dialogue;\n        },\n\n        /**\n         * Restore content\n         * @method restoreContent\n         */\n        restoreContent: function() {\n            var cvid = $(this).data('content-version-id');\n            cvid = parseInt(cvid);\n\n            M.util.js_pending('openstudioRestoreContent');\n\n            var promises = Ajax.call([{\n                methodname: 'mod_openstudio_external_restore_content_in_folder',\n                args: {\n                    cmid: t.mconfig.cmid,\n                    cvid: cvid,\n                    folderid: t.mconfig.folderid\n                }\n            }]);\n\n            promises[0]\n                .done(function() {\n                    window.location.reload();\n                })\n                .always(function() {\n                    M.util.js_complete('openstudioRestoreContent');\n                })\n                .fail(function(ex) {\n                    window.console.error('Log request failed ' + ex.message);\n                });\n        },\n    };\n\n    return t;\n});\n"],"names":["define","$","Ajax","Str","osDialogue","t","mconfig","dialogue","CSS","BOUNDINGCLASS","VIEW_DELETED_BUTTON","RESTORE_BUTTON","init","async","options","createDeletedPostDialogue","on","show","delegate","restoreContent","create","isVerticallyCentered","templateContext","extraClasses","replace","get_string","done","s","setTitle","setHeader","M","util","js_pending","call","methodname","args","cmid","folderid","html","setBody","always","js_complete","fail","ex","window","console","error","message","cvid","this","data","parseInt","location","reload"],"mappings":";;;;;;;AA0BAA,oCAAO,CACH,SACA,YACA,WACA,8BACD,SAASC,EAAGC,KAAMC,IAAKC,gBAClBC,SACJA,EAAI,CASAC,QAAS,KAKTC,SAAU,KAKVC,IAAK,CACDC,cAAe,oCACfC,oBAAqB,4BACrBC,eAAgB,sCASpBC,KAAMC,eAAeC,SAEjBT,EAAEC,QAAUQ,QAGZT,EAAEE,eAAiBF,EAAEU,4BAGrBd,EAAEI,EAAEG,IAAIE,qBAAqBM,GAAG,SAAS,WACjCX,EAAEE,UACFF,EAAEE,SAASU,UAInBhB,EAAE,QACGiB,SAASb,EAAEG,IAAIG,eAAgB,QAASN,EAAEc,iBASnDJ,0BAA2BF,uBA4CjBN,eAAiBH,WAAWgB,OAAO,CACrCC,sBAAsB,EACtBC,gBAAiB,CACbC,aAAclB,EAAEG,IAAIC,cAAce,QAAQ,IAAK,IAAM,uDAxC1CjB,UACfJ,IACKsB,WAAW,qBAAsB,kBACjCC,MAAK,SAASC,GACXpB,SAASqB,SAAS,SAAWD,EAAI,cAwC7CE,CAAUtB,mBA9BOA,UAEbuB,EAAEC,KAAKC,WAAW,iCAED9B,KAAK+B,KAAK,CAAC,CACxBC,WAAY,wDACZC,KAAM,CACFC,KAAM/B,EAAEC,QAAQ8B,KAChBC,SAAUhC,EAAEC,QAAQ+B,aAInB,GACJX,MAAK,SAASY,MACX/B,SAASgC,QAAQD,SAEpBE,QAAO,WACJV,EAAEC,KAAKU,YAAY,oCAEtBC,MAAK,SAASC,IACXC,OAAOC,QAAQC,MAAM,sBAAwBH,GAAGI,YAW5DR,CAAQhC,UAEDA,UAOXY,eAAgB,eACR6B,KAAO/C,EAAEgD,MAAMC,KAAK,sBACxBF,KAAOG,SAASH,MAEhBlB,EAAEC,KAAKC,WAAW,4BAEH9B,KAAK+B,KAAK,CAAC,CACtBC,WAAY,oDACZC,KAAM,CACFC,KAAM/B,EAAEC,QAAQ8B,KAChBY,KAAMA,KACNX,SAAUhC,EAAEC,QAAQ+B,aAInB,GACJX,MAAK,WACFkB,OAAOQ,SAASC,YAEnBb,QAAO,WACJV,EAAEC,KAAKU,YAAY,+BAEtBC,MAAK,SAASC,IACXC,OAAOC,QAAQC,MAAM,sBAAwBH,GAAGI"}