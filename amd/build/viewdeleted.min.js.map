{"version":3,"file":"viewdeleted.min.js","sources":["../src/viewdeleted.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript to view deleted contents feature.\n *\n * @package mod_openstudio\n * @copyright 2017 The Open University\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_openstudio/viewdeleted\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/str',\n    'require'\n], function($, Ajax, Str, require) {\n    var t;\n    t = {\n\n        /**\n         * Module config. Passed from server side.\n         * {\n         *     cmid: int,\n         *     folderid: int\n         * }\n         */\n        mconfig: null,\n\n        /**\n         * List out all of css selector used in this module.\n         */\n        CSS: {\n            BOUNDINGCLASS: '.openstudio-view-deleted-dialogue',\n            VIEW_DELETED_BUTTON: '#id_viewdeletedpostbutton',\n            RESTORE_BUTTON: '.openstudio-restore-deleted-button'\n        },\n\n        /**\n         * Initialize module.\n         *\n         * @method init\n         * @param {JSON} options  The settings for this feature.\n         */\n        init: function(options) {\n\n            t.mconfig = options;\n\n            // Create delete dialog.\n            Y.use('moodle-core-notification-dialogue', function() {\n                require(['mod_openstudio/osdialogue'], function(osDialogue) {\n                    t.dialogue = t.createDeletedPostDialogue(osDialogue);\n                });\n            });\n\n            // Click event on delete button.\n            $(t.CSS.VIEW_DELETED_BUTTON).on('click', function() {\n                if (t.dialogue) {\n                    t.dialogue.show();\n                    t.resize();\n                }\n            });\n\n            $('body')\n                .delegate(t.CSS.RESTORE_BUTTON, 'click', t.restoreContent);\n\n            // Responsive.\n            $(window).resize(t.resize.bind(t));\n        },\n\n        /**\n         * Create delete dialogue and some events on it.\n         *\n         * @param {object} osDialogue object\n         * @return {object} OSDialogue instance\n         * @method createDeletedPostDialogue\n         */\n        createDeletedPostDialogue: function(osDialogue) {\n            /**\n             * Set header for dialog\n             * @method setHeader\n             */\n            function setHeader() {\n                Str\n                    .get_string('folderdeletedposts', 'mod_openstudio')\n                    .done(function(s) {\n                        dialogue.set('headerContent', '<span>' + s + '</span>');\n                    });\n            }\n\n            /**\n             * Set body for dialog\n             * @method setBody\n             */\n            function setBody() {\n\n                M.util.js_pending('openstudioFetchDeletedContent');\n\n                var promises = Ajax.call([{\n                    methodname: 'mod_openstudio_external_fetch_deleted_posts_in_folder',\n                    args: {\n                        cmid: t.mconfig.cmid,\n                        folderid: t.mconfig.folderid\n                    }\n                }]);\n\n                promises[0]\n                    .done(function(html) {\n                        dialogue.set('bodyContent', html);\n                    })\n                    .always(function() {\n                        M.util.js_complete('openstudioFetchDeletedContent');\n                    })\n                    .fail(function(ex) {\n                        window.console.error('Log request failed ' + ex.message);\n                    });\n            }\n\n            var dialogue = new osDialogue({\n                closeButton: true,\n                visible: false,\n                centered: true,\n                modal: true,\n                responsive: true,\n                width: 640,\n                responsiveWidth: 767,\n                focusOnPreviousTargetAfterHide: true,\n                extraClasses: [t.CSS.BOUNDINGCLASS.replace('.', ''), 'openstudio-folder-posts-dialogue']\n            });\n\n            setHeader();\n            setBody();\n\n            return dialogue;\n        },\n\n        /**\n         * Restore content\n         * @method restoreContent\n         */\n        restoreContent: function() {\n            var cvid = $(this).data('content-version-id');\n            cvid = parseInt(cvid);\n\n            M.util.js_pending('openstudioRestoreContent');\n\n            var promises = Ajax.call([{\n                methodname: 'mod_openstudio_external_restore_content_in_folder',\n                args: {\n                    cmid: t.mconfig.cmid,\n                    cvid: cvid,\n                    folderid: t.mconfig.folderid\n                }\n            }]);\n\n            promises[0]\n                .done(function() {\n                    window.location.reload();\n                })\n                .always(function() {\n                    M.util.js_complete('openstudioRestoreContent');\n                })\n                .fail(function(ex) {\n                    window.console.error('Log request failed ' + ex.message);\n                });\n        },\n\n        /**\n         * Resize and update dialogue position.\n         * @method resize\n         */\n        resize: function() {\n            if (!t.dialogue) {\n                return;\n            }\n\n            if (t.dialogue.get('visible')) {\n                if (Y.one('body').get('winWidth') < t.dialogue.get('responsiveWidth')) {\n                    t.dialogue.makeResponsive();\n                    $(t.CSS.RESTORE_BUTTON).removeClass('osep-smallbutton');\n                } else {\n                    $(t.CSS.RESTORE_BUTTON).addClass('osep-smallbutton');\n                    if (Y.one('body').get('winWidth') >= 1000) {\n                        t.dialogue.set('width', 640);\n                    } else {\n                        t.dialogue.set('width', 500);\n                    }\n                    t.dialogue.centerDialogue();\n                }\n            }\n        }\n    };\n\n    return t;\n});\n"],"names":["define","$","Ajax","Str","require","t","mconfig","CSS","BOUNDINGCLASS","VIEW_DELETED_BUTTON","RESTORE_BUTTON","init","options","Y","use","osDialogue","dialogue","createDeletedPostDialogue","on","show","resize","delegate","restoreContent","window","bind","closeButton","visible","centered","modal","responsive","width","responsiveWidth","focusOnPreviousTargetAfterHide","extraClasses","replace","get_string","done","s","set","M","util","js_pending","call","methodname","args","cmid","folderid","html","always","js_complete","fail","ex","console","error","message","cvid","this","data","parseInt","location","reload","get","one","makeResponsive","removeClass","addClass","centerDialogue"],"mappings":";;;;;;;AA0BAA,oCAAO,CACH,SACA,YACA,WACA,YACD,SAASC,EAAGC,KAAMC,IAAKC,aAClBC,SACJA,EAAI,CASAC,QAAS,KAKTC,IAAK,CACDC,cAAe,oCACfC,oBAAqB,4BACrBC,eAAgB,sCASpBC,KAAM,SAASC,SAEXP,EAAEC,QAAUM,QAGZC,EAAEC,IAAI,qCAAqC,WACvCV,QAAQ,CAAC,8BAA8B,SAASW,YAC5CV,EAAEW,SAAWX,EAAEY,0BAA0BF,kBAKjDd,EAAEI,EAAEE,IAAIE,qBAAqBS,GAAG,SAAS,WACjCb,EAAEW,WACFX,EAAEW,SAASG,OACXd,EAAEe,aAIVnB,EAAE,QACGoB,SAAShB,EAAEE,IAAIG,eAAgB,QAASL,EAAEiB,gBAG/CrB,EAAEsB,QAAQH,OAAOf,EAAEe,OAAOI,KAAKnB,KAUnCY,0BAA2B,SAASF,gBAyC5BC,SAAW,IAAID,WAAW,CAC1BU,aAAa,EACbC,SAAS,EACTC,UAAU,EACVC,OAAO,EACPC,YAAY,EACZC,MAAO,IACPC,gBAAiB,IACjBC,gCAAgC,EAChCC,aAAc,CAAC5B,EAAEE,IAAIC,cAAc0B,QAAQ,IAAK,IAAK,6CA5CrD/B,IACKgC,WAAW,qBAAsB,kBACjCC,MAAK,SAASC,GACXrB,SAASsB,IAAI,gBAAiB,SAAWD,EAAI,cAUrDE,EAAEC,KAAKC,WAAW,iCAEHvC,KAAKwC,KAAK,CAAC,CACtBC,WAAY,wDACZC,KAAM,CACFC,KAAMxC,EAAEC,QAAQuC,KAChBC,SAAUzC,EAAEC,QAAQwC,aAInB,GACJV,MAAK,SAASW,MACX/B,SAASsB,IAAI,cAAeS,SAE/BC,QAAO,WACJT,EAAEC,KAAKS,YAAY,oCAEtBC,MAAK,SAASC,IACX5B,OAAO6B,QAAQC,MAAM,sBAAwBF,GAAGG,YAmBrDtC,UAOXM,eAAgB,eACRiC,KAAOtD,EAAEuD,MAAMC,KAAK,sBACxBF,KAAOG,SAASH,MAEhBhB,EAAEC,KAAKC,WAAW,4BAEHvC,KAAKwC,KAAK,CAAC,CACtBC,WAAY,oDACZC,KAAM,CACFC,KAAMxC,EAAEC,QAAQuC,KAChBU,KAAMA,KACNT,SAAUzC,EAAEC,QAAQwC,aAInB,GACJV,MAAK,WACFb,OAAOoC,SAASC,YAEnBZ,QAAO,WACJT,EAAEC,KAAKS,YAAY,+BAEtBC,MAAK,SAASC,IACX5B,OAAO6B,QAAQC,MAAM,sBAAwBF,GAAGG,aAQ5DlC,OAAQ,WACCf,EAAEW,UAIHX,EAAEW,SAAS6C,IAAI,aACXhD,EAAEiD,IAAI,QAAQD,IAAI,YAAcxD,EAAEW,SAAS6C,IAAI,oBAC/CxD,EAAEW,SAAS+C,iBACX9D,EAAEI,EAAEE,IAAIG,gBAAgBsD,YAAY,sBAEpC/D,EAAEI,EAAEE,IAAIG,gBAAgBuD,SAAS,oBAC7BpD,EAAEiD,IAAI,QAAQD,IAAI,aAAe,IACjCxD,EAAEW,SAASsB,IAAI,QAAS,KAExBjC,EAAEW,SAASsB,IAAI,QAAS,KAE5BjC,EAAEW,SAASkD"}