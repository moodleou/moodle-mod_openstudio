define ("mod_openstudio/notificationlist",["jquery","core/ajax","core/modal","core/templates"],function(a,b,c,d){var f={STOPBUTTONS:".openstudio-notification-stopbutton",NOTIFICATIONBUTTON:".openstudio-nav-primary .dropdown.notifications",UNREAD:".openstudio-notifications-list .openstudio-notification-unread"},g={cmid:null,followflag:null},h={modal:null,init:function init(b,c){g.cmid=b;g.followflag=c;a(f.STOPBUTTONS).on("click",h.stopNotifications);if(0<a(f.UNREAD).length){a(f.NOTIFICATIONBUTTON).on("click",h.readNotifications)}d.render("mod_openstudio/notification_modal",{name:""});d.render("core/modal_backdrop",{})},reShowList:function reShowList(){window.setTimeout(function(){a(f.NOTIFICATIONBUTTON).addClass("open")},0)},stopNotifications:function stopNotifications(b){b.preventDefault();h.reShowList();var e,f=a(b.target).closest(".openstudio-notification"),g=a(b.currentTarget).data("contentid"),i=a(b.currentTarget).data("commentid");if(i){e="mod_openstudio/commentnotification_modal"}else{e="mod_openstudio/notification_modal"}d.render(e,{name:f.find(".openstudio-notification-message a").text(),contentid:g,commentid:i}).done(function(a){h.modal=new c(a);h.modal.body.find("button").on("click",h.handleModalButton);h.modal.show()})},handleModalButton:function handleModalButton(c){h.reShowList();var d=a(c.target);if("yes"===d.data("action")){M.util.js_pending("openstudioStopNotifications");var e,f=d.data("commentid"),i={cmid:g.cmid,cid:d.data("contentid"),fid:g.followflag};if(f){i.commentid=f;e="mod_openstudio_external_flag_comment"}else{i.mode="off";e="mod_openstudio_external_flag_content"}var j=b.call([{methodname:e,args:i}]);j[0].done(function(){a(".openstudio-notifications-list button[data-contentid=\""+d.data("contentid")+"\"]").remove();M.util.js_complete("openstudioStopNotifications")}).fail(function(){window.console.error("Could not un-follow content");M.util.js_complete("openstudioStopNotifications")})}h.modal.hide()},readNotifications:function readNotifications(c){c.preventDefault();var d=a(f.UNREAD).map(function(){return a(this).data("id")}).get(),e=b.call([{methodname:"mod_openstudio_external_read_notifications",args:{cmid:g.cmid,ids:d}}]);e[0].done(function(){a(".openstudio-navigation-notification-text").hide();a(f.NOTIFICATIONBUTTON).off("click",h.readNotifications)}).fail(function(a){window.console.error("Could not mark notifications read. "+a.message)})}};return h});
//# sourceMappingURL=notificationlist.min.js.map
