define("mod_openstudio/expand_collapse_handler",["exports","core/pending","core_user/repository","core/notification"],(function(_exports,_pending,Repository,_notification){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * JavaScript to handle expand/collapse.
   *
   * @module mod_openstudio/expand_collapse_handler
   * @copyright 2024 The Open University
   * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_pending=_interopRequireDefault(_pending),Repository=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Repository),_notification=_interopRequireDefault(_notification);let cmid=0,activitiesID=[],expanded={},userPreference="";_exports.init=()=>{initActivitiesID(),initClickEvent(),updateExpandCollapseAll(),cmid=document.querySelector(".openstudio-container").dataset.cmid,userPreference="mod_openstudio_expanded_"+cmid,Repository.getUserPreference(userPreference).then((response=>{expanded[cmid]=response?JSON.parse(response):{}})).catch(_notification.default.exception)};const initActivitiesID=()=>{document.querySelectorAll("h2.openstudio-activity-title").forEach((activity=>{activitiesID.push(activity.dataset.id)}))},initClickEvent=()=>{document.body.addEventListener("click",(event=>{const target=event.target;target.closest("a.openstudio-expand")?(event.preventDefault(),expandActivity(target.closest("a.openstudio-expand"),!1)):target.closest("a.openstudio-collapse")?(event.preventDefault(),collapseActivity(target.closest("a.openstudio-collapse"),!1)):target.closest("#openstudio-expandall")?(event.preventDefault(),expandAll(target.closest("#openstudio-expandall"),!0)):target.closest("#openstudio-collapseall")&&(event.preventDefault(),expandAll(target.closest("#openstudio-collapseall"),!1))}))},expandAll=(button,expand)=>{const pendingPromise=new _pending.default("mod_openstudio/expandall"),type=expand?"expand":"collapse";document.querySelectorAll("a.openstudio-"+type).forEach((link=>{expand?expandActivity(link,!0):collapseActivity(link,!0)})),updateExpandCollapseLink(button,!1,!0),storeExpanded(expand,null),pendingPromise.resolve()},expandActivity=(link,preventFocus)=>{const elid="openstudio_grid_"+link.dataset.activity,activity=document.getElementById(elid);if(activity.classList.contains("openstudio-expanded"))return;const pendingPromise=new _pending.default("mod_openstudio/expand"),currentGrid=window.isotope[elid];activity.setAttribute("aria-expanded","true"),activity.style.opacity="0",activity.classList.add("openstudio-expanded"),setTimeout((()=>{currentGrid.layout(),activity.style.opacity="1"}),50),updateExpandCollapseLink(link,preventFocus,!1),updateExpandCollapseAll(),preventFocus||storeExpanded(!0,link.dataset.activity),pendingPromise.resolve()},collapseActivity=(link,preventFocus)=>{const elid="openstudio_grid_"+link.dataset.activity,activity=document.getElementById(elid);if(!activity.classList.contains("openstudio-expanded"))return;const pendingPromise=new _pending.default("mod_openstudio/collapse");activity.setAttribute("aria-expanded","false"),activity.style.height="0",activity.style.opacity="0",setTimeout((()=>{activity.classList.remove("openstudio-expanded")}),500),updateExpandCollapseLink(link,preventFocus,!1),updateExpandCollapseAll(),preventFocus||storeExpanded(!1,link.dataset.activity),pendingPromise.resolve()},updateExpandCollapseLink=(link,preventFocus,preventToggle)=>{var _link$nextElementSibl;preventToggle||link.parentNode.classList.toggle("expanded");const sibling=null!==(_link$nextElementSibl=link.nextElementSibling)&&void 0!==_link$nextElementSibl?_link$nextElementSibl:link.previousElementSibling;preventFocus||sibling.focus()},updateExpandCollapseAll=()=>{const links=document.querySelectorAll("div.openstudio-expandcollapse.expanded"),expandall=document.querySelector("div.openstudio-expandall");0===links.length?expandall.classList.remove("expanded"):expandall.classList.add("expanded")},storeExpanded=(expand,activityID)=>{null===activityID?activitiesID.forEach((id=>{expanded[cmid][id]=expand})):expanded[cmid][activityID]=expand,Repository.setUserPreference(userPreference,JSON.stringify(expanded[cmid]))}}));

//# sourceMappingURL=expand_collapse_handler.min.js.map