define ("mod_openstudio/contentpage",["jquery","core/ajax","core/str","core/modal","core/modal_events","core/templates","core/config","require"],function(a,b,c,d,e,f,g,h){var i={dialogue:null,delete_item:null,mconfig:null,init:function init(b){a.fx.off=!0;i.mconfig=b;Y.use("moodle-core-notification-dialogue",function(){h(["mod_openstudio/osdialogue"],function(a){i.archiveDialogue=i.createArchiveDialogue(a);i.deleteContentDialogue=i.createDeleteContentDialogue(a)})});i.createMaximizeModal();a("#openstudio_content_view_maximize").on("click",i.toogleContentModal);a("body").delegate("#openstudio_content_view_minimize","click",i.toogleContentModal);a("body").delegate(".openstudio-modal-content-close","click",i.toogleContentModal);var c=a("#openstudio_content_view_map_canvas");if(c.length){i.showGoogleMap(c)}a("#id_archivebutton").on("click",function(a){a.preventDefault();i.archiveDialogue.show()});a(".openstudio-delete-content-version").on("click",function(b){b.preventDefault();i.delete_item=a(this);i.deleteContentDialogue.show()});a(".openstudio-content-view-flag-icon").bind("click",function(){i.doFlagContent(a(this))});a(".openstudio-request-feedback-button").bind("click",function(){i.doFlagContent(a(this))})},createMaximizeModal:function createMaximizeModal(){f.render("mod_openstudio/content_modal",{title:a(".openstudio-content-view-title").text(),body:a(".openstudio-content-view-file").html(),date:a(".openstudio-content-view-date").html(),isiframecontent:0<a(".openstudio-content-view-file").find("iframe").length}).done(function(a){i.modal=new d(a);i.modal.setLarge()})},toogleContentModal:function toogleContentModal(){if(!i.modal){return}if(i.modal.isVisible()){i.modal.hide()}else{i.modal.show();i.modal.getRoot().on(e.shown,function(b){if("modal:shown"===b.type){a(".openstudio-modal-content-close")[0].scrollIntoView()}a(".openstudio-modal-content-close, #openstudio_content_view_minimize").keydown(function(b){if(13==b.keyCode){i.modal.hide();a("#openstudio_content_view_maximize").focus();return!1}})})}a("body").toggleClass("openstudio-lockscroll")},showGoogleMap:function showGoogleMap(a){var b=a.attr("data-gpslat"),c=a.attr("data-gpslng");if(b&&c){var d={lat:parseFloat(b),lng:parseFloat(c)};if("undefined"!=typeof google&&"undefined"!=typeof google.maps){var e=new google.maps.Map(document.getElementById("openstudio_content_view_map_canvas"),{center:d,zoom:14});new google.maps.Marker({position:d,map:e})}}},doFlagContent:function doFlagContent(c){var d=b.call([{methodname:"mod_openstudio_external_flag_content",args:{cmid:c.attr("data-cmid"),cid:c.attr("data-cid"),fid:c.attr("data-fid"),mode:c.attr("data-mode")}}]);d[0].done(function(b){if(b.success){var c=a("#content_view_icon_"+b.fid);c.attr("data-mode",b.mode);if(b.iscontentflagrequestfeedback){c.html(b.flagtext);a("#openstudio_item_request_feedback").removeClass(b.flagremoveclass).addClass(b.flagaddclass)}else{c.find(".openstudio-content-view-icon-text").text(b.flagtext);c.toggleClass("openstudio-content-view-icon-active","off"==b.mode);c.attr("title",b.accessiblemessage)}}}).fail(function(a){window.console.error("Error saving social flag "+a.message)})},setHeader:function setHeader(a,b){c.get_string(b,"mod_openstudio").done(function(b){a.set("headerContent","<span class=\"openstudio-dialogue-common-header\">"+b+"</span>")})},setBody:function setBody(a,b){c.get_string(b,"mod_openstudio").done(function(b){a.set("bodyContent","<span>"+b+"</span>")})},createArchiveDialogue:function createArchiveDialogue(b){var d=new b({closeButton:!0,visible:!1,centered:!0,responsive:!0,responsiveWidth:767,modal:!0,focusOnPreviousTargetAfterHide:!0,width:521});i.setHeader(d,"archivedialogheader");i.setBody(d,"modulejsdialogcontentarchiveconfirm");var e={name:"archive",classNames:"openstudio-archive-yes-btn",events:{click:function click(){i.redirectPostRequest({url:a("#contentversionlink").val(),data:{archiveversion:1}})}}},f={name:"cancel",classNames:"openstudio-archive-no-btn",action:"hide"};c.get_strings([{key:"contentactionarchivepost",component:"mod_openstudio"},{key:"modulejsdialogcancel",component:"mod_openstudio"}]).done(function(a){e.label=a[0];f.label=a[1];d.addButton(e,["footer"]);d.addButton(f,["footer"])});return d},createDeleteContentDialogue:function createDeleteContentDialogue(d){var e=new d({closeButton:!0,visible:!1,centered:!0,responsive:!0,responsiveWidth:767,modal:!0,focusOnPreviousTargetAfterHide:!0,width:521});i.setHeader(e,"deletearchiveversionheader");i.setBody(e,"deletearchiveversionheaderconfirm");var f={name:"delete",classNames:"openstudio-delete-btn",events:{click:function click(){var c=i.delete_item,d=b.call([{methodname:"mod_openstudio_external_delete_version",args:{cmid:c.attr("data-cmid"),cid:c.attr("data-cid"),cvid:c.attr("data-cvid")}}]);d[0].done(function(){a(".openstudio-cancel-btn").trigger("click");if(0<a("#contentcurrenteversionurl").length){window.location.href=a("#contentcurrenteversionurl").val()}else{a("#content_version_id_"+c.attr("data-cvid")).remove();if(0==a(".openstudio-content-view-version-detail").length){a("#openstudio_content_view_post_archive_panel").remove()}}}).fail(function(a){window.console.error("Error delete content version"+a.message)})}}},g={name:"cancel",classNames:"openstudio-cancel-btn",action:"hide"};c.get_strings([{key:"modulejsdialogdelete",component:"mod_openstudio"},{key:"modulejsdialogcancel",component:"mod_openstudio"}]).done(function(a){f.label=a[0];g.label=a[1];e.addButton(f,["footer"]);e.addButton(g,["footer"])});return e},redirectPostRequest:function redirectPostRequest(b){var c=a("<form></form>");c.attr({method:"POST",action:b.url,style:"display: none;"});a.each(b.data,function(b,d){var e=a("<input/>");e.attr("type","hidden");e.attr("name",b);e.attr("value",d);c.append(e)});a(c).appendTo("body").submit()}};return i});
//# sourceMappingURL=contentpage.min.js.map
