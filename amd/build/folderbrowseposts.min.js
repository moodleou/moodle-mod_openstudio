/**
 * JavaScript to manage on view page.
 *
 * @package
 * @copyright 2017 The Open University
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_openstudio/folderbrowseposts",["jquery","core/str","core/templates","core/ajax"],(function($,Str,Templates,Ajax){var t;return t={mconfig:null,selectedposts:[],totalavailablepost:0,CSS:{BROWSEPOSTLINK:".openstudio-select-content",BROWSEPOSTSSELECTEDIDS:"#browse_posts_selected_ids",BROWSEPOSTSSELECTEDITEMS:"#browse_posts_selected_items",SELECTPOSTBTN:".openstudio-folder-select-post-btn",BROWSEPOSTSSELECTED:"#browse_posts_selected",BROWSEPOSTSCOUNTSELECTED:"#openstudio-browseposts-countcurrent",REMOVELASTSELECTED:".folder-browse-post-remove-last-selection",SAVECHANGEBUTTON:".folder-browse-post-save-change",DIALOGHEADER:".openstudio-dialogue-common-header",BROWSEPOSTDIALOGUECONTAINER:".openstudio-folder-posts-dialogue",BOX_FOLDER_COMMENT:"#toggle_folder_view_folder_comments"},init:function(options){t.mconfig=options,Y.use("moodle-core-notification-dialogue",(function(){require(["mod_openstudio/osdialogue"],(function(OSDialogue){t.dialogue=t.createBrowseDialogue(OSDialogue)}))})),$(t.CSS.BROWSEPOSTLINK).on("click",(function(){t.dialogue.show(),Templates.render("mod_openstudio/folder_browse_posts_header",{}).done((function(html){return t.selectedposts=[],t.dialogue.set("bodyContent",html),setTimeout((function(){t.resize()}),200),$("#openstudio_search_post").keypress((function(e){return 13!=e.which||(t.doBrowsePosts(),!1)})),$(".browse-search-icon").on("click",(function(){t.doBrowsePosts()})),t.doBrowsePosts(),$(t.CSS.REMOVELASTSELECTED).on("click",(function(){t.removeLastPostSelected()})),!1}))})),$(window).resize(t.resize.bind(t)),$(document).ready(this.toggleBoxComment)},doBrowsePosts:function(){Ajax.call([{methodname:"mod_openstudio_external_browse_posts",args:{cmid:t.mconfig.cmid,folderid:t.mconfig.folderid,selectedposts:$(t.CSS.BROWSEPOSTSSELECTEDIDS).val(),search:$("#openstudio_search_post").val()}}])[0].done((function(res){t.totalavailablepost=res.total,$("#folder_total_browse_posts").html(res.foundnumberpostlabel),$("#openstudio-browseposts-total").html(res.total),$("#openstudio-browseposts-helpicon").html(res.helpicon),$("#browse_posts_searched").html(res.html),$(t.CSS.SELECTPOSTBTN).on("click",(function(){t.selectPostToFolder(this)})),$(t.CSS.SAVECHANGEBUTTON).on("click",(function(){t.selectedposts.length&&$("#browse_posts_selected_from").submit()})),t.hideSaveButtons(),t.showHideSelectButton(),t.resize(),t.updateBackgroundRow()})).fail((function(ex){window.console.error("Browse posts failed "+ex.message)}))},createBrowseDialogue:function(OSDialogue){var dialogue=new OSDialogue({closeButton:!0,visible:!1,centered:!0,modal:!0,responsive:!0,width:640,responsiveWidth:767,focusOnPreviousTargetAfterHide:!0,extraClasses:[t.CSS.BROWSEPOSTDIALOGUECONTAINER.replace(".",""),"openstudio-browseposts-dialogue"]});return Str.get_string("folderbrowseposts","mod_openstudio").done((function(s){dialogue.set("headerContent",'<span class="'+t.CSS.DIALOGHEADER.replace(".","")+'">'+s+"</span>")})),dialogue},selectPostToFolder:function(event){var postid=$(event).attr("value"),postimage=$("#browse_post_item_img_"+postid).attr("src"),closeicon=M.util.image_url("close_button_whitecross_rgb_32px","mod_openstudio"),itemTitle=$("#browse_post_item_name_"+postid).val(),buttonid="deselect-"+postid;Templates.render("mod_openstudio/folder_browse_selected_post",{buttonid:buttonid,postid:postid,image:postimage,closeicon:closeicon,title:itemTitle}).done((function(html){$(t.CSS.BROWSEPOSTSSELECTEDITEMS).append(html),$("#deselect-"+postid).on("click",(function(){var postid=$(this).attr("value");t.deSelectPostToFolder(postid)})),t.showHideSelectButton()})),$("#browse_post_item_"+postid).hide(),t.selectedposts.push(postid),$(t.CSS.BROWSEPOSTSSELECTEDIDS).val(t.selectedposts),$(t.CSS.BROWSEPOSTSSELECTED).show();var totalselectedpost=t.selectedposts.length;$(t.CSS.BROWSEPOSTSCOUNTSELECTED).html(totalselectedpost),t.showSaveButtons(),t.updateBackgroundRow()},deSelectPostToFolder:function(postid){$("#browse_post_item_"+postid).show(),$("#deselect-"+postid).remove(),t.selectedposts.splice($.inArray(postid,t.selectedposts),1),$(t.CSS.BROWSEPOSTSSELECTEDIDS).val(t.selectedposts);var totalselectedpost=t.selectedposts.length;$(t.CSS.BROWSEPOSTSCOUNTSELECTED).html(totalselectedpost),0==totalselectedpost&&$(t.CSS.BROWSEPOSTSSELECTED).hide(),t.hideSaveButtons(),t.showHideSelectButton(),t.updateBackgroundRow()},removeLastPostSelected:function(){var lastPostId=t.selectedposts[t.selectedposts.length-1];t.deSelectPostToFolder(lastPostId)},hideSaveButtons:function(){0==t.selectedposts.length&&($(".openstudio-folder-browse-posts-header-result-buttons").hide(),$(".openstudio-folder-browse-posts-header-result-buttons-bottom").hide())},showSaveButtons:function(){$(".openstudio-folder-browse-posts-header-result-buttons").show(),$(".openstudio-folder-browse-posts-header-result-buttons-bottom").show()},resize:function(){t.dialogue&&t.dialogue.get("visible")&&(Y.one("body").get("winWidth")<t.dialogue.get("responsiveWidth")?(t.dialogue.makeResponsive(),$(t.CSS.SAVE_ORDER_BUTTON).removeClass("osep-smallbutton")):($(t.CSS.SAVE_ORDER_BUTTON).addClass("osep-smallbutton"),Y.one("body").get("winWidth")>=767?t.dialogue.set("width",640):t.dialogue.set("width",500),t.dialogue.centerDialogue()))},showHideSelectButton:function(){0==t.totalavailablepost||t.selectedposts.length>0&&t.totalavailablepost<=t.selectedposts.length?$(".openstudio-folder-select-post-btn").prop("disabled",!0):$(".openstudio-folder-select-post-btn").prop("disabled",!1)},updateBackgroundRow:function(){$(".openstudio-browse-post-item").removeClass("browse-post-item-even").removeClass("browse-post-item-odd"),$(".openstudio-browse-post-item:visible:even").addClass("browse-post-item-even"),$(".openstudio-browse-post-item:visible:odd").addClass("browse-post-item-odd")},toggleBoxComment:function(){$(t.CSS.BOX_FOLDER_COMMENT).ready((function(){const hash=window.location.hash;hash&&"id_addcomment"===hash.replace("#","")&&$(t.CSS.BOX_FOLDER_COMMENT).click()}))}}}));

//# sourceMappingURL=folderbrowseposts.min.js.map