{"version":3,"file":"delete.min.js","sources":["../src/delete.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript to manage delete content feature.\n *\n * @package\n * @copyright 2017 The Open University\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_openstudio/delete\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/str',\n    'core/config',\n    'require'\n], function($, Ajax, Str, SiteConfig, require) {\n    var t;\n    t = {\n\n        /**\n         * Module config. Passed from server side.\n         * {\n         *     id: int,\n         *     folderid: int,\n         *     isfolder: bool,\n         *     folderid: int (optional),\n         *     isactivitycontent: bool\n         *\n         * }\n         */\n        mconfig: null,\n\n        /**\n         * List out all of css selector used in this module.\n         */\n        CSS: {\n            DELETEBUTTON: '#id_deletebutton',\n            DIALOGHEADER: '.openstudio-dialogue-common-header',\n            DELETEDIALOGUECONTAINER: '.openstudio-delete-dialogue'\n        },\n\n        /**\n         * Initialize module.\n         *\n         * @method init\n         * @param {JSON} options  The settings for this feature.\n         */\n        init: function(options) {\n\n            t.mconfig = options;\n\n            // Create delete dialog.\n            Y.use('moodle-core-notification-dialogue', function() {\n                require(['mod_openstudio/osdialogue'], function(osDialogue){\n                    t.dialogue = t.createDeleteDialogue(osDialogue);\n                });\n            });\n\n            // Click event on delete button.\n            $(t.CSS.DELETEBUTTON).on('click', function() {\n                if (t.dialogue) {\n                    t.dialogue.show();\n                }\n            });\n\n            // Responsive.\n            $(window).resize(t.resize.bind(t));\n        },\n\n        /**\n         * Create delete dialogue and some events on it.\n         *\n         * @param {object} osDialogue object\n         * @return {object} OSDialogue instance\n         * @method createDeleteDialogue\n         */\n        createDeleteDialogue: function(osDialogue) {\n            /**\n             * Set header for dialog\n             * @method setHeader\n             */\n            function setHeader() {\n                var langstring = (t.mconfig.isfolder) ? 'folderdeletedfolder' : 'contentdeledialogueteheader';\n                Str\n                    .get_string(langstring, 'mod_openstudio')\n                    .done(function(s) {\n                        dialogue.set('headerContent',\n                            '<span class=\"' + t.CSS.DIALOGHEADER.replace('.', '') +\n                            '\">' + s + '</span>');\n                    });\n            }\n\n            /**\n             * Set body for dialog\n             * @method setBody\n             */\n            function setBody() {\n                var langstring = (t.mconfig.isfolder) ? 'deleteconfirmfolder' : 'deleteconfirmcontent';\n                Str\n                    .get_string(langstring, 'mod_openstudio')\n                    .done(function(s) {\n                        dialogue.set('bodyContent', s);\n                    });\n            }\n\n            /**\n             * Set body for dialog\n             * @method setBody\n             */\n            function setFooter() {\n                // Button [Cancel]\n                var cancelBtnProperty = {\n                    name: 'cancel',\n                    classNames: 'openstudio-delete-cancel-btn',\n                    action: 'hide'\n                };\n\n                // Button [Delete]\n                var deleteBtnProperty = {\n                    name: 'delete',\n                    classNames: 'openstudio-delete-ok-btn',\n                    events: {\n                        click: t.deleteContent.bind(t)\n                    }\n                };\n\n                Str\n                    .get_strings([\n                        {key: 'modulejsdialogcancel', component: 'mod_openstudio'},\n                        {key: 'deletelevel', component: 'mod_openstudio'}\n                    ])\n                    .done(function(s) {\n                        cancelBtnProperty.label = s[0];\n                        deleteBtnProperty.label = s[1];\n                        dialogue.addButton(deleteBtnProperty, ['footer']);\n                        dialogue.addButton(cancelBtnProperty, ['footer']);\n                    });\n            }\n            var hasFolderClass = '';\n            if (t.mconfig.isfolder) {\n                hasFolderClass = 'openstudio-folder';\n            } else if(t.mconfig.folderid) {\n                hasFolderClass = 'openstudio-is-belong-to-folder';\n            }\n            var dialogue = new osDialogue({\n                closeButton: true,\n                visible: false,\n                centered: true,\n                modal: true,\n                responsive: true,\n                width: 640,\n                responsiveWidth: 767,\n                focusOnPreviousTargetAfterHide: true,\n                extraClasses: [t.CSS.DELETEDIALOGUECONTAINER.replace('.', ''), hasFolderClass]\n            });\n\n            setHeader();\n            setBody();\n            setFooter();\n\n            return dialogue;\n        },\n\n        /**\n         * Delete content\n         * @method deleteContent\n         */\n        deleteContent: function() {\n\n            M.util.js_pending('openstudioDeleteContent');\n\n            var promises = Ajax.call([{\n                methodname: 'mod_openstudio_external_delete_content',\n                args: {\n                    id: t.mconfig.id,\n                    cid: t.mconfig.cid,\n                    containingfolder: t.mconfig.folderid\n                }\n            }]);\n\n            promises[0]\n                .done(function(res) {\n                    var url = '';\n                    if (t.mconfig.folderid) {\n                        url = SiteConfig.wwwroot + '/mod/openstudio/folder.php?sid=' + t.mconfig.folderid;\n                    } else {\n                        if (t.mconfig.isactivitycontent) {\n                            url = window.location.href;\n                        } else {\n                            url = SiteConfig.wwwroot + '/mod/openstudio/view.php?vid=' + res.vid;\n                        }\n                    }\n\n                    url += '&id=' + t.mconfig.id;\n\n                    // Redirect to containing view.\n                    window.location.href = url;\n                })\n                .always(function() {\n                    M.util.js_complete('openstudioDeleteContent');\n                })\n                .fail(function(ex) {\n                    window.console.error('Log request failed ' + ex.message);\n                });\n        },\n\n        /**\n         * Resize and update dialogue position.\n         * @method resize\n         */\n        resize: function() {\n            if (!t.dialogue) {\n                return;\n            }\n\n            if (t.dialogue.get('visible')) {\n                if (Y.one('body').get('winWidth') <= t.dialogue.get('responsiveWidth')) {\n                    t.dialogue.makeResponsive();\n                } else {\n                    t.dialogue.centerDialogue();\n                }\n            }\n        }\n    };\n\n    return t;\n});\n"],"names":["define","$","Ajax","Str","SiteConfig","require","t","mconfig","CSS","DELETEBUTTON","DIALOGHEADER","DELETEDIALOGUECONTAINER","init","options","Y","use","osDialogue","dialogue","createDeleteDialogue","on","show","window","resize","bind","hasFolderClass","isfolder","folderid","langstring","cancelBtnProperty","deleteBtnProperty","closeButton","visible","centered","modal","responsive","width","responsiveWidth","focusOnPreviousTargetAfterHide","extraClasses","replace","get_string","done","s","set","setBody","name","classNames","action","events","click","deleteContent","get_strings","key","component","label","addButton","M","util","js_pending","call","methodname","args","id","cid","containingfolder","res","url","wwwroot","isactivitycontent","location","href","vid","always","js_complete","fail","ex","console","error","message","get","one","makeResponsive","centerDialogue"],"mappings":";;;;;;;AA0BAA,+BAAO,CACH,SACA,YACA,WACA,cACA,YACD,SAASC,EAAGC,KAAMC,IAAKC,WAAYC,aAC9BC,SACJA,EAAI,CAaAC,QAAS,KAKTC,IAAK,CACDC,aAAc,mBACdC,aAAc,qCACdC,wBAAyB,+BAS7BC,KAAM,SAASC,SAEXP,EAAEC,QAAUM,QAGZC,EAAEC,IAAI,qCAAqC,WACvCV,QAAQ,CAAC,8BAA8B,SAASW,YAC5CV,EAAEW,SAAWX,EAAEY,qBAAqBF,kBAK5Cf,EAAEK,EAAEE,IAAIC,cAAcU,GAAG,SAAS,WAC1Bb,EAAEW,UACFX,EAAEW,SAASG,UAKnBnB,EAAEoB,QAAQC,OAAOhB,EAAEgB,OAAOC,KAAKjB,KAUnCY,qBAAsB,SAASF,gBA8DvBQ,eAAiB,GACjBlB,EAAEC,QAAQkB,SACVD,eAAiB,oBACXlB,EAAEC,QAAQmB,WAChBF,eAAiB,sCA5DbG,WA6BAC,kBAOAC,kBA0BJZ,SAAW,IAAID,WAAW,CAC1Bc,aAAa,EACbC,SAAS,EACTC,UAAU,EACVC,OAAO,EACPC,YAAY,EACZC,MAAO,IACPC,gBAAiB,IACjBC,gCAAgC,EAChCC,aAAc,CAAChC,EAAEE,IAAIG,wBAAwB4B,QAAQ,IAAK,IAAKf,yBAvE3DG,WAAcrB,EAAEC,QAAQkB,SAAY,sBAAwB,8BAChEtB,IACKqC,WAAWb,WAAY,kBACvBc,MAAK,SAASC,GACXzB,SAAS0B,IAAI,gBACT,gBAAkBrC,EAAEE,IAAIE,aAAa6B,QAAQ,IAAK,IAClD,KAAOG,EAAI,6BASnBf,WAAcrB,EAAEC,QAAQkB,SAAY,sBAAwB,uBAChEtB,IACKqC,WAAWb,WAAY,kBACvBc,MAAK,SAASC,GACXzB,SAAS0B,IAAI,cAAeD,MAwDxCE,GA9CQhB,kBAAoB,CACpBiB,KAAM,SACNC,WAAY,+BACZC,OAAQ,QAIRlB,kBAAoB,CACpBgB,KAAM,SACNC,WAAY,2BACZE,OAAQ,CACJC,MAAO3C,EAAE4C,cAAc3B,KAAKjB,KAIpCH,IACKgD,YAAY,CACT,CAACC,IAAK,uBAAwBC,UAAW,kBACzC,CAACD,IAAK,cAAeC,UAAW,oBAEnCZ,MAAK,SAASC,GACXd,kBAAkB0B,MAAQZ,EAAE,GAC5Bb,kBAAkByB,MAAQZ,EAAE,GAC5BzB,SAASsC,UAAU1B,kBAAmB,CAAC,WACvCZ,SAASsC,UAAU3B,kBAAmB,CAAC,cAyB5CX,UAOXiC,cAAe,WAEXM,EAAEC,KAAKC,WAAW,2BAEHxD,KAAKyD,KAAK,CAAC,CACtBC,WAAY,yCACZC,KAAM,CACFC,GAAIxD,EAAEC,QAAQuD,GACdC,IAAKzD,EAAEC,QAAQwD,IACfC,iBAAkB1D,EAAEC,QAAQmB,aAI3B,GACJe,MAAK,SAASwB,SACPC,IAAM,GAENA,IADA5D,EAAEC,QAAQmB,SACJtB,WAAW+D,QAAU,kCAAoC7D,EAAEC,QAAQmB,SAErEpB,EAAEC,QAAQ6D,kBACJ/C,OAAOgD,SAASC,KAEhBlE,WAAW+D,QAAU,gCAAkCF,IAAIM,IAIzEL,KAAO,OAAS5D,EAAEC,QAAQuD,GAG1BzC,OAAOgD,SAASC,KAAOJ,OAE1BM,QAAO,WACJhB,EAAEC,KAAKgB,YAAY,8BAEtBC,MAAK,SAASC,IACXtD,OAAOuD,QAAQC,MAAM,sBAAwBF,GAAGG,aAQ5DxD,OAAQ,WACChB,EAAEW,UAIHX,EAAEW,SAAS8D,IAAI,aACXjE,EAAEkE,IAAI,QAAQD,IAAI,aAAezE,EAAEW,SAAS8D,IAAI,mBAChDzE,EAAEW,SAASgE,iBAEX3E,EAAEW,SAASiE"}