{"version":3,"file":"orderposts.min.js","sources":["../src/orderposts.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript to order posts on folder.\n *\n * @package mod_openstudio\n * @copyright 2017 The Open University\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_openstudio/orderposts\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/str',\n    'core/templates',\n    'require'\n], function($, Ajax, Str, Templates, require) {\n    var t;\n    t = {\n\n        /**\n         * Module config. Passed from server side.\n         * {\n         *     contents: [\n         *         {\n         *             fullname: string,\n         *             date: string,\n         *             userpictureurl: string,\n         *             order: int,\n         *             orderstring: string,\n         *             locked: bool\n         *         }\n         *     ]\n         * }\n         */\n        mconfig: null,\n\n        /**\n         * List out all of css selector used in this module.\n         */\n        CSS: {\n            // Buttons.\n            ORDER_POSTS_BUTTON: '#id_orderpost',\n            MOVE_UP_BUTTON: '.openstudio-orderpost-item-moveup-button',\n            MOVE_DOWN_BUTTON: '.openstudio-orderpost-item-movedown-button',\n            SAVE_ORDER_BUTTON: '.openstudio-orderpost-save-button',\n\n            // Input.\n            ORDER_NUMBER_INPUT: '.openstudio-orderpost-item-order-number-input',\n\n            // Post item.\n            ITEM_CONTAINER: '.openstudio-orderpost-item',\n            ITEM_ORDER: '.openstudio-orderpost-item-order',\n\n            // Dialogue.\n            ORDER_POSTS_DIALOGUE_CONTAINER: '.openstudio-orderposts-dialogue'\n        },\n\n        /**\n         * Initialize module.\n         *\n         * @method init\n         * @param {JSON} options  The settings for this feature.\n         */\n        init: function(options) {\n\n            t.mconfig = options;\n\n            // Create order posts dialogue.\n            Y.use('moodle-core-notification-dialogue', function() {\n                require(['mod_openstudio/osdialogue'], function(osDialogue) {\n                    t.dialogue = t.createOrderPostsDialogue(osDialogue);\n                });\n            });\n            // Register events.\n            $(t.CSS.ORDER_POSTS_BUTTON).on('click', function() {\n                if (t.dialogue) {\n                    $('.openstudio-folder-posts-dialogue .openstudio-orderpost').remove();\n                    t.setBody(t.dialogue);\n                    t.dialogue.show();\n                    var listorder = t.getListOrderPost();\n                    var sortedlistorderpost = [];\n                    $.each(listorder, function(index, value) {\n                        sortedlistorderpost[index] = value[0];\n                    });\n                    t.mconfig.listorder = sortedlistorderpost.join(',');\n                    setTimeout(function() {\n                        t.resize();\n                    }, 200);\n                }\n            });\n\n            $('body')\n                .delegate(t.CSS.SAVE_ORDER_BUTTON, 'click', t.saveOrder)\n                .delegate(t.CSS.MOVE_UP_BUTTON, 'click', t.moveUp)\n                .delegate(t.CSS.MOVE_DOWN_BUTTON, 'click', t.moveDown)\n                .delegate(t.CSS.ORDER_NUMBER_INPUT, 'keyup', t.handleNumberInputEnter)\n                .delegate(t.CSS.ORDER_NUMBER_INPUT, 'blur', t.handleNumberInputBlur);\n\n            // Responsive.\n            $(window).resize(t.resize.bind(t));\n        },\n\n        /**\n         * Create order posts dialogue and some events on it.\n         *\n         * @param {object} osDialogue object\n         * @return {object} OSDialogue instance\n         * @method createDeleteDialogue\n         */\n        createOrderPostsDialogue: function(osDialogue) {\n            /**\n             * Set header for dialog\n             * @method setHeader\n             */\n            function setHeader() {\n                Str\n                    .get_string('folderorderpost', 'mod_openstudio')\n                    .done(function(s) {\n                        dialogue.set('headerContent', '<span>' + s + '</span>');\n                    });\n            }\n\n            var dialogue = new osDialogue({\n                closeButton: true,\n                visible: false,\n                centered: true,\n                modal: true,\n                responsive: true,\n                width: 640,\n                responsiveWidth: 767,\n                focusOnPreviousTargetAfterHide: true,\n                extraClasses: [\n                    t.CSS.ORDER_POSTS_DIALOGUE_CONTAINER.replace('.', ''),\n                    'openstudio-folder-posts-dialogue'\n                ]\n            });\n\n            setHeader();\n            t.setBody(dialogue);\n\n            return dialogue;\n        },\n\n        /**\n         * Set body for dialog\n         * @param {object} dialogue object\n         * @method setBody\n         */\n        setBody: function(dialogue) {\n\n            M.util.js_pending('openstudioGetOrderPostsFolderContent');\n            var promises = Ajax.call([{\n                methodname: 'mod_openstudio_external_get_order_posts',\n                args: {\n                    cmid: t.mconfig.cmid,\n                    folderid: t.mconfig.folderid\n                }\n            }]);\n\n            promises[0]\n                .done(function(res) {\n                   dialogue.set('bodyContent', res.html);\n                    // Disable first move up button and last move down button.\n                    t.disableFirstLastButton();\n                    $(document).ready(t.disableContentButton);\n                    t.checkReorder();\n                    t.inputPosition();\n                    $(t.CSS.SAVE_ORDER_BUTTON).attr(\"disabled\", \"disabled\");\n                    t.resize();\n                })\n                .always(function() {\n                    M.util.js_complete('openstudioGetOrderPostsFolderContent');\n                })\n                .fail(function(ex) {\n                    window.console.error('Log request failed ' + ex.message);\n                });\n        },\n\n        /**\n         * Move item up.\n         *\n         * @method moveUp\n         */\n        moveUp: function() {\n            var item = $(this).closest(t.CSS.ITEM_CONTAINER);\n            var itemOrder = item.find(t.CSS.ITEM_ORDER).attr('data-order');\n            itemOrder = parseInt(itemOrder);\n\n            // Swap items.\n            t.swapItems(itemOrder, itemOrder - 1, item);\n        },\n\n        /**\n         * Move item down.\n         *\n         * @method moveDown\n         */\n        moveDown: function() {\n            var item = $(this).closest(t.CSS.ITEM_CONTAINER);\n            var itemOrder = item.find(t.CSS.ITEM_ORDER).attr('data-order');\n            itemOrder = parseInt(itemOrder);\n\n            // Swap items.\n            t.swapItems(itemOrder, itemOrder + 1, item);\n        },\n\n        /**\n         * Move item to certain position.\n         *\n         * @method moveTo\n         */\n        moveTo: function() {\n\n            var desiredOrder = $(this).val();\n            if (desiredOrder <= 0 || desiredOrder > t.mconfig.total) {\n                return;\n            }\n            var item = $(this).closest(t.CSS.ITEM_CONTAINER);\n            var itemOrder = item.find(t.CSS.ITEM_ORDER).attr('data-order');\n            itemOrder = parseInt(itemOrder);\n\n            var lastOrder = $(t.CSS.ITEM_CONTAINER).last().find(t.CSS.ITEM_ORDER).attr('data-order');\n            lastOrder = parseInt(lastOrder);\n\n            var currentorder = $('div[data-order=' + itemOrder + ']').hasClass('openstudio-orderpost-item-canreorder');\n            var itemMove = $('div[data-order=' + desiredOrder + ']').hasClass('openstudio-orderpost-item-canreorder');\n            if (currentorder && itemMove) {\n                Str\n                .get_string('foldercontentcannotreorder', 'mod_openstudio')\n                .done(function(s) {\n                   t.showErrorMessage(s);\n                });\n                return;\n            }\n\n            // To cover the case that user's input is out of boundary.\n            if (desiredOrder > lastOrder) {\n                desiredOrder = lastOrder;\n            }\n\n            if (desiredOrder < 1) {\n                desiredOrder = 1;\n            }\n\n            // Swap items.\n            t.swapItems(itemOrder, desiredOrder, item);\n        },\n\n        /**\n         * Save order to database.\n         *\n         * @method saveOrder\n         */\n        saveOrder: function() {\n            $(t.CSS.ORDER_NUMBER_INPUT).each(function() {\n                var order = $(this).val().trim();\n                var item = $(this).closest(t.CSS.ITEM_CONTAINER);\n                var itemOrder = item.find(t.CSS.ITEM_ORDER).attr('data-order');\n                itemOrder = parseInt(itemOrder);\n                if (order != itemOrder) {\n                    t.swapItems(itemOrder, order, item);\n                }\n            });\n\n            M.util.js_pending('openstudioOrderPostsFolderContent');\n            var textlistcontent = t.getListOrderPost(true);\n            var newlistcontent = {};\n            var currentorder = '';\n            var neworder = '';\n\n            // Get new order list.\n            $.each(textlistcontent, function(index, value) {\n                neworder = value[0];\n                currentorder = value[1];\n                if (neworder != currentorder) {\n                    newlistcontent[currentorder - 1] = neworder;\n                }\n            });\n\n            textlistcontent = '';\n            $.each(newlistcontent, function(index, value) {\n                textlistcontent += index + '-' + value + ',';\n            });\n\n            textlistcontent = textlistcontent.substr(0, textlistcontent.length - 1);\n\n            var promises = Ajax.call([{\n                methodname: 'mod_openstudio_external_order_posts',\n                args: {\n                    cmid: t.mconfig.cmid,\n                    folderid: t.mconfig.folderid,\n                    listorderporst: textlistcontent\n                }\n            }]);\n\n            promises[0]\n                .done(function() {\n                    window.location.reload();\n                })\n                .always(function() {\n                    M.util.js_complete('openstudioOrderPostsFolderContent');\n                })\n                .fail(function(ex) {\n                    window.console.error('Log request failed ' + ex.message);\n                });\n        },\n\n        /**\n         * Swap position between 2 items.\n         *\n         * @param {int} fromOrderNumber Original order\n         * @param {int} toOrderNumber Desired order\n         * @param {object} element Dom Element\n         * @method swapItems\n         */\n        swapItems: function(fromOrderNumber, toOrderNumber, element) {\n            var reoderLock = false;\n            var targetElement = $(t.CSS.ITEM_ORDER + '[data-order=\"' + toOrderNumber + '\"]');\n\n            if (element.find(t.CSS.ITEM_ORDER).hasClass('openstudio-orderpost-item-canreorder')) {\n                reoderLock = t.checkReorderLock(fromOrderNumber, toOrderNumber);\n            }\n\n            if (reoderLock == true) {\n                Str\n                .get_string('foldercontentcannotreorder', 'mod_openstudio')\n                .done(function(s) {\n                   t.showErrorMessage(s);\n                });\n                return;\n            }\n\n            if (targetElement.length > 0) {\n                if (fromOrderNumber < toOrderNumber) {\n                    // Move down\n                    targetElement.closest(t.CSS.ITEM_CONTAINER).after(element);\n                } else {\n                    // Move up\n                    targetElement.closest(t.CSS.ITEM_CONTAINER).before(element);\n                }\n\n                // Re-range the order numbers.\n                $(t.CSS.ITEM_CONTAINER).each(function(index) {\n                    index = index + 1;\n                    var orderNumberString = (index < 10) ? '0' + index : '' + index;\n                    $(this).find(t.CSS.ITEM_ORDER)\n                        .attr('data-order', index)\n                        .text(orderNumberString);\n\n                    $(this).find(t.CSS.ORDER_NUMBER_INPUT)\n                        .val(index);\n\n                    // Replace title attribute of move up button with new order.\n                    var moveUpButtonTitle = $(this).find(t.CSS.MOVE_UP_BUTTON).attr('title');\n                    var moveUpButtonOrderArr = moveUpButtonTitle.match(/([0-9-.]+)/g);\n                    if (moveUpButtonOrderArr !== null) {\n                        var moveUpButtonOrderArrLength = moveUpButtonOrderArr.length;\n                        // Get last match.\n                        var moveUpButtonOrder = moveUpButtonOrderArr[moveUpButtonOrderArrLength - 1];\n                        var moveUpButtonNewTitle = moveUpButtonTitle.replace(moveUpButtonOrder, index - 1 + '.');\n\n                        $(this).find(t.CSS.MOVE_UP_BUTTON).attr('title', moveUpButtonNewTitle);\n                    }\n\n                    // Replace title attribute of move down button with new order.\n                    var moveDownButtonTitle = $(this).find(t.CSS.MOVE_DOWN_BUTTON).attr('title');\n                    var moveDownButtonOrderArr = moveDownButtonTitle.match(/([0-9-.]+)/g);\n                    if (moveDownButtonOrderArr !== null) {\n                        var moveDownButtonOrderArrLength = moveDownButtonOrderArr.length;\n                        // Get last match.\n                        var moveDownButtonOrder = moveDownButtonOrderArr[moveDownButtonOrderArrLength - 1];\n                        var moveDownButtonNewTitle = moveDownButtonTitle.replace(moveDownButtonOrder, index + 1 + '.');\n\n                        $(this).find(t.CSS.MOVE_DOWN_BUTTON).attr('title', moveDownButtonNewTitle);\n                    }\n\n                });\n            }\n\n            // Handle Save Order Button\n            var currentorder = t.mconfig.listorder;\n            var sortable = t.getListOrderPost();\n            var sortedlistorderpost = [];\n            $.each(sortable, function(index, value) {\n                sortedlistorderpost[index] = value[0];\n            });\n            var neworder = sortedlistorderpost.join(',');\n\n            t.enableSaveOrder(currentorder, neworder);\n            t.checkReorder();\n            t.disableContentButton();\n            t.disableFirstLastButton();\n        },\n\n        /**\n         * Resize and update dialogue position.\n         * @method resize\n         */\n        resize: function() {\n            if (!t.dialogue) {\n                return;\n            }\n\n            if (t.dialogue.get('visible')) {\n                if (Y.one('body').get('winWidth') < t.dialogue.get('responsiveWidth')) {\n                    t.dialogue.makeResponsive();\n                    $(t.CSS.SAVE_ORDER_BUTTON).removeClass('osep-smallbutton');\n                } else {\n                    $(t.CSS.SAVE_ORDER_BUTTON).addClass('osep-smallbutton');\n                    if (Y.one('body').get('winWidth') >= 767) {\n                        t.dialogue.set('width', 640);\n                    } else {\n                        t.dialogue.set('width', 500);\n                    }\n                    t.dialogue.centerDialogue();\n                }\n            }\n        },\n\n        /**\n         * Get list order porst according to their new positions\n         *\n         * @return {string} textlistcontent list of order post\n         * @param {bool} filterBookContent book content\n         * @method getListOrderPost\n         * @return {Array} sortable\n         */\n        getListOrderPost: function(filterBookContent) {\n            var listorderporst = {};\n            // Re-range the order numbers.\n            $(t.CSS.ITEM_CONTAINER).each(function() {\n                var orderElement = $(this).find(t.CSS.ITEM_ORDER);\n                if (filterBookContent) {\n                    if (orderElement.hasClass('openstudio-orderpost-item-book')) {\n                        return;\n                    }\n                }\n                listorderporst[orderElement.attr('data-order')]\n                    = orderElement.attr('data-original-order');\n            });\n\n            var sortable = [];\n            for (var order in listorderporst) {\n                sortable.push([order, listorderporst[order]]);\n            }\n\n            sortable.sort(function(a, b) {\n                return a[1] - b[1];\n            });\n\n            return sortable;\n        },\n\n        /**\n         * Enable save order .\n         *\n         * @param {string} currentorder list of current order\n         * @param {string} neworder list of new order\n         * @method enableSaveOrder\n         */\n        enableSaveOrder: function(currentorder, neworder) {\n            if (currentorder != neworder) {\n                $(t.CSS.SAVE_ORDER_BUTTON).removeAttr(\"disabled\");\n            } else {\n               $(t.CSS.SAVE_ORDER_BUTTON).attr(\"disabled\", \"disabled\");\n            }\n        },\n\n        /**\n         * Input move item to certain position.\n         *\n         * @method enableSaveOrder\n         */\n        inputPosition: function() {\n            $(document).ready(function() {\n                $(t.CSS.ORDER_NUMBER_INPUT).keyup(function() {\n                    t.enableSaveOrder($(this).val().length, 0);\n                    var order = $(this).val();\n                    if (order && !$.isNumeric(order)) {\n                        Str\n                        .get_string('errormoveslotnumeric', 'mod_openstudio')\n                        .done(function(s) {\n                           t.showErrorMessage(s);\n                        });\n                    } else {\n                        if (parseInt(order) > t.mconfig.total || parseInt(order) <= 0) {\n                            Str\n                            .get_string('errormoveslotoutofrange', 'mod_openstudio')\n                            .done(function(s) {\n                               t.showErrorMessage(s);\n                            });\n                        } else {\n                            t.showErrorMessage('');\n                        }\n                    }\n                    $(this).val(order);\n                });\n            });\n        },\n\n        /**\n         * Disable first move up button and last move down button.\n         *\n         * @method disableFirstLastButton\n         */\n        disableFirstLastButton: function() {\n            // Enable all move-up, move-down buttons except booked item.\n            // Book items are back contents that have never uploaded yet.\n            $(t.CSS.MOVE_UP_BUTTON + ':not(.openstudio-orderpost-item-book)').removeAttr(\"disabled\");\n            $(t.CSS.MOVE_DOWN_BUTTON + ':not(.openstudio-orderpost-item-book)').removeAttr(\"disabled\");\n\n            $(t.CSS.MOVE_UP_BUTTON + ':first').attr(\"disabled\", \"disabled\");\n            $(t.CSS.MOVE_DOWN_BUTTON + ':last').attr(\"disabled\", \"disabled\");\n\n        },\n\n        /**\n         * Disable move up button and last move down button.\n         *\n         * @method enableSaveOrder\n         */\n        disableContentButton: function() {\n            $('.openstudio-orderpost-item-book').attr(\"disabled\", \"disabled\");\n        },\n\n        /**\n         * Disable move up button and move down button.\n         *\n         * @method checkReorder\n         */\n        checkReorder: function() {\n            $(t.CSS.ITEM_CONTAINER).each(function() {\n                var classCheck = 'openstudio-orderpost-item-canreorder';\n                if ($(this).find(t.CSS.ITEM_ORDER).hasClass('openstudio-orderpost-item-canreorder')) {\n                    var nextItem = $(this).next();\n                    if (nextItem.find(t.CSS.ITEM_ORDER).hasClass(classCheck)) {\n                        t.disableContentButton();\n                    } else {\n                        t.showErrorMessage('');\n                    }\n                }\n\n            });\n        },\n\n        /**\n         * Handle reorder lock content\n         *\n         * @param {int} currentOrderNumber Original order\n         * @param {int} toOrderNumber Desired order\n         * @return {bool} true when move this content beyond other fixed contents.\n         */\n        checkReorderLock: function(currentOrderNumber, toOrderNumber) {\n            var firstitem = '';\n            var lastitem = '';\n            var currentElement = '';\n            var classCheck = 'openstudio-orderpost-item-canreorder';\n            if (currentOrderNumber > toOrderNumber) {\n                firstitem = toOrderNumber;\n                lastitem = currentOrderNumber;\n            } else {\n                firstitem = currentOrderNumber;\n                lastitem = toOrderNumber;\n            }\n\n            if (currentOrderNumber < toOrderNumber) {\n                firstitem = firstitem + 1;\n                while (firstitem <= lastitem) {\n                    currentElement = $(t.CSS.ITEM_ORDER + '[data-order=\"' + firstitem + '\"]');\n                    if (currentElement.hasClass(classCheck)) {\n                        return true;\n                    }\n                    firstitem++;\n                }\n            } else {\n                lastitem = lastitem - 1;\n                while (lastitem >= firstitem) {\n                    currentElement = $(t.CSS.ITEM_ORDER + '[data-order=\"' + lastitem + '\"]');\n                    if (currentElement.hasClass(classCheck)) {\n                        return true;\n                    }\n                    lastitem--;\n                }\n            }\n\n            return false;\n        },\n\n        /**\n         * Show error message in the title next  label text.\n         *\n         * @method showErrorMessage\n         * @param {string} message The error text to use\n         */\n        showErrorMessage: function(message) {\n            $('.openstudio-message-error').text(message);\n        },\n\n        /**\n         * Triggered whenever user press enter key on order input.\n         *\n         * @method handleNumberInputEnter\n         * @param {object} e Dom Event\n         */\n        handleNumberInputEnter: function(e) {\n            if (e.which !== 13) { // Press enter key.\n                return;\n            }\n\n            t.moveTo.call(this);\n        },\n\n        /**\n         * Triggered whenever order input is lost focus.\n         *\n         * @method handleNumberInputBlur\n         */\n        handleNumberInputBlur: function() {\n            t.moveTo.call(this);\n        }\n    };\n\n    return t;\n});\n"],"names":["define","$","Ajax","Str","Templates","require","t","mconfig","CSS","ORDER_POSTS_BUTTON","MOVE_UP_BUTTON","MOVE_DOWN_BUTTON","SAVE_ORDER_BUTTON","ORDER_NUMBER_INPUT","ITEM_CONTAINER","ITEM_ORDER","ORDER_POSTS_DIALOGUE_CONTAINER","init","options","Y","use","osDialogue","dialogue","createOrderPostsDialogue","on","remove","setBody","show","listorder","getListOrderPost","sortedlistorderpost","each","index","value","join","setTimeout","resize","delegate","saveOrder","moveUp","moveDown","handleNumberInputEnter","handleNumberInputBlur","window","bind","closeButton","visible","centered","modal","responsive","width","responsiveWidth","focusOnPreviousTargetAfterHide","extraClasses","replace","get_string","done","s","set","M","util","js_pending","call","methodname","args","cmid","folderid","res","html","disableFirstLastButton","document","ready","disableContentButton","checkReorder","inputPosition","attr","always","js_complete","fail","ex","console","error","message","item","this","closest","itemOrder","find","parseInt","swapItems","moveTo","desiredOrder","val","total","lastOrder","last","currentorder","hasClass","itemMove","showErrorMessage","order","trim","textlistcontent","newlistcontent","neworder","substr","length","listorderporst","location","reload","fromOrderNumber","toOrderNumber","element","reoderLock","targetElement","checkReorderLock","after","before","orderNumberString","text","moveUpButtonTitle","moveUpButtonOrderArr","match","moveUpButtonOrder","moveUpButtonNewTitle","moveDownButtonTitle","moveDownButtonOrderArr","moveDownButtonOrder","moveDownButtonNewTitle","sortable","enableSaveOrder","get","one","makeResponsive","removeClass","addClass","centerDialogue","filterBookContent","orderElement","push","sort","a","b","removeAttr","keyup","isNumeric","next","currentOrderNumber","firstitem","lastitem","classCheck","e","which"],"mappings":"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"}