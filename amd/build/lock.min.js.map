{"version":3,"file":"lock.min.js","sources":["../src/lock.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript to manage lock/unlock feature.\n *\n * @package\n * @copyright 2017 The Open University\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_openstudio/lock\n */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/str'\n], function($, Ajax, Str) {\n    var t;\n    t = {\n\n        /**\n         * Module config. Passed from server side.\n         * {\n         *     cmid: int,\n         *     cid: int,\n         *     isfolder: bool,\n         *     CONST: {\n         *         ALL: int,\n         *         NONE: int\n         *     }\n         */\n        mconfig: null,\n\n        /**\n         * List out all of css selector used in lock module.\n         */\n        CSS: {\n            LOCKBUTTON: '#id_lockbutton',\n            ACTIONITEMS: '.openstudio-content-actions'\n        },\n\n        /**\n         * Initialize module.\n         *\n         * @method init\n         * @param {JSON} options  The settings for lock feature.\n         */\n        init: function(options) {\n\n            t.mconfig = options;\n\n            // Click event on lock/unlock content buttons.\n            $(t.CSS.LOCKBUTTON).on('click', t.toggleLockContent.bind(t));\n        },\n\n        /**\n         * Lock/Unlock content.\n         *\n         * @method toggleLockContent\n         */\n        toggleLockContent: function() {\n            var isLocked = $(t.CSS.LOCKBUTTON).attr('data-lockstate') == 'locked';\n            if (isLocked) {\n                t.unlockContent();\n            } else {\n                t.lockContent();\n            }\n        },\n\n        /**\n         * Lock content\n         * @method lockContent\n         */\n        lockContent: function() {\n\n            M.util.js_pending('openstudioLockContent');\n\n            var promises = Ajax.call([{\n                methodname: 'mod_openstudio_external_lock',\n                args: {\n                    cmid: t.mconfig.cmid,\n                    cid: t.mconfig.cid,\n                    locktype: t.mconfig.CONST.ALL\n                }\n            }]);\n\n            promises[0]\n                .done(function() {\n                    var unlockstring = t.mconfig.isfolder ? 'folderunlockfolder' : 'contentactionunlockname';\n                    Str\n                        .get_string(unlockstring, 'mod_openstudio')\n                        .done(function(s) {\n                            $(t.CSS.LOCKBUTTON)\n                                .attr('value', s)\n                                .attr('data-lockstate', 'locked');\n                        });\n\n                    // Hide othes action items like flags, edit, add new comment, ...\n                    $(t.CSS.ACTIONITEMS).addClass('locked');\n\n                    // Show lock banner.\n                    $('#openstudio_item_lock').removeClass('openstudio-item-unlock').addClass('openstudio-item-lock');\n                })\n                .always(function() {\n                    M.util.js_complete('openstudioLockContent');\n                })\n                .fail(function(ex) {\n                    window.console.error('Log request failed ' + ex.message);\n                });\n        },\n\n        /**\n         * Unlock content.\n         * @method unlockContent\n         */\n        unlockContent: function() {\n\n            M.util.js_pending('openstudioUnlockContent');\n\n            var promises = Ajax.call([{\n                methodname: 'mod_openstudio_external_unlock',\n                args: {\n                    cmid: t.mconfig.cmid,\n                    cid: t.mconfig.cid,\n                    locktype: t.mconfig.CONST.NONE\n                }\n            }]);\n\n            promises[0]\n                .done(function() {\n                    var lockstring = t.mconfig.isfolder ? 'folderlockfolder' : 'contentactionlockname';\n                    Str\n                        .get_string(lockstring, 'mod_openstudio')\n                        .done(function(s) {\n                            $(t.CSS.LOCKBUTTON)\n                                .attr('value', s)\n                                .attr('data-lockstate', 'unlocked');\n                        });\n\n                    // Show othes action items like flags, edit, delete, ...\n                    $(t.CSS.ACTIONITEMS).removeClass('locked');\n\n                    // Hide lock banner.\n                    $('#openstudio_item_lock').addClass('openstudio-item-unlock').removeClass('openstudio-item-lock');\n                })\n                .always(function() {\n                    M.util.js_complete('openstudioUnlockContent');\n                })\n                .fail(function(ex) {\n                    window.console.error('Log request failed ' + ex.message);\n                });\n        }\n    };\n\n    return t;\n});\n"],"names":["define","$","Ajax","Str","t","mconfig","CSS","LOCKBUTTON","ACTIONITEMS","init","options","on","toggleLockContent","bind","attr","unlockContent","lockContent","M","util","js_pending","call","methodname","args","cmid","cid","locktype","CONST","ALL","done","unlockstring","isfolder","get_string","s","addClass","removeClass","always","js_complete","fail","ex","window","console","error","message","NONE","lockstring"],"mappings":";;;;;;;AA0BAA,6BAAO,CACH,SACA,YACA,aACD,SAASC,EAAGC,KAAMC,SACbC,SACJA,EAAI,CAaAC,QAAS,KAKTC,IAAK,CACDC,WAAY,iBACZC,YAAa,+BASjBC,KAAM,SAASC,SAEXN,EAAEC,QAAUK,QAGZT,EAAEG,EAAEE,IAAIC,YAAYI,GAAG,QAASP,EAAEQ,kBAAkBC,KAAKT,KAQ7DQ,kBAAmB,WAC8C,UAA9CX,EAAEG,EAAEE,IAAIC,YAAYO,KAAK,kBAEpCV,EAAEW,gBAEFX,EAAEY,eAQVA,YAAa,WAETC,EAAEC,KAAKC,WAAW,yBAEHjB,KAAKkB,KAAK,CAAC,CACtBC,WAAY,+BACZC,KAAM,CACFC,KAAMnB,EAAEC,QAAQkB,KAChBC,IAAKpB,EAAEC,QAAQmB,IACfC,SAAUrB,EAAEC,QAAQqB,MAAMC,QAIzB,GACJC,MAAK,eACEC,aAAezB,EAAEC,QAAQyB,SAAW,qBAAuB,0BAC/D3B,IACK4B,WAAWF,aAAc,kBACzBD,MAAK,SAASI,GACX/B,EAAEG,EAAEE,IAAIC,YACHO,KAAK,QAASkB,GACdlB,KAAK,iBAAkB,aAIpCb,EAAEG,EAAEE,IAAIE,aAAayB,SAAS,UAG9BhC,EAAE,yBAAyBiC,YAAY,0BAA0BD,SAAS,2BAE7EE,QAAO,WACJlB,EAAEC,KAAKkB,YAAY,4BAEtBC,MAAK,SAASC,IACXC,OAAOC,QAAQC,MAAM,sBAAwBH,GAAGI,aAQ5D3B,cAAe,WAEXE,EAAEC,KAAKC,WAAW,2BAEHjB,KAAKkB,KAAK,CAAC,CACtBC,WAAY,iCACZC,KAAM,CACFC,KAAMnB,EAAEC,QAAQkB,KAChBC,IAAKpB,EAAEC,QAAQmB,IACfC,SAAUrB,EAAEC,QAAQqB,MAAMiB,SAIzB,GACJf,MAAK,eACEgB,WAAaxC,EAAEC,QAAQyB,SAAW,mBAAqB,wBAC3D3B,IACK4B,WAAWa,WAAY,kBACvBhB,MAAK,SAASI,GACX/B,EAAEG,EAAEE,IAAIC,YACHO,KAAK,QAASkB,GACdlB,KAAK,iBAAkB,eAIpCb,EAAEG,EAAEE,IAAIE,aAAa0B,YAAY,UAGjCjC,EAAE,yBAAyBgC,SAAS,0BAA0BC,YAAY,2BAE7EC,QAAO,WACJlB,EAAEC,KAAKkB,YAAY,8BAEtBC,MAAK,SAASC,IACXC,OAAOC,QAAQC,MAAM,sBAAwBH,GAAGI"}