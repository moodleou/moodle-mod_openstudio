/**
 * JavaScript to manage on view page.
 *
 * @package
 * @copyright 2017 The Open University
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_openstudio/viewhelper",["jquery","js/isotope.pkgd.min.js"],(function($,Isotope){var t;return t={isotope:[],mconfig:null,CSS:{SEARCHBOX:"#oustudyplan-query"},SELECTOR:{FILTER_CONTAINER:"#filter_container",FILTER_FORM:"#openstudio-filter-form",SELECT_FROM:"#openstudio-filter-select-from",AREA_ALL:"#filter_block_0",AREA_ACTIVITIES_ID:"#filter_block_2",AREA_INPUT:"#openstudio-filter-select-from .openstudio-filter-area-input",BLOCK_ITEM:"#openstudio-filter-select-from .openstudio-filter-block",ACTIVITY_ITEM:"#openstudio-filter-select-from .openstudio-filter-block-activity",FILTER_SORT_BY:".openstudio_filter_sort_by",FILTER_QUICK_SELECT:".openstudio_filter_quick_select",FILTER_LINK:".openstudio-filter-link a"},CONFIG:{searchtext:"",hasselectfrom:!1,hasfilterform:!1},init:function(options){t.mconfig=options||t.CONFIG,t.handleFilter(),t.handleIsotope(),t.handleGroupSwitcher(),t.handleViewSizeSwitcher(),t.handleBlockSwitcher(),t.initSearchForm(),t.handleCollapseClick(),t.mconfig.hasOwnProperty("hasselectfrom")&&!0===t.mconfig.hasselectfrom&&t.handleSelectFrom(t.SELECTOR.SELECT_FROM)},handleIsotope:function(){$(".openstudio-grid").each((function(){t.isotope[this.id]=new Isotope("#"+this.id,{layoutMode:"masonry",itemSelector:".openstudio-grid-item",masonry:{columnWidth:243,gutter:20,horizontalOrder:!0}})})),window.isotope=t.isotope,$(window).on("load",(function(){t.reArrangeItems()}))},reArrangeItems:function(){setTimeout((function(){for(var key in t.isotope)t.isotope.hasOwnProperty(key)&&t.isotope[key].layout()}),1e3)},handleGroupSwitcher:function(){$(document).on("change","#filter_groupid",(function(){t.redirectURL()}))},handleBlockSwitcher:function(){$(t.SELECTOR.AREA_INPUT).on("click",(function(){$(t.SELECTOR.AREA_INPUT).not(this).prop("checked",!1)})),$(t.SELECTOR.AREA_INPUT).on("change",(function(){var value=$(this).val(),checked=$(this).is(":checked"),areaActivityValue=$("#filter_area_activity_value").val(),checkBlocks=!1;checked?parseInt(value)===parseInt(areaActivityValue)&&(checkBlocks=!0):(value=0,$(t.SELECTOR.AREA_ALL).prop("checked",!0)),$(t.SELECTOR.BLOCK_ITEM).prop("checked",checkBlocks),$(t.SELECTOR.ACTIVITY_ITEM).prop("checked",checkBlocks),t.updateFilterBlock(value)}))},updateFilterBlock:function(value){$("#filter_block").val(value),$(t.SELECTOR.SELECT_FROM+"-placeholder").html($("#filter_block option:selected").text())},handleViewSizeSwitcher:function(){$(document).on("change","#filter_pagesize",(function(){t.redirectURL()})),$(document).on("change","#filter_pagesize_mobile",(function(){t.redirectURL()}))},redirectURL:function(){var url=$("#view_sort_action_url").val(),vid=$("#vid").val(),groupidelement=$("#groupid");if(groupidelement.length>0){var groupid=groupidelement.val();url=url+"&groupid="+groupid}url=url+"&vid="+vid,$(".openstudio-filter-select-box:visible").each((function(){var name=$(this).attr("name");url=url+"&"+name+"="+$(this).val()})),window.location.href=url},handleFilter:function(){$("#openstudio_filter_types_0").on("click",(function(e){if(!$(this).is(":checked"))return e.preventDefault(),!1;$(".openstudio-filter-types-checkbox").prop("checked",!1),$("#openstudio_filter_types_0").prop("checked",!0),t.updateQuickSelect(null)})),$(".openstudio-filter-types-checkbox").on("click",(function(){var checkbox=$(this);checkbox.is(":checked")&&"openstudio_filter_types_0"!=checkbox.attr("id")&&$("#openstudio_filter_types_0").prop("checked",!1),0==$('[name="ftypearray[]"]:checked').length&&$("#openstudio_filter_types_0").prop("checked",!0),t.updateQuickSelect(null)})),$("#openstudio_filter_user_flags_0").on("click",(function(e){if(!$(this).is(":checked"))return e.preventDefault(),!1;$(".openstudio-filter-user-flags-checkbox").prop("checked",!1),$("#openstudio_filter_user_flags_0").prop("checked",!0),t.updateQuickSelect(null)})),$(".openstudio-filter-user-flags-checkbox").on("click",(function(){var checkbox=$(this);checkbox.is(":checked")&&"openstudio_filter_types_0"!=checkbox.attr("id")&&$("#openstudio_filter_user_flags_0").prop("checked",!1),0==$('[name="fflagarray[]"]:checked').length&&$("#openstudio_filter_user_flags_0").prop("checked",!0),t.updateQuickSelect(null)})),$('input[name="fstatus"]').on("change",(function(){t.updateQuickSelect(null)})),$('input[name="fscope"]').on("change",(function(){t.updateQuickSelect(null)})),$("#reset_filter_btn").on("click",(function(){$("#reset_filter").val(1),$("#filteractive").val(0),$(t.SELECTOR.FILTER_FORM).submit()})),$(t.SELECTOR.BLOCK_ITEM).on("click",(function(){var checkbox=$(this),checkActivities=!1,className=".openstudio-filter-block-"+$(this).val()+"-activity";checkbox.is(":checked")&&(t.checkAreaInput(t.SELECTOR.AREA_ACTIVITIES_ID,!0),checkActivities=!0),$(className).prop("checked",checkActivities);var length=$('[name="fblockarray[]"]:checked').length,lengthActivity=$('[name="factivityarray[]"]:checked').length;0===length&&0===lengthActivity&&t.checkAreaInput(t.SELECTOR.AREA_ALL,!0)})),$(t.SELECTOR.ACTIVITY_ITEM).on("click",(function(){var checkbox=$(this),blockId=$(this).attr("data-block-id"),blockElementId="#openstudio_filter_block_"+blockId,hasUnchecked=$(".openstudio-filter-block-"+blockId+"-activity"+":not(:checked)").length;checkbox.is(":checked")&&(t.checkAreaInput(t.SELECTOR.AREA_ACTIVITIES_ID,!0),$(blockElementId).prop("checked",!0)),0===hasUnchecked?$(blockElementId).prop("checked",!0):$(blockElementId).prop("checked",!1),0===$(t.SELECTOR.ACTIVITY_ITEM+":checked").length&&t.checkAreaInput(t.SELECTOR.AREA_ALL,!0)})),t.handleSortBy(),t.handleQuickSelect()},handleCollapseClick:function(){for(var myprofile=document.querySelector(".openstudio-profile-mypaticipation-content"),fullusername=document.getElementById("openstudio_profile_fullusername"),profilleparticipate=document.querySelector("#openstudio_profile_bar .openstudio-profile-bar-participation-content"),profilleparticipatemobile=document.querySelector("#openstudio_profile_bar_mobile .openstudio-profile-bar-participation-content"),progressbar=document.getElementsByClassName("openstudio-profile-progress-content"),showprofile=null,showparticipate=null,body=document.querySelector("body"),i=0;i<progressbar.length;i++)progressbar&&progressbar[i]&&progressbar[i].clientHeight>0&&(showprofile=progressbar[i]);if(showparticipate=body.classList.contains("ios")||body.classList.contains("android")?profilleparticipatemobile:profilleparticipate,fullusername&&showprofile){var originalmarginTop=showprofile.style.marginTop?showprofile.style.marginTop:"0px",originalpaddingTop=showprofile.style.paddingTop?showprofile.style.paddingTop:"0px";fullusername.addEventListener("click",(function(){var w=window.innerWidth;(w>767&&w<1204&&!body.classList.contains("ios")&&!body.classList.contains("android")||w>767&&w<940&&(body.classList.contains("ios")||body.classList.contains("android")))&&(fullusername.classList.contains("collapsed")?setTimeout((function(){showparticipate&&fullusername.clientHeight>21&&(myprofile&&myprofile.getBoundingClientRect().height>showparticipate.getBoundingClientRect().height?showprofile.getBoundingClientRect().top>myprofile.getBoundingClientRect().bottom?showprofile.style.marginTop=originalmarginTop+3+"px":showprofile.style.marginTop=myprofile.getBoundingClientRect().bottom-showprofile.getBoundingClientRect().top+"px":showparticipate&&(showprofile.getBoundingClientRect().top>showparticipate.getBoundingClientRect().bottom?showprofile.style.marginTop=originalmarginTop+3+"px":showprofile.style.marginTop=showparticipate.getBoundingClientRect().bottom-showprofile.getBoundingClientRect().top+"px"),body.classList.contains("ios")||body.classList.contains("android")?showprofile.style.paddingTop="5px":showprofile.style.paddingTop="9px")}),500):(showprofile.style.paddingTop=originalpaddingTop,showprofile.style.marginTop=originalmarginTop))}))}},initSearchForm:function(){$(t.CSS.SEARCHBOX).val(t.mconfig.searchtext)},handleSelectFrom:function(id){$(id+"-placeholder").text($("#filter_block option:selected").text());var area=$(id),anchor=$(id+"-anchor"),contentArea=$(id+"-area");anchor.on("click",(function(){contentArea.hasClass("visible")?contentArea.removeClass("visible"):contentArea.addClass("visible")})),anchor.on("keydown",(function(e){32!==e.keyCode&&13!==e.keyCode||(e.preventDefault(),anchor.trigger("click"))})),$(window).click((function(e){var target=$(e.target),areaHTML=area.get(0),targetHTML=target.get(0);$.contains(areaHTML,targetHTML)||this===areaHTML||contentArea.hasClass("visible")&&contentArea.removeClass("visible")}))},checkAreaInput:function(input){let checked=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];$(input).prop("checked",checked),$(t.SELECTOR.AREA_INPUT).not(input).prop("checked",!checked),t.updateFilterBlock($(input).val())},isFilterExpanded:function(){return $(t.SELECTOR.FILTER_CONTAINER).hasClass("show")},handleSortBy:function(){$(t.SELECTOR.FILTER_SORT_BY).on("change",(function(){t.redirectURL()}))},handleQuickSelect:function(){$(t.SELECTOR.FILTER_QUICK_SELECT).on("change",(function(){var params=$(this).find(":selected").data("params"),value=$(this).val(),isMobile=$(this).data("mobile");t.isFilterExpanded()||isMobile||$(t.SELECTOR.FILTER_LINK).trigger("click"),"object"==typeof params&&0!==params.length&&(t.updateQuickSelect(value),params.hasOwnProperty("ftypearray")&&$('[name="ftypearray[]"]').val(params.ftypearray),params.hasOwnProperty("fflagarray")&&$('[name="fflagarray[]"]').val(params.fflagarray),params.hasOwnProperty("fstatus")&&$('[name="fstatus"]').val([params.fstatus]),params.hasOwnProperty("fscope")&&$('[name="fscope"]').val([params.fscope]),isMobile&&$(t.SELECTOR.FILTER_FORM).submit())}))},updateQuickSelect:function(){let value=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;$('[name="quickselect"]').val(value)}},t}));

//# sourceMappingURL=viewhelper.min.js.map