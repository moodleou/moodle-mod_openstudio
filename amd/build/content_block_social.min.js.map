{"version":3,"file":"content_block_social.min.js","sources":["../src/content_block_social.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript to manage content of social block.\n *\n * @package\n * @copyright 2022 The Open University\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_openstudio/content_block_social\n */\ndefine([\n    'jquery',\n    'core/templates',\n    'core/notification',\n    'core/ajax'\n], function($, Templates, displayException, Ajax) {\n    var t;\n    t = {\n\n        /**\n         * List out all of css selector used in this module.\n         */\n        CSS: {\n            // Buttons.\n            POPUP_COMMENT_CONTENT: '.show-popup-comment',\n            POPUP_COMMENT_TOGGLE: '.comments-content-popup',\n            COMMENT_BLOCK_LIST: '.comment-block-list',\n            FLAG_CONTENT_BLOCK: '.flag_content_block',\n            FLAG_CONTENT_TEXT: '.openstudio-grid-item-content-detail-info-text',\n            FLAG_CONTENT_TEXT_NEW: '.openstudio-grid-item-content-detail-info-text-new',\n            FLAG_CONTENT_ICON_IMAGE: 'img.openstudio-grid-item-content-detail-info-icon',\n            FLAG_CONTENT_ICON: '.openstudio-grid-item-content-detail-info-box'\n        },\n\n        /**\n         * Initialize module.\n         * @method init\n         */\n        init: function() {\n            // Click comment button.\n            $(t.CSS.POPUP_COMMENT_CONTENT).bind('click', function() {\n                t.getListComment($(this));\n            });\n            // Click emoticons button.\n            $(t.CSS.FLAG_CONTENT_BLOCK).bind('click', function() {\n                t.flagContent($(this));\n            });\n            // Keypress enter event when user tabbing.\n            $(t.CSS.FLAG_CONTENT_ICON).bind(\"keypress\", function(e) {\n                if (e.which == 13) {\n                    t.userOnPressFlagContent($(this));\n                }\n            });\n            t.updateFlagContentStyles();\n        },\n\n        /**\n         * Get list comment.\n         *\n         * @param {Object} e DomEvent\n         * @method getListComment\n         */\n        getListComment: function(e) {\n            let element = e;\n            let contentid = element.attr('data-contentid');\n            let cmid = element.attr('data-cmid');\n            if (contentid && cmid) {\n                $(t.CSS.COMMENT_BLOCK_LIST).empty();\n                const promises = Ajax.call([{\n                    methodname: 'mod_openstudio_external_get_comment_by_contentid',\n                    args: {\n                        cmid: cmid,\n                        contentid: contentid\n                    }\n                }]);\n                promises[0]\n                    .done(function(res) {\n                        if (res) {\n                            const context = {\n                                commentlist: res.comments || []\n                            };\n                            Templates.renderForPromise('mod_openstudio/commentlist_popup', context)\n                                .then(({html, js}) => {\n                                    return Templates.appendNodeContents(t.CSS.COMMENT_BLOCK_LIST, html, js);\n                                })\n                                .catch(err => displayException(err));\n                        }\n                    })\n                    .fail(displayException.exception);\n            }\n        },\n\n        /**\n         * Flag an action for a content.\n         *\n         * @param {Object} e DomEvent\n         * @method flagContent\n         */\n        flagContent: function(e) {\n            const cid = e.attr('data-contentid');\n            const cmid = e.attr('data-cmid');\n            const fid = e.attr('data-fid');\n            const mode = e.attr('data-mode');\n            const promises = Ajax.call([{\n                methodname: 'mod_openstudio_external_flag_content',\n                args: {cmid, cid, fid, mode}\n            }]);\n            promises[0]\n                .done(function(res) {\n                    if (res) {\n                        $(e).attr('data-mode', res.mode);\n                        let flagelement = $(e).find(t.CSS.FLAG_CONTENT_TEXT);\n                        if (flagelement) {\n                            flagelement.text(res.flagvalue || \"\");\n                        }\n                        if (flagelement.text().trim() !== '') {\n                            flagelement.addClass('has-value');\n                        } else {\n                            flagelement.removeClass('has-value');\n                        }\n                        $(e).find(t.CSS.FLAG_CONTENT_ICON_IMAGE).attr('src', res.flagiconimage);\n                    }\n                })\n                .fail(displayException.exception);\n        },\n\n        /**\n         * User on press flag icon to react emoticon.\n         *\n         * @param {Object} e DomEvent\n         * @method userOnPressFlagContent\n         */\n        userOnPressFlagContent: function(e) {\n            const cid = e.attr('data-contentid');\n            const cmid = e.attr('data-cmid');\n            const fid = e.attr('data-fid');\n            const mode = e.attr('data-mode');\n            if (cid && cmid && fid && mode) {\n                t.flagContent(e);\n            }\n        },\n\n        /**\n         * Update flag content styles based on value.\n         *\n         * @method updateFlagContentStyles\n         */\n        updateFlagContentStyles: function() {\n            $(t.CSS.FLAG_CONTENT_TEXT).each(function() {\n                if ($(this).text().trim() !== '') {\n                    $(this).addClass('has-value');\n                } else {\n                    $(this).removeClass('has-value');\n                }\n            });\n        },\n    };\n\n    return t;\n});\n"],"names":["define","$","Templates","displayException","Ajax","t","CSS","POPUP_COMMENT_CONTENT","POPUP_COMMENT_TOGGLE","COMMENT_BLOCK_LIST","FLAG_CONTENT_BLOCK","FLAG_CONTENT_TEXT","FLAG_CONTENT_TEXT_NEW","FLAG_CONTENT_ICON_IMAGE","FLAG_CONTENT_ICON","init","bind","getListComment","this","flagContent","e","which","userOnPressFlagContent","updateFlagContentStyles","element","contentid","attr","cmid","empty","call","methodname","args","done","res","context","commentlist","comments","renderForPromise","then","_ref","html","js","appendNodeContents","catch","err","fail","exception","cid","fid","mode","flagelement","find","text","flagvalue","trim","addClass","removeClass","flagiconimage","each"],"mappings":";;;;;;;AA0BAA,6CAAO,CACH,SACA,iBACA,oBACA,cACD,SAASC,EAAGC,UAAWC,iBAAkBC,UACpCC,SACJA,EAAI,CAKAC,IAAK,CAEDC,sBAAuB,sBACvBC,qBAAsB,0BACtBC,mBAAoB,sBACpBC,mBAAoB,sBACpBC,kBAAmB,iDACnBC,sBAAuB,qDACvBC,wBAAyB,oDACzBC,kBAAmB,iDAOvBC,KAAM,WAEFd,EAAEI,EAAEC,IAAIC,uBAAuBS,KAAK,SAAS,WACzCX,EAAEY,eAAehB,EAAEiB,UAGvBjB,EAAEI,EAAEC,IAAII,oBAAoBM,KAAK,SAAS,WACtCX,EAAEc,YAAYlB,EAAEiB,UAGpBjB,EAAEI,EAAEC,IAAIQ,mBAAmBE,KAAK,YAAY,SAASI,GAClC,IAAXA,EAAEC,OACFhB,EAAEiB,uBAAuBrB,EAAEiB,UAGnCb,EAAEkB,2BASNN,eAAgB,SAASG,OACjBI,QAAUJ,EACVK,UAAYD,QAAQE,KAAK,kBACzBC,KAAOH,QAAQE,KAAK,gBACpBD,WAAaE,KAAM,CACnB1B,EAAEI,EAAEC,IAAIG,oBAAoBmB,QACXxB,KAAKyB,KAAK,CAAC,CACxBC,WAAY,mDACZC,KAAM,CACFJ,KAAMA,KACNF,UAAWA,cAGV,GACJO,MAAK,SAASC,QACPA,IAAK,OACCC,QAAU,CACZC,YAAaF,IAAIG,UAAY,IAEjClC,UAAUmC,iBAAiB,mCAAoCH,SAC1DI,MAAKC,WAACC,KAACA,KAADC,GAAOA,gBACHvC,UAAUwC,mBAAmBrC,EAAEC,IAAIG,mBAAoB+B,KAAMC,OAEvEE,OAAMC,KAAOzC,iBAAiByC,WAG1CC,KAAK1C,iBAAiB2C,aAUnC3B,YAAa,SAASC,SACZ2B,IAAM3B,EAAEM,KAAK,kBACbC,KAAOP,EAAEM,KAAK,aACdsB,IAAM5B,EAAEM,KAAK,YACbuB,KAAO7B,EAAEM,KAAK,aACHtB,KAAKyB,KAAK,CAAC,CACxBC,WAAY,uCACZC,KAAM,CAACJ,KAAAA,KAAMoB,IAAAA,IAAKC,IAAAA,IAAKC,KAAAA,SAElB,GACJjB,MAAK,SAASC,QACPA,IAAK,CACLhC,EAAEmB,GAAGM,KAAK,YAAaO,IAAIgB,UACvBC,YAAcjD,EAAEmB,GAAG+B,KAAK9C,EAAEC,IAAIK,mBAC9BuC,aACAA,YAAYE,KAAKnB,IAAIoB,WAAa,IAEJ,KAA9BH,YAAYE,OAAOE,OACnBJ,YAAYK,SAAS,aAErBL,YAAYM,YAAY,aAE5BvD,EAAEmB,GAAG+B,KAAK9C,EAAEC,IAAIO,yBAAyBa,KAAK,MAAOO,IAAIwB,mBAGhEZ,KAAK1C,iBAAiB2C,YAS/BxB,uBAAwB,SAASF,SACvB2B,IAAM3B,EAAEM,KAAK,kBACbC,KAAOP,EAAEM,KAAK,aACdsB,IAAM5B,EAAEM,KAAK,YACbuB,KAAO7B,EAAEM,KAAK,aAChBqB,KAAOpB,MAAQqB,KAAOC,MACtB5C,EAAEc,YAAYC,IAStBG,wBAAyB,WACrBtB,EAAEI,EAAEC,IAAIK,mBAAmB+C,MAAK,WACE,KAA1BzD,EAAEiB,MAAMkC,OAAOE,OACfrD,EAAEiB,MAAMqC,SAAS,aAEjBtD,EAAEiB,MAAMsC,YAAY"}