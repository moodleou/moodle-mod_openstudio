{"version":3,"file":"content_block_social.min.js","sources":["../src/content_block_social.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript to manage content of social block.\n *\n * @package mod_openstudio\n * @copyright 2022 The Open University\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_openstudio/content_block_social\n */\ndefine([\n    'jquery',\n    'core/templates',\n    'core/notification',\n    'core/ajax'\n], function($, Templates, displayException, Ajax) {\n    var t;\n    t = {\n\n        /**\n         * List out all of css selector used in this module.\n         */\n        CSS: {\n            // Buttons.\n            POPUP_COMMENT_CONTENT: '.show-popup-comment',\n            POPUP_COMMENT_TOGGLE: '.comments-content-popup',\n            COMMENT_BLOCK_LIST: '.comment-block-list',\n            FLAG_CONTENT_BLOCK: '.flag_content_block',\n            FLAG_CONTENT_TEXT: '.openstudio-grid-item-content-detail-info-text',\n            FLAG_CONTENT_TEXT_NEW: '.openstudio-grid-item-content-detail-info-text-new',\n            FLAG_CONTENT_ICON_IMAGE: 'img',\n            FLAG_CONTENT_ICON: '.openstudio-grid-item-content-detail-info-box'\n        },\n\n        /**\n         * Initialize module.\n         * @method init\n         */\n        init: function() {\n            // Click comment button.\n            $(t.CSS.POPUP_COMMENT_CONTENT).bind('click', function() {\n                t.getListComment($(this));\n            });\n            // Click emoticons button.\n            $(t.CSS.FLAG_CONTENT_BLOCK).bind('click', function() {\n                t.flagContent($(this));\n            });\n            // Keypress enter event when user tabbing.\n            $(t.CSS.FLAG_CONTENT_ICON).bind(\"keypress\", function(e) {\n                if (e.which == 13) {\n                    t.userOnPressFlagContent($(this));\n                }\n            });\n        },\n\n        /**\n         * Get list comment.\n         *\n         * @param {Object} e DomEvent\n         * @param {Boolean} isUserPress flag to check user press the key instead click by mouse.\n         * @method getListComment\n         */\n        getListComment: function(e, isUserPress = false) {\n            let element = e;\n            if (isUserPress) {\n                element = $(e).find(t.CSS.POPUP_COMMENT_CONTENT).first();\n                $(e).find(t.CSS.POPUP_COMMENT_TOGGLE).first().toggleClass('show');\n            }\n            let contentid = element.attr('data-contentid');\n            let cmid = element.attr('data-cmid');\n            if (contentid && cmid) {\n                $(t.CSS.COMMENT_BLOCK_LIST).empty();\n                const promises = Ajax.call([{\n                    methodname: 'mod_openstudio_external_get_comment_by_contentid',\n                    args: {\n                        cmid: cmid,\n                        contentid: contentid\n                    }\n                }]);\n                promises[0]\n                    .done(function(res) {\n                        if (res) {\n                            const context = {\n                                commentlist: res.comments || []\n                            };\n                            Templates.renderForPromise('mod_openstudio/commentlist_popup', context)\n                                .then(({html, js}) => {\n                                    return Templates.appendNodeContents(t.CSS.COMMENT_BLOCK_LIST, html, js);\n                                })\n                                .catch(err => displayException(err));\n                        }\n                    })\n                    .fail();\n            }\n        },\n\n        /**\n         * Flag an action for a content.\n         *\n         * @param {Object} e DomEvent\n         * @method flagContent\n         */\n        flagContent: function(e) {\n            const cid = e.attr('data-contentid');\n            const cmid = e.attr('data-cmid');\n            const fid = e.attr('data-fid');\n            const mode = e.attr('data-mode');\n            const promises = Ajax.call([{\n                methodname: 'mod_openstudio_external_flag_content',\n                args: {cmid, cid, fid, mode}\n            }]);\n            promises[0]\n                .done(function(res) {\n                    if (res) {\n                        $(e).attr('data-mode', res.mode);\n                        let flagelement = $(e).find(t.CSS.FLAG_CONTENT_TEXT);\n                        if (flagelement) {\n                            flagelement.text(res.flagvalue || \"\");\n                        }\n                        $(e).find(t.CSS.FLAG_CONTENT_ICON_IMAGE).attr('src', res.flagiconimage);\n                    }\n                })\n                .fail();\n        },\n\n        /**\n         * User on press flag icon to react emoticon.\n         *\n         * @param {Object} e DomEvent\n         * @method userOnPressFlagContent\n         * @return {Function} react to content.\n         */\n        userOnPressFlagContent: function(e) {\n            const cid = e.attr('data-contentid');\n            const cmid = e.attr('data-cmid');\n            const fid = e.attr('data-fid');\n            const mode = e.attr('data-mode');\n            if (cid && cmid && fid && mode) {\n               return t.flagContent(e);\n            }\n            return t.getListComment(e, true);\n        }\n    };\n\n    return t;\n});\n"],"names":["define","$","Templates","displayException","Ajax","t","CSS","POPUP_COMMENT_CONTENT","POPUP_COMMENT_TOGGLE","COMMENT_BLOCK_LIST","FLAG_CONTENT_BLOCK","FLAG_CONTENT_TEXT","FLAG_CONTENT_TEXT_NEW","FLAG_CONTENT_ICON_IMAGE","FLAG_CONTENT_ICON","init","bind","getListComment","this","flagContent","e","which","userOnPressFlagContent","isUserPress","element","find","first","toggleClass","contentid","attr","cmid","empty","promises","call","methodname","args","done","res","context","commentlist","comments","renderForPromise","then","html","js","appendNodeContents","catch","err","fail","cid","fid","mode","flagelement","text","flagvalue","flagiconimage"],"mappings":";;;;;;;AA0BAA,6CAAO,CACH,SACA,iBACA,oBACA,cACD,SAASC,EAAGC,UAAWC,iBAAkBC,UACpCC,SACJA,EAAI,CAKAC,IAAK,CAEDC,sBAAuB,sBACvBC,qBAAsB,0BACtBC,mBAAoB,sBACpBC,mBAAoB,sBACpBC,kBAAmB,iDACnBC,sBAAuB,qDACvBC,wBAAyB,MACzBC,kBAAmB,iDAOvBC,KAAM,WAEFd,EAAEI,EAAEC,IAAIC,uBAAuBS,KAAK,SAAS,WACzCX,EAAEY,eAAehB,EAAEiB,UAGvBjB,EAAEI,EAAEC,IAAII,oBAAoBM,KAAK,SAAS,WACtCX,EAAEc,YAAYlB,EAAEiB,UAGpBjB,EAAEI,EAAEC,IAAIQ,mBAAmBE,KAAK,YAAY,SAASI,GAClC,IAAXA,EAAEC,OACFhB,EAAEiB,uBAAuBrB,EAAEiB,WAYvCD,eAAgB,SAASG,OAAGG,oEACpBC,QAAUJ,EACVG,cACAC,QAAUvB,EAAEmB,GAAGK,KAAKpB,EAAEC,IAAIC,uBAAuBmB,QACjDzB,EAAEmB,GAAGK,KAAKpB,EAAEC,IAAIE,sBAAsBkB,QAAQC,YAAY,aAE1DC,UAAYJ,QAAQK,KAAK,kBACzBC,KAAON,QAAQK,KAAK,gBACpBD,WAAaE,KAAM,CACnB7B,EAAEI,EAAEC,IAAIG,oBAAoBsB,YACtBC,SAAW5B,KAAK6B,KAAK,CAAC,CACxBC,WAAY,mDACZC,KAAM,CACFL,KAAMA,KACNF,UAAWA,cAGnBI,SAAS,GACJI,MAAK,SAASC,QACPA,IAAK,KACCC,QAAU,CACZC,YAAaF,IAAIG,UAAY,IAEjCtC,UAAUuC,iBAAiB,mCAAoCH,SAC1DI,MAAK,mBAAEC,UAAAA,KAAMC,QAAAA,UACH1C,UAAU2C,mBAAmBxC,EAAEC,IAAIG,mBAAoBkC,KAAMC,OAEvEE,OAAM,SAAAC,YAAO5C,iBAAiB4C,YAG1CC,SAUb7B,YAAa,SAASC,OACZ6B,IAAM7B,EAAES,KAAK,kBACbC,KAAOV,EAAES,KAAK,aACdqB,IAAM9B,EAAES,KAAK,YACbsB,KAAO/B,EAAES,KAAK,aACHzB,KAAK6B,KAAK,CAAC,CACxBC,WAAY,uCACZC,KAAM,CAACL,KAAAA,KAAMmB,IAAAA,IAAKC,IAAAA,IAAKC,KAAAA,SAElB,GACJf,MAAK,SAASC,QACPA,IAAK,CACLpC,EAAEmB,GAAGS,KAAK,YAAaQ,IAAIc,UACvBC,YAAcnD,EAAEmB,GAAGK,KAAKpB,EAAEC,IAAIK,mBAC9ByC,aACAA,YAAYC,KAAKhB,IAAIiB,WAAa,IAEtCrD,EAAEmB,GAAGK,KAAKpB,EAAEC,IAAIO,yBAAyBgB,KAAK,MAAOQ,IAAIkB,mBAGhEP,QAUT1B,uBAAwB,SAASF,OACvB6B,IAAM7B,EAAES,KAAK,kBACbC,KAAOV,EAAES,KAAK,aACdqB,IAAM9B,EAAES,KAAK,YACbsB,KAAO/B,EAAES,KAAK,oBAChBoB,KAAOnB,MAAQoB,KAAOC,KAChB9C,EAAEc,YAAYC,GAEjBf,EAAEY,eAAeG,GAAG,KAI5Bf"}